!function(t){function e(e){for(var n,o,r=e[0],a=e[1],s=0,u=[];s<r.length;s++)o=r[s],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&u.push(i[o][0]),i[o]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n]);for(l&&l(e);u.length;)u.shift()()}var n={},i={1:0};function o(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.e=function(t){var e=[],n=i[t];if(0!==n)if(n)e.push(n[2]);else{var r=new Promise((function(e,o){n=i[t]=[e,o]}));e.push(n[2]=r);var a,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(t){return o.p+""+({0:"Axl",4:"audioworkletaudio"}[t]||t)+".js"}(t);var l=new Error;a=function(e){s.onerror=s.onload=null,clearTimeout(u);var n=i[t];if(0!==n){if(n){var o=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+o+": "+r+")",l.name="ChunkLoadError",l.type=o,l.request=r,n[1](l)}i[t]=void 0}};var u=setTimeout((function(){a({type:"timeout",target:s})}),12e4);s.onerror=s.onload=a,document.head.appendChild(s)}return Promise.all(e)},o.m=t,o.c=n,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/blob-opera/",o.oe=function(t){throw console.error(t),t};var r=self.webpackJsonp=self.webpackJsonp||[],a=r.push.bind(r);r.push=e,r=r.slice();for(var s=0;s<r.length;s++)e(r[s]);var l=a;o(o.s=42)}([function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"l",(function(){return a})),n.d(e,"r",(function(){return s})),n.d(e,"q",(function(){return l})),n.d(e,"n",(function(){return u})),n.d(e,"a",(function(){return c})),n.d(e,"m",(function(){return h})),n.d(e,"g",(function(){return f})),n.d(e,"k",(function(){return d})),n.d(e,"j",(function(){return m})),n.d(e,"f",(function(){return g})),n.d(e,"c",(function(){return b})),n.d(e,"e",(function(){return v})),n.d(e,"d",(function(){return y})),n.d(e,"h",(function(){return _})),n.d(e,"o",(function(){return x})),n.d(e,"i",(function(){return w})),n.d(e,"p",(function(){return P}));var i=n(2),o=n(1);function r(t,e,n){return Math.min(Math.max(t,e),n)}function a(t,e,n){return r((n-t)/(e-t),0,1)}function s(t,e,n){var i=r((n-t)/(e-t),0,1);return i*i*(3-2*i)}function l(t,e,n){return(n=r((n-t)/(e-t),0,1))*n*n*(n*(6*n-15)+10)}function u(t,e,n){return(1-n)*t+n*e}function c(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}function h(t){return 440*Math.pow(2,(t-69)/12)}function f(t){return 12*Math.log2(t/440)+69}function d(t){return t===o.b.a||t===o.b.e||t===o.b.i||t===o.b.o||t===o.b.u}var p=[0,0,0];function m(t,e,n,o,r){var a=i.a.dot(n,r),s=i.a.dot(i.a.subtract(p,e,o),n)/a;return i.a.add(t,o,i.a.multiplyByScalar(p,r,s)),t}function g(t,e){for(var n=[],i=0;i<t;++i)n.push(e);return n}function b(t,e,n){for(var o=[],r=0;r<t.length;++r)o.push([0,0,0]);var a=function(e){return[t[3*e+0],t[3*e+1],t[3*e+2]*n]};for(r=0;r<e.length/3;++r){var s=e[3*r+0],l=e[3*r+1],u=e[3*r+2],c=a(s),h=a(l),f=a(u),d=i.a.cross([],i.a.subtract([],h,c),i.a.subtract([],f,c));i.a.add(o[s],o[s],d),i.a.add(o[l],o[l],d),i.a.add(o[u],o[u],d)}for(r=0;r<o.length;++r)i.a.normalize(o[r],o[r]);var p=[];for(r=0;r<o.length;++r)p.push(o[r][0]),p.push(o[r][1]),p.push(o[r][2]);return p}function v(t){return Math.PI*t/180}function y(t,e){new Uint8Array(e).set(new Uint8Array(t))}function _(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]}function x(t,e){return Math.round(t/e)*e}function w(t){var e=t[0],n=t[1],i=t[2],o=i*n,r=6*(e%=1),a=o*(1-Math.abs(r%2-1)),s=Math.floor(r),l=[o,a,0,0,a,o][s],u=[a,o,o,a,0,0][s],c=[0,0,a,o,o,a][s],h=i-o;return[l+=h,u+=h,c+=h]}function P(t){var e=t[0],n=t[1],i=t[2],o=Math.max(e,n,i),r=o-Math.min(e,n,i),a=r&&(o==e?(n-i)/r:o==n?2+(i-e)/r:4+(e-n)/r);return[60*(a<0?a+6:a)/360,o&&r/o,o]}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"d",(function(){return l}));var i,o={spectralMin:-128.68316134071944,spectralMax:19,aperiodicMin:-35.112804058126855,aperiodicMax:13877787807814457e-33};function r(t){return t===i.a?"a":t===i.e?"e":t===i.i?"i":t===i.o?"o":t===i.u?"u":void 0}!function(t){t[t.i=0]="i",t[t.a=1]="a",t[t.e=2]="e",t[t.o=3]="o",t[t.sil=4]="sil",t[t.r=5]="r",t[t.n=6]="n",t[t.l=7]="l",t[t.t=8]="t",t[t.s=9]="s",t[t.d=10]="d",t[t.u=11]="u",t[t.m=12]="m",t[t.p=13]="p",t[t.v=14]="v",t[t.ch=15]="ch",t[t.c=16]="c",t[t.f=17]="f",t[t.j=18]="j",t[t.b=19]="b",t[t.h=20]="h",t[t.g=21]="g",t[t.qu=22]="qu",t[t.sh=23]="sh",t[t.ny=24]="ny",t[t.y=25]="y",t[t.sk=26]="sk",t[t.z=27]="z",t[t.tz=28]="tz"}(i||(i={}));for(var a=[],s=0;s<29;++s)a[s]=s===i.t||s===i.s||s===i.p||s===i.v||s===i.ch||s===i.c||s===i.f||s===i.j||s===i.h||s===i.g||s===i.qu||s===i.sh||s===i.sk||s===i.z||s===i.tz;function l(t){return a[t]}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(8);function o(t,e,n){return Math.min(Math.max(t,e),n)}var r={set:function(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},clone:function(t){return[t[0],t[1],t[2]]},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},scaleAndAdd:function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t},cross:function(t,e,n){var i=e[0],o=e[1],r=e[2],a=n[0],s=n[1],l=n[2];return t[0]=o*l-r*s,t[1]=r*a-i*l,t[2]=i*s-o*a,t},coneClamp:function(t,e,n,o){if(r.dot(e,n)<-.9999)return t;var a=Math.acos(r.dot(e,n));if(a>o){var s=r.normalize([],r.cross([],n,e)),l=i.a.fromAxisAngle([],s,a-o);return r.multiplyByQuaternion(t,n,l),t}return t},rotateTowards:function(t,e,n,o){var a=Math.acos(r.dot(e,n));o>a&&(o=a);var s=r.normalize([],r.cross([],e,n)),l=i.a.fromAxisAngle([],s,o);return r.multiplyByQuaternion(t,e,l),t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},multiply:function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},addList:function(t,e){t[0]=0,t[1]=0,t[2]=0;for(var n=0;n<e.length;++n)t[0]+=e[n][0],t[1]+=e[n][1],t[2]+=e[n][2];return t},subtract:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},multiplyByScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},multiplyByQuaternion:function(t,e,n){var i=e[0],o=e[1],r=e[2],a=n[3],s=n[0],l=n[1],u=n[2],c=a*i+l*r-u*o,h=a*o+u*i-s*r,f=a*r+s*o-l*i,d=-s*i-l*o-u*r;return t[0]=d*-s+c*a+h*-u-f*-l,t[1]=d*-l+h*a+f*-s-c*-u,t[2]=d*-u+f*a+c*-l-h*-s,t},normalize:function(t,e){var n=e[0],i=e[1],o=e[2],r=1/Math.sqrt(n*n+i*i+o*o);return t[0]=n*r,t[1]=i*r,t[2]=o*r,t},distance:function(t,e){var n=e[0]-t[0],i=e[1]-t[1],o=e[2]-t[2];return Math.sqrt(n*n+i*i+o*o)},distance2:function(t,e){var n=e[0]-t[0],i=e[1]-t[1],o=e[2]-t[2];return n*n+i*i+o*o},length:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},mix:function(t,e,n,i){return t[0]=(1-i)*e[0]+i*n[0],t[1]=(1-i)*e[1]+i*n[1],t[2]=(1-i)*e[2]+i*n[2],t},linearMix:function(t,e,n,i){for(var o=0;o<3;++o)e[o]<n[o]?t[o]=Math.min(e[o]+i[o],n[o]):e[o]>n[o]?t[o]=Math.max(e[o]-i[o],n[o]):t[o]=n[o]},clampedMix:function(t,e,n,i,o){var a=r.subtract([],n,e),s=r.length(a),l=Math.min(s*i,o);l>0?r.add(t,e,r.multiplyByScalar([],a,l/s)):(t[0]=n[0],t[1]=n[1],t[2]=n[2]),r.multiplyByScalar(a,a,i)},clamp:function(t,e,n,i){return t[0]=o(e[0],n[0],i[0]),t[1]=o(e[1],n[1],i[1]),t[2]=o(e[2],n[2],i[2]),t},slerp:function(t,e,n,i){var a=r.dot(e,n);a=o(a,0,1);for(var s=Math.acos(a)*i,l=r.subtract([],n,r.multiplyByScalar([],e,a)),u=0;u<3;++u)t[u]=e[u]*Math.cos(s)+l[u]*Math.sin(s);return t},pow:function(t,e,n){return t[0]=Math.pow(e[0],n),t[1]=Math.pow(e[1],n),t[2]=Math.pow(e[2],n),t},hsvToRGB:function(t,e){var n=e[0],i=e[1],o=e[2],r=6*(n%=1),a=(e=o*i)*(1-Math.abs(r%2-1)),s=Math.floor(r),l=[e,a,0,0,a,e][s],u=[a,e,e,a,0,0][s],c=[0,0,a,e,e,a][s],h=o-e;return l+=h,u+=h,c+=h,t[0]=l,t[1]=u,t[2]=c,t},rgbToHSV:function(t,e){var n,i,o,r,a,s=e[0],l=e[1],u=e[2],c=Math.max(s,l,u),h=c-Math.min(s,l,u),f=function(t){return(c-t)/6/h+.5};return 0==h?r=a=0:(a=h/c,n=f(s),i=f(l),o=f(u),s===c?r=o-i:l===c?r=1/3+n-o:u===c&&(r=2/3+i-n),r<0?r+=1:r>1&&(r-=1)),t[0]=r,t[1]=a,t[2]=c,t}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0);function o(t){return t}var r=function(){function t(t,e){void 0===e&&(e=o),this.fromValue=t,this.targetValue=t,this.smoothingFunction=e,this.tweenDuration=1,this.tweenStartTime=-99999}return t.prototype.change=function(t,e,n){void 0===n&&(n=0),t!==this.targetValue&&(this.fromValue=this.evaluate(),this.targetValue=t,this.tweenDuration=1e3*e,this.tweenStartTime=Date.now()+1e3*n)},t.prototype.evaluate=function(){if(0===this.tweenDuration)return this.targetValue;var t=this.smoothingFunction(Object(i.l)(this.tweenStartTime,this.tweenStartTime+this.tweenDuration,Date.now()));return Object(i.n)(this.fromValue,this.targetValue,t)},t}()},function(t,e,n){"use strict";(function(t){var i=e;function o(t,e,n){for(var i=Object.keys(e),o=0;o<i.length;++o)void 0!==t[i[o]]&&n||(t[i[o]]=e[i[o]]);return t}function r(t){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&o(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}i.asPromise=n(21),i.base64=n(22),i.EventEmitter=n(23),i.float=n(24),i.inquire=n(25),i.utf8=n(26),i.pool=n(27),i.LongBits=n(28),i.isNode=Boolean(void 0!==t&&t&&t.process&&t.process.versions&&t.process.versions.node),i.global=i.isNode&&t||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},i.isString=function(t){return"string"==typeof t||t instanceof String},i.isObject=function(t){return t&&"object"==typeof t},i.isset=i.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},i.Buffer=function(){try{var t=i.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(t){return"number"==typeof t?i.Buffer?i._Buffer_allocUnsafe(t):new i.Array(t):i.Buffer?i._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},i.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(t){return t?i.LongBits.from(t).toHash():i.LongBits.zeroHash},i.longFromHash=function(t,e){var n=i.LongBits.fromHash(t);return i.Long?i.Long.fromBits(n.lo,n.hi,e):n.toNumber(Boolean(e))},i.merge=o,i.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},i.newError=r,i.ProtocolError=r("ProtocolError"),i.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===e[t[n]]&&void 0!==this[t[n]]&&null!==this[t[n]])return t[n]}},i.oneOfSetter=function(t){return function(e){for(var n=0;n<t.length;++n)t[n]!==e&&delete this[t[n]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var t=i.Buffer;t?(i._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},i._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):i._Buffer_from=i._Buffer_allocUnsafe=null}}).call(this,n(15))},function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o}));var i=function(){function t(t,e){this.module=t,this.pointer=this.module._malloc(4*e),this.length=e}return t.prototype.getArray=function(){return this.module.HEAPU32.subarray(this.pointer>>2,(this.pointer>>2)+this.length)},t}(),o=function(){function t(t,e){this.module=t,this.pointer=this.module._malloc(4*e),this.length=e}return t.prototype.getArray=function(){return this.module.HEAPF32.subarray(this.pointer>>2,(this.pointer>>2)+this.length)},t}()},function(t,e,n){"use strict";function i(t){return"/blob-opera/"+t}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";function i(t){return new Promise((function(e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(t){var n=i.response;n&&e(n)},i.send(null)}))}function o(t){return new Promise((function(e,n){var i=document.createElement("img");i.onload=function(){e(i)},i.src=t}))}function r(t){return new Promise((function(e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){e(JSON.parse(i.responseText))},i.send(null)}))}n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return r}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i={identity:function(){return[0,0,0,1]},makeIdentity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},length:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]},invert:function(t,e){var n=1/(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]);return t[0]=-e[0]*n,t[1]=-e[1]*n,t[2]=-e[2]*n,t[3]=e[3]*n,t},multiply:function(t,e,n){var i=e[0],o=e[1],r=e[2],a=e[3],s=n[0],l=n[1],u=n[2],c=n[3];return t[0]=s*i-l*o-u*r-c*a,t[1]=s*o+l*i+u*a-c*r,t[2]=s*r-l*a+u*i+c*o,t[3]=s*a+l*r-u*o+c*i,t},normalize:function(t,e){var n=1/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]);return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},fromAxisAngle:function(t,e,n){return t[0]=e[0]*Math.sin(n/2),t[1]=e[1]*Math.sin(n/2),t[2]=e[2]*Math.sin(n/2),t[3]=Math.cos(n/2),t},slerp:function(t,e,n,o){var r,a,s,l,u,c=e[0],h=e[1],f=e[2],d=e[3],p=n[0],m=n[1],g=n[2],b=n[3];return(a=c*p+h*m+f*g+d*b)<0&&(a=-a,p=-p,m=-m,g=-g,b=-b),1-a>1e-6?(r=Math.acos(a),s=Math.sin(r),l=Math.sin((1-o)*r)/s,u=Math.sin(o*r)/s):(l=1-o,u=o),t[0]=l*c+u*p,t[1]=l*h+u*m,t[2]=l*f+u*g,t[3]=l*d+u*b,i.normalize(t,t),t}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i=function(){function t(t){this.buffer=t,this.floatView=new Float32Array(t),this.intView=new Int32Array(t)}return t.prototype.setId=function(t){this.intView[0]=t},t.prototype.getId=function(){return this.intView[0]},t.prototype.setPhoneme=function(t){this.intView[1]=t},t.prototype.getPhoneme=function(){return this.intView[1]},t.prototype.setPreviousPhoneme=function(t){this.intView[2]=t},t.prototype.getPreviousPhoneme=function(){return this.intView[2]},t.prototype.setNextPhoneme=function(t){this.intView[3]=t},t.prototype.getNextPhoneme=function(){return this.intView[3]},t.prototype.setPhonemePosition=function(t){this.floatView[4]=t},t.prototype.getPhonemePosition=function(){return this.floatView[4]},t.prototype.setF0=function(t){this.floatView[5]=t},t.prototype.getF0=function(){return this.floatView[5]},t.prototype.setSingerIndex=function(t){this.intView[6]=t},t.prototype.getSingerIndex=function(){return this.intView[6]},t.prototype.setMidiNote=function(t){this.floatView[7]=t},t.prototype.getMidiNote=function(){return this.floatView[7]},t.prototype.setVowel=function(t){this.intView[8]=t},t.prototype.getVowel=function(){return this.intView[8]},t.prototype.setMuted=function(t){this.intView[9]=t?1:0},t.prototype.getMuted=function(){return 0!==this.intView[9]},t.prototype.setControlled=function(t){this.intView[10]=t?1:0},t.prototype.getControlled=function(){return 0!==this.intView[10]},t.prototype.setSkip=function(t){this.intView[11]=t},t.prototype.getSkip=function(){return this.intView[11]},t.prototype.getAperiodic=function(){return this.floatView.subarray(12,16)},t.getSizeBytes=function(){return 64},t.isExcitationFrame=function(e){return e.byteLength===t.getSizeBytes()},t}()},function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return a}));var i=n(0);function o(t,e,n,o){var r,a=-3*Math.abs(Math.log2(e/Object(i.b)(t,1,16e3)))/n;return((r=a+100)>0?Math.pow(10,(r-100)/20):0)*o}function r(t){for(var e=[],n=0;n<60;++n)e.push(0);for(var i=function(t,e,n){for(var i=[],o=e/2/(t-1),r=0;r<t;++r){var a=r*o,s=2*Math.PI*a/e,l=-n,u=Math.atan2((1-l*l)*Math.sin(s),(1+l*l)*Math.cos(s)-2*l);i.push(u/(2*Math.PI)*e)}return i[t-1]=e/2,i}(60,32e3,.45),r=0,a=t;r<a.length;r++){var s=a[r];for(n=0;n<60;++n)e[n]+=o(i[n],s.centreFrequencyHz,s.bandwidthOctaves,s.gainDB)}return e}var a={forceScriptProcessor:!1,scriptProcessorBufferSize:4096,frameHopSeconds:.005,excitationOffset:0,targetFFTSize:512,pans:[[-23,-6,17,28],[0,-14,14,28],[0,0,-14,14],[0,0,0,0]],reverb:{mix:.6,feedback:.88,lowcut:3e-4,highcut:.741,crossfreq:.833,predelay_ms:0,modamount:.008,modtime:.666},noiseExcitation:!1,onlySpectralGain:!1,voiceTypes:[{scale:[67,69,71,72,74,76,77,79,81,83,84]},{scale:[60,62,64,65,67,69,71,72,74,76]},{scale:[48,50,52,53,55,57,59,60,62,64,65,67]},{scale:[43,45,47,48,50,52,53,55,57,59,60]}],singers:[{voiceType:0,pitchStops:[62,72,80],spectralFilters:[{centreFrequencyHz:459,bandwidthOctaves:4,gainDB:-4.4},{centreFrequencyHz:1640,bandwidthOctaves:2.6,gainDB:4.4},{centreFrequencyHz:15e3,bandwidthOctaves:4,gainDB:-2.8}],aperiodicGain:{vowel:[-15,-9,-6,0,-9,-15],consonant:[0,0,0,0,0,0]},periodicGain:{vowel:[0,0,0,0,0,0],consonant:[0,0,0,0,0,0]},jitterScale:1,spectralSingerMapping:[1,0,0,0,0,0],aperiodicSingerMapping:[1,0,0,0,0,0],gain:1.883},{pitchStops:[59,68,74],voiceType:1,spectralFilters:[{centreFrequencyHz:87.8,bandwidthOctaves:3,gainDB:-7.4},{centreFrequencyHz:275.5,bandwidthOctaves:2.15,gainDB:6.8},{centreFrequencyHz:3263,bandwidthOctaves:2,gainDB:-2.2}],aperiodicGain:{vowel:[-3,0,0,0,-3,-6],consonant:[0,0,0,0,0,0]},periodicGain:{vowel:[0,0,0,0,0,0],consonant:[0,0,0,0,0,0]},jitterScale:1,spectralSingerMapping:[.1,.5,0,0,1,0],aperiodicSingerMapping:[.1,.5,0,0,1,0],gain:1.6947},{pitchStops:[48,58,65],voiceType:2,spectralFilters:[{centreFrequencyHz:72,bandwidthOctaves:4,gainDB:-6.8},{centreFrequencyHz:874.3,bandwidthOctaves:2.18,gainDB:4.8},{centreFrequencyHz:2212,bandwidthOctaves:3.68,gainDB:-3.4}],aperiodicGain:{vowel:[0,0,0,0,0,0],consonant:[0,0,0,0,0,0]},periodicGain:{vowel:[0,0,0,0,0,0],consonant:[0,0,0,0,0,0]},jitterScale:1,spectralSingerMapping:[0,0,0,1,0,0],aperiodicSingerMapping:[0,0,0,1,0,0],gain:2.4479},{pitchStops:[43,52,60],voiceType:3,spectralFilters:[{centreFrequencyHz:225.7,bandwidthOctaves:2.95,gainDB:5.2},{centreFrequencyHz:1031.6,bandwidthOctaves:2,gainDB:-4.8},{centreFrequencyHz:2558.2,bandwidthOctaves:3.02,gainDB:1.8}],aperiodicGain:{vowel:[0,0,0,0,0,0],consonant:[0,0,0,0,0,0]},periodicGain:{vowel:[0,0,0,0,0,0],consonant:[0,0,0,0,0,0]},jitterScale:1,spectralSingerMapping:[0,0,0,1,0,0],aperiodicSingerMapping:[0,0,0,1,0,0],gain:1.5064}]}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i=function(){function t(t){this.buffer=t,this.floatView=new Float32Array(t),this.intView=new Int32Array(t)}return t.prototype.setId=function(t){this.intView[0]=t},t.prototype.getId=function(){return this.intView[0]},t.prototype.setPhoneme=function(t){this.intView[1]=t},t.prototype.getPhoneme=function(){return this.intView[1]},t.prototype.setPreviousPhoneme=function(t){this.intView[2]=t},t.prototype.getPreviousPhoneme=function(){return this.intView[2]},t.prototype.setNextPhoneme=function(t){this.intView[3]=t},t.prototype.getNextPhoneme=function(){return this.intView[3]},t.prototype.setPhonemePosition=function(t){this.floatView[4]=t},t.prototype.getPhonemePosition=function(){return this.floatView[4]},t.prototype.setF0=function(t){this.floatView[5]=t},t.prototype.getF0=function(){return this.floatView[5]},t.prototype.setSingerIndex=function(t){this.intView[6]=t},t.prototype.getSingerIndex=function(){return this.intView[6]},t.prototype.setMidiNote=function(t){this.floatView[7]=t},t.prototype.getMidiNote=function(){return this.floatView[7]},t.prototype.setVowel=function(t){this.intView[8]=t},t.prototype.getVowel=function(){return this.intView[8]},t.prototype.setMuted=function(t){this.intView[9]=t?1:0},t.prototype.getMuted=function(){return 0!==this.intView[9]},t.prototype.setControlled=function(t){this.intView[10]=t?1:0},t.prototype.getControlled=function(){return 0!==this.intView[10]},t.prototype.setSkip=function(t){this.intView[11]=t},t.prototype.getSkip=function(){return this.intView[11]},t.prototype.getSpectral=function(){return this.floatView.subarray(12,270)},t.prototype.setSubsteps=function(t){this.intView[270]=t},t.prototype.getSubsteps=function(){return this.intView[270]},t.prototype.setSendTime=function(t){this.floatView[271]=t},t.prototype.getSendTime=function(){return this.floatView[271]},t.getSizeBytes=function(){return 1088},t.isSpectralFrame=function(e){return e.byteLength===t.getSizeBytes()},t}()},,function(t,e,n){"use strict";function i(){return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]))}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";t.exports=h;var i,o=n(4),r=o.LongBits,a=o.base64,s=o.utf8;function l(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function u(){}function c(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function h(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var f=function(){return o.Buffer?function(){return(h.create=function(){return new i})()}:function(){return new h}};function d(t,e,n){e[n]=255&t}function p(t,e){this.len=t,this.next=void 0,this.val=e}function m(t,e,n){for(;t.hi;)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[n++]=127&t.lo|128,t.lo=t.lo>>>7;e[n++]=t.lo}function g(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}h.create=f(),h.alloc=function(t){return new o.Array(t)},o.Array!==Array&&(h.alloc=o.pool(h.alloc,o.Array.prototype.subarray)),h.prototype._push=function(t,e,n){return this.tail=this.tail.next=new l(t,e,n),this.len+=e,this},p.prototype=Object.create(l.prototype),p.prototype.fn=function(t,e,n){for(;t>127;)e[n++]=127&t|128,t>>>=7;e[n]=t},h.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new p((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},h.prototype.int32=function(t){return t<0?this._push(m,10,r.fromNumber(t)):this.uint32(t)},h.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},h.prototype.uint64=function(t){var e=r.from(t);return this._push(m,e.length(),e)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(t){var e=r.from(t).zzEncode();return this._push(m,e.length(),e)},h.prototype.bool=function(t){return this._push(d,1,t?1:0)},h.prototype.fixed32=function(t){return this._push(g,4,t>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(t){var e=r.from(t);return this._push(g,4,e.lo)._push(g,4,e.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(t){return this._push(o.float.writeFloatLE,4,t)},h.prototype.double=function(t){return this._push(o.float.writeDoubleLE,8,t)};var b=o.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var i=0;i<t.length;++i)e[n+i]=t[i]};h.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(d,1,0);if(o.isString(t)){var n=h.alloc(e=a.length(t));a.decode(t,n,0),t=n}return this.uint32(e)._push(b,e,t)},h.prototype.string=function(t){var e=s.length(t);return e?this.uint32(e)._push(s.write,e,t):this._push(d,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},h.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},h._configure=function(t){i=t,h.create=f(),i._configure()}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";t.exports=l;var i,o=n(4),r=o.LongBits,a=o.utf8;function s(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function l(t){this.buf=t,this.pos=0,this.len=t.length}var u,c="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new l(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new l(t);throw Error("illegal buffer")},h=function(){return o.Buffer?function(t){return(l.create=function(t){return o.Buffer.isBuffer(t)?new i(t):c(t)})(t)}:c};function f(){var t=new r(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw s(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw s(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function d(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw s(this,8);return new r(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}l.create=h(),l.prototype._slice=o.Array.prototype.subarray||o.Array.prototype.slice,l.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return u}),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return d(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|d(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var t=o.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},l.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var t=o.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},l.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw s(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},l.prototype.string=function(){var t=this.bytes();return a.read(t,0,t.length)},l.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw s(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},l._configure=function(t){i=t,l.create=h(),i._configure();var e=o.Long?"toLong":"toNumber";o.merge(l.prototype,{int64:function(){return f.call(this)[e](!1)},uint64:function(){return f.call(this)[e](!0)},sint64:function(){return f.call(this).zzDecode()[e](!1)},fixed64:function(){return p.call(this)[e](!0)},sfixed64:function(){return p.call(this)[e](!1)}})}},function(t,e,n){"use strict";var i=n(19),o=i.Reader,r=i.Writer,a=i.util,s=i.roots.default||(i.roots.default={});s.JitterTemplates=function(){function t(t){if(this.templates=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.templates=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=r.create()),null!=t.templates&&t.templates.length)for(var n=0;n<t.templates.length;++n)s.JitterTemplates.Template.encode(t.templates[n],e.uint32(10).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.JitterTemplates;t.pos<n;){var r=t.uint32();switch(r>>>3){case 1:i.templates&&i.templates.length||(i.templates=[]),i.templates.push(s.JitterTemplates.Template.decode(t,t.uint32()));break;default:t.skipType(7&r)}}return i},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.templates&&t.hasOwnProperty("templates")){if(!Array.isArray(t.templates))return"templates: array expected";for(var e=0;e<t.templates.length;++e){var n=s.JitterTemplates.Template.verify(t.templates[e]);if(n)return"templates."+n}}return null},t.fromObject=function(t){if(t instanceof s.JitterTemplates)return t;var e=new s.JitterTemplates;if(t.templates){if(!Array.isArray(t.templates))throw TypeError(".JitterTemplates.templates: array expected");e.templates=[];for(var n=0;n<t.templates.length;++n){if("object"!=typeof t.templates[n])throw TypeError(".JitterTemplates.templates: object expected");e.templates[n]=s.JitterTemplates.Template.fromObject(t.templates[n])}}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.templates=[]),t.templates&&t.templates.length){n.templates=[];for(var i=0;i<t.templates.length;++i)n.templates[i]=s.JitterTemplates.Template.toObject(t.templates[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t.Template=function(){function t(t){if(this.values=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.values=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=r.create()),null!=t.values&&t.values.length){e.uint32(10).fork();for(var n=0;n<t.values.length;++n)e.float(t.values[n]);e.ldelim()}return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.JitterTemplates.Template;t.pos<n;){var r=t.uint32();switch(r>>>3){case 1:if(i.values&&i.values.length||(i.values=[]),2==(7&r))for(var a=t.uint32()+t.pos;t.pos<a;)i.values.push(t.float());else i.values.push(t.float());break;default:t.skipType(7&r)}}return i},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.values&&t.hasOwnProperty("values")){if(!Array.isArray(t.values))return"values: array expected";for(var e=0;e<t.values.length;++e)if("number"!=typeof t.values[e])return"values: number[] expected"}return null},t.fromObject=function(t){if(t instanceof s.JitterTemplates.Template)return t;var e=new s.JitterTemplates.Template;if(t.values){if(!Array.isArray(t.values))throw TypeError(".JitterTemplates.Template.values: array expected");e.values=[];for(var n=0;n<t.values.length;++n)e.values[n]=Number(t.values[n])}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.values=[]),t.values&&t.values.length){n.values=[];for(var i=0;i<t.values.length;++i)n.values[i]=e.json&&!isFinite(t.values[i])?String(t.values[i]):t.values[i]}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t}(),t.exports=s},function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var i=n(0),o=n(17),r=function(){function t(t){this.templates=[];for(var e=0,n=o.JitterTemplates.decode(t).templates;e<n.length;e++){var i=n[e];this.templates.push(i.values)}this.previousTemplate=this.getRandomTemplate(),this.currentTemplate=this.getRandomTemplate(),this.currentTemplateFrame=0}return t.prototype.getRandomTemplate=function(){return this.templates[Math.floor(Math.random()*this.templates.length)]},t.prototype.next=function(){var t=0;if(this.currentTemplateFrame<10){var e=this.previousTemplate.length-1-10+this.currentTemplateFrame,n=Object(i.l)(0,10,this.currentTemplateFrame);t=Object(i.n)(this.previousTemplate[e],this.currentTemplate[this.currentTemplateFrame],n)}else t=this.currentTemplate[this.currentTemplateFrame];return this.currentTemplateFrame=this.currentTemplateFrame+1,this.currentTemplateFrame>=this.currentTemplate.length-10&&(this.previousTemplate=this.currentTemplate,this.currentTemplate=this.getRandomTemplate(),this.currentTemplateFrame=0),t},t}(),a=n(10),s=n(1),l=function(){function t(t,e){this.objects=[];for(var n=0;n<e;++n)this.objects.push(t());this.index=0}return t.prototype.next=function(){return this.index=(this.index+1)%this.objects.length,this.objects[this.index]},t.prototype.head=function(){return this.objects[this.index]},t}(),u=function(){function t(t,e,n,o,s,u,c){this.onFrameUsed=null,this.lastSubsteps=1,this.jitter=new r(s),this.audioParameters=c,this.synthPointer=e,this.voiceIndex=n,this.singerIndex=o,this.voicePointer=t._synthGetVoice(e,n),this.gain=c.singers[this.singerIndex].gain,this.sampleRate=u,this.module=t,this.spectralFramePointers=new l((function(){return t._createSpectralFrame(258)}),100),this.excitationFramePointers=new l((function(){return t._createExcitationFrame(6)}),100),this.previousF0=440,this.nextExcitationFrames=[],this.nextSpectralFrames=[],this.lastOverrideFrequency=440,this.overrideF0s=[],this.overrideFrequency=!1,this.setSpectralFrameData(this.spectralFramePointers.next(),Object(i.f)(258,0),!0),this.setExcitationFrameData(this.excitationFramePointers.next(),Object(i.f)(4,-120),!0,!1);for(var h=0;h<c.excitationOffset;++h)this.setSpectralFrameData(this.spectralFramePointers.next(),Object(i.f)(258,0),!0);for(h=0;h<-c.excitationOffset;++h)this.setExcitationFrameData(this.excitationFramePointers.next(),Object(i.f)(4,-120),!0,!1);this.spectralGain=Object(a.b)(c.singers[this.singerIndex].spectralFilters)}return t.prototype.pushExcitationFrame=function(t){this.nextExcitationFrames.push(t)},t.prototype.pushSpectralFrame=function(t){this.nextSpectralFrames.push(t)},t.prototype.setSpectralFrameData=function(t,e,n){this.module._spectralFrameReset(t,n?1:0);if(!n)for(var i=this.module._spectralFrameGetSpectrogram(t),o=this.module.HEAPF32.subarray(i>>2,258+(i>>2)),r=0;r<258;++r)o[r]=e[r]},t.prototype.setExcitationFrameData=function(t,e,n,o){if(this.module._excitationFrameReset(t,n?1:0),!n){var r=this.module._excitationFrameGetAperiodic(t),a=this.module.HEAPF32.subarray(r>>2,6+(r>>2));a[0]=-60,a[5]=-1e-12;for(var l=0;l<4;++l)a[1+l]=s.a.aperiodicMin+(.5*e[l]+.5)*(s.a.aperiodicMax-s.a.aperiodicMin);var u=o?this.audioParameters.singers[this.singerIndex].aperiodicGain.consonant:this.audioParameters.singers[this.singerIndex].aperiodicGain.vowel;for(l=0;l<6;++l)a[l]+=u[l],a[l]=Math.pow(10,a[l]/10);var c=this.module._excitationFrameGetPeriodic(t),h=this.module.HEAPF32.subarray(c>>2,6+(c>>2));h[0]=-60,h[5]=-1e-12;for(l=0;l<4;++l)h[1+l]=s.a.aperiodicMin+(.5*e[l]+.5)*(s.a.aperiodicMax-s.a.aperiodicMin);for(l=0;l<6;++l)h[l]=Math.pow(10,h[l]/10),h[l]=1-h[l];var f=o?this.audioParameters.singers[this.singerIndex].periodicGain.consonant:this.audioParameters.singers[this.singerIndex].periodicGain.vowel;for(l=0;l<6;++l){var d=Object(i.b)(h[l],1e-8,.999999999);d=10*Math.log10(d),d+=f[l],h[l]=Math.pow(10,d/10)}}},t.prototype.setAudioParameters=function(t){this.audioParameters=t,this.spectralGain=Object(a.b)(t.singers[this.singerIndex].spectralFilters)},t.prototype.step=function(t){for(var e=0;1!==this.module._synthHasEnoughExcitationFrames(this.synthPointer,t,this.voiceIndex)||1!==this.module._synthHasEnoughSpectralFrames(this.synthPointer,t,this.voiceIndex);){var n=null;if(0!==this.nextSpectralFrames.length){var i=this.nextSpectralFrames[0];this.lastSubsteps=i.getSubsteps(),n=this.spectralFramePointers.next(),this.setSpectralFrameData(n,i.getSpectral(),i.getMuted()),this.onFrameUsed&&this.onFrameUsed(i.buffer),this.nextSpectralFrames.splice(0,1)}else n=this.spectralFramePointers.head();for(var o=0;o<this.lastSubsteps;++o)this.module._voiceAddSpectralFrame(this.voicePointer,n);for(var r=0;r<this.lastSubsteps;++r){var a=-1,l=!1;for(o=this.overrideF0s.length-1;o>=0;--o)if(e>this.overrideF0s[o].delay){a=this.overrideF0s[o].f0,this.lastOverrideFrequency=a,l=!0;break}if(!l&&this.overrideF0s.length>0&&(a=this.overrideF0s[0].f0,this.lastOverrideFrequency=a),-1===a&&(a=this.lastOverrideFrequency),this.overrideFrequency||(a=-1),0!==this.nextExcitationFrames.length){var u=(i=this.nextExcitationFrames[0]).getF0();a>0&&(u=a),this.previousF0=u;var c=u+this.jitter.next()*u*this.audioParameters.singers[this.singerIndex].jitterScale,h=this.excitationFramePointers.next();this.setExcitationFrameData(h,i.getAperiodic(),i.getMuted(),Object(s.d)(i.getPhoneme())),this.module._voiceAddExcitationFrame(this.voicePointer,c,h),this.onFrameUsed&&this.onFrameUsed(i.buffer),this.nextExcitationFrames.splice(0,1)}else{u=this.previousF0;a>0&&(u=a),this.previousF0=u;c=u+this.jitter.next()*u*this.audioParameters.singers[this.singerIndex].jitterScale;var f=this.excitationFramePointers.head();this.module._voiceAddExcitationFrame(this.voicePointer,c,f)}e+=this.audioParameters.frameHopSeconds}}this.overrideF0s.length=0},t.prototype.addOverrideF0=function(t,e){this.overrideF0s.push({f0:t,delay:e})},t}(),c=n(5),h=n(3);var f=function(){function t(t,e,n,o,r,a,s,l,f){var d=this;this.onFrameUsed=null,this.module=e,this.sampleRate=r,this.processingSampleRate=a,this.bufferSize=f;for(var p=this.module._malloc(n.length),m=this.module.HEAPU8.subarray(p,p+n.length),g=0;g<n.length;++g)m[g]=n[g];var b,v=l.frameHopSeconds,y=v,_=(b=l.targetFFTSize*this.processingSampleRate/32e3,2*Math.ceil(b/2));this.synthPointer=this.module._createSynth(this.processingSampleRate,s,v,y,_,2,t,p,n.length);this.pans=Object(i.f)(t,0).map((function(t){return new h.a(t)})),this.voices=[];for(g=0;g<t;++g)this.voices.push(new u(e,this.synthPointer,g,g,o,this.processingSampleRate,l));for(var x=0,w=this.voices;x<w.length;x++){w[x].onFrameUsed=function(t){d.onFrameUsed&&d.onFrameUsed(t)}}this.reverbContext=e._createDCReverbContext(this.processingSampleRate);var P=e.cwrap("heavySendMessage",null,["number","string","number","number"]);for(var S in l.reverb)P(this.reverbContext,S,l.reverb[S],0);P(this.reverbContext,"init",1,0),this.module._synthSetOnlyNoise(this.synthPointer,l.noiseExcitation?1:0),this.combinedBuffer=new c.a(e,2*this.bufferSize),this.outputBuffer=new c.a(e,2*this.bufferSize),this.lastAudioProcessTime=Date.now()}return t.prototype.setPans=function(t){for(var e=0;e<t.length;++e)this.pans[e].change(t[e],.5)},t.prototype.process=function(t,e){var n=e*this.processingSampleRate/this.sampleRate;this.module._clearBuffer(this.combinedBuffer.pointer,2*n);for(var i=0;i<this.voices.length;++i){this.voices[i].step(n);var o=this.pans[i].evaluate();o=o/180*Math.PI+Math.PI/4;var r=this.voices[i].gain,a=Math.cos(o)*r,s=Math.sin(o)*r;this.module._voiceSetGain(this.voices[i].voicePointer,0,a),this.module._voiceSetGain(this.voices[i].voicePointer,1,s)}this.module._synthStep(this.synthPointer,n),this.module._copyBuffer(this.module._synthGetBuffer(this.synthPointer,0),this.combinedBuffer.pointer,n,0,1),this.module._copyBuffer(this.module._synthGetBuffer(this.synthPointer,1),this.combinedBuffer.pointer,n,n,1),this.module._reverbContextProcess(this.reverbContext,this.combinedBuffer.pointer,this.outputBuffer.pointer,n);for(var l=this.outputBuffer.getArray(),u=this.sampleRate/this.processingSampleRate,c=0;c<2;++c){var h=t[c],f=c*n;if(1===u)for(var d=0;d<e;++d)h[d]=l[f+d];else if(2===u)for(d=0;d<n;++d)h[2*d+0]=l[f+d],h[2*d+1]=0;else for(d=0;d<n;++d){h[d*u+0]=l[f+d];for(var p=1;p<u;++p)h[d*u+p]=0}}this.lastAudioProcessTime=Date.now()},t.prototype.addSpectralFrame=function(t,e){this.voices[t].pushSpectralFrame(e)},t.prototype.addExcitationFrame=function(t,e){this.voices[t].pushExcitationFrame(e)},t.prototype.setOverrideFrequency=function(t,e){this.voices[t].overrideFrequency=e},t.prototype.addOverrideF0=function(t,e){this.voices[t].addOverrideF0(e,(Date.now()-this.lastAudioProcessTime)/1e3)},t.prototype.benchmarkSpectrumGeneration=function(t){var e=performance.now();this.voices[0].module._synthBenchmarkSpectrumGeneration(this.voices[0].synthPointer,t);var n=performance.now();console.log(n-e)},t.prototype.setAudioParameters=function(t){var e=this.module.cwrap("heavySendMessage",null,["number","string","number","number"]);for(var n in t.reverb)e(this.reverbContext,n,t.reverb[n],0);for(var i=0;i<this.voices.length;++i)this.voices[i].setAudioParameters(t);this.module._synthSetOnlyNoise(this.synthPointer,t.noiseExcitation?1:0)},t}()},function(t,e,n){"use strict";t.exports=n(20)},function(t,e,n){"use strict";var i=e;function o(){i.util._configure(),i.Writer._configure(i.BufferWriter),i.Reader._configure(i.BufferReader)}i.build="minimal",i.Writer=n(14),i.BufferWriter=n(29),i.Reader=n(16),i.BufferReader=n(30),i.util=n(4),i.rpc=n(31),i.roots=n(33),i.configure=o,o()},function(t,e,n){"use strict";t.exports=function(t,e){var n=new Array(arguments.length-1),i=0,o=2,r=!0;for(;o<arguments.length;)n[i++]=arguments[o++];return new Promise((function(o,a){n[i]=function(t){if(r)if(r=!1,t)a(t);else{for(var e=new Array(arguments.length-1),n=0;n<e.length;)e[n++]=arguments[n];o.apply(null,e)}};try{t.apply(e||null,n)}catch(t){r&&(r=!1,a(t))}}))}},function(t,e,n){"use strict";var i=e;i.length=function(t){var e=t.length;if(!e)return 0;for(var n=0;--e%4>1&&"="===t.charAt(e);)++n;return Math.ceil(3*t.length)/4-n};for(var o=new Array(64),r=new Array(123),a=0;a<64;)r[o[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;i.encode=function(t,e,n){for(var i,r=null,a=[],s=0,l=0;e<n;){var u=t[e++];switch(l){case 0:a[s++]=o[u>>2],i=(3&u)<<4,l=1;break;case 1:a[s++]=o[i|u>>4],i=(15&u)<<2,l=2;break;case 2:a[s++]=o[i|u>>6],a[s++]=o[63&u],l=0}s>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,a)),s=0)}return l&&(a[s++]=o[i],a[s++]=61,1===l&&(a[s++]=61)),r?(s&&r.push(String.fromCharCode.apply(String,a.slice(0,s))),r.join("")):String.fromCharCode.apply(String,a.slice(0,s))};i.decode=function(t,e,n){for(var i,o=n,a=0,s=0;s<t.length;){var l=t.charCodeAt(s++);if(61===l&&a>1)break;if(void 0===(l=r[l]))throw Error("invalid encoding");switch(a){case 0:i=l,a=1;break;case 1:e[n++]=i<<2|(48&l)>>4,i=l,a=2;break;case 2:e[n++]=(15&i)<<4|(60&l)>>2,i=l,a=3;break;case 3:e[n++]=(3&i)<<6|l,a=0}}if(1===a)throw Error("invalid encoding");return n-o},i.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},function(t,e,n){"use strict";function i(){this._listeners={}}t.exports=i,i.prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this},i.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var n=this._listeners[t],i=0;i<n.length;)n[i].fn===e?n.splice(i,1):++i;return this},i.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<e.length;)e[i].fn.apply(e[i++].ctx,n)}return this}},function(t,e,n){"use strict";function i(t){return"undefined"!=typeof Float32Array?function(){var e=new Float32Array([-0]),n=new Uint8Array(e.buffer),i=128===n[3];function o(t,i,o){e[0]=t,i[o]=n[0],i[o+1]=n[1],i[o+2]=n[2],i[o+3]=n[3]}function r(t,i,o){e[0]=t,i[o]=n[3],i[o+1]=n[2],i[o+2]=n[1],i[o+3]=n[0]}function a(t,i){return n[0]=t[i],n[1]=t[i+1],n[2]=t[i+2],n[3]=t[i+3],e[0]}function s(t,i){return n[3]=t[i],n[2]=t[i+1],n[1]=t[i+2],n[0]=t[i+3],e[0]}t.writeFloatLE=i?o:r,t.writeFloatBE=i?r:o,t.readFloatLE=i?a:s,t.readFloatBE=i?s:a}():function(){function e(t,e,n,i){var o=e<0?1:0;if(o&&(e=-e),0===e)t(1/e>0?0:2147483648,n,i);else if(isNaN(e))t(2143289344,n,i);else if(e>34028234663852886e22)t((o<<31|2139095040)>>>0,n,i);else if(e<11754943508222875e-54)t((o<<31|Math.round(e/1401298464324817e-60))>>>0,n,i);else{var r=Math.floor(Math.log(e)/Math.LN2);t((o<<31|r+127<<23|8388607&Math.round(e*Math.pow(2,-r)*8388608))>>>0,n,i)}}function n(t,e,n){var i=t(e,n),o=2*(i>>31)+1,r=i>>>23&255,a=8388607&i;return 255===r?a?NaN:o*(1/0):0===r?1401298464324817e-60*o*a:o*Math.pow(2,r-150)*(a+8388608)}t.writeFloatLE=e.bind(null,o),t.writeFloatBE=e.bind(null,r),t.readFloatLE=n.bind(null,a),t.readFloatBE=n.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var e=new Float64Array([-0]),n=new Uint8Array(e.buffer),i=128===n[7];function o(t,i,o){e[0]=t,i[o]=n[0],i[o+1]=n[1],i[o+2]=n[2],i[o+3]=n[3],i[o+4]=n[4],i[o+5]=n[5],i[o+6]=n[6],i[o+7]=n[7]}function r(t,i,o){e[0]=t,i[o]=n[7],i[o+1]=n[6],i[o+2]=n[5],i[o+3]=n[4],i[o+4]=n[3],i[o+5]=n[2],i[o+6]=n[1],i[o+7]=n[0]}function a(t,i){return n[0]=t[i],n[1]=t[i+1],n[2]=t[i+2],n[3]=t[i+3],n[4]=t[i+4],n[5]=t[i+5],n[6]=t[i+6],n[7]=t[i+7],e[0]}function s(t,i){return n[7]=t[i],n[6]=t[i+1],n[5]=t[i+2],n[4]=t[i+3],n[3]=t[i+4],n[2]=t[i+5],n[1]=t[i+6],n[0]=t[i+7],e[0]}t.writeDoubleLE=i?o:r,t.writeDoubleBE=i?r:o,t.readDoubleLE=i?a:s,t.readDoubleBE=i?s:a}():function(){function e(t,e,n,i,o,r){var a=i<0?1:0;if(a&&(i=-i),0===i)t(0,o,r+e),t(1/i>0?0:2147483648,o,r+n);else if(isNaN(i))t(0,o,r+e),t(2146959360,o,r+n);else if(i>17976931348623157e292)t(0,o,r+e),t((a<<31|2146435072)>>>0,o,r+n);else{var s;if(i<22250738585072014e-324)t((s=i/5e-324)>>>0,o,r+e),t((a<<31|s/4294967296)>>>0,o,r+n);else{var l=Math.floor(Math.log(i)/Math.LN2);1024===l&&(l=1023),t(4503599627370496*(s=i*Math.pow(2,-l))>>>0,o,r+e),t((a<<31|l+1023<<20|1048576*s&1048575)>>>0,o,r+n)}}}function n(t,e,n,i,o){var r=t(i,o+e),a=t(i,o+n),s=2*(a>>31)+1,l=a>>>20&2047,u=4294967296*(1048575&a)+r;return 2047===l?u?NaN:s*(1/0):0===l?5e-324*s*u:s*Math.pow(2,l-1075)*(u+4503599627370496)}t.writeDoubleLE=e.bind(null,o,0,4),t.writeDoubleBE=e.bind(null,r,4,0),t.readDoubleLE=n.bind(null,a,0,4),t.readDoubleBE=n.bind(null,s,4,0)}(),t}function o(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function r(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=255&t}function a(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function s(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}t.exports=i(i)},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}module.exports=inquire},function(t,e,n){"use strict";var i=e;i.length=function(t){for(var e=0,n=0,i=0;i<t.length;++i)(n=t.charCodeAt(i))<128?e+=1:n<2048?e+=2:55296==(64512&n)&&56320==(64512&t.charCodeAt(i+1))?(++i,e+=4):e+=3;return e},i.read=function(t,e,n){if(n-e<1)return"";for(var i,o=null,r=[],a=0;e<n;)(i=t[e++])<128?r[a++]=i:i>191&&i<224?r[a++]=(31&i)<<6|63&t[e++]:i>239&&i<365?(i=((7&i)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,r[a++]=55296+(i>>10),r[a++]=56320+(1023&i)):r[a++]=(15&i)<<12|(63&t[e++])<<6|63&t[e++],a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,r)),a=0);return o?(a&&o.push(String.fromCharCode.apply(String,r.slice(0,a))),o.join("")):String.fromCharCode.apply(String,r.slice(0,a))},i.write=function(t,e,n){for(var i,o,r=n,a=0;a<t.length;++a)(i=t.charCodeAt(a))<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&56320==(64512&(o=t.charCodeAt(a+1)))?(i=65536+((1023&i)<<10)+(1023&o),++a,e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128);return n-r}},function(t,e,n){"use strict";t.exports=function(t,e,n){var i=n||8192,o=i>>>1,r=null,a=i;return function(n){if(n<1||n>o)return t(n);a+n>i&&(r=t(i),a=0);var s=e.call(r,a,a+=n);return 7&a&&(a=1+(7|a)),s}}},function(t,e,n){"use strict";t.exports=o;var i=n(4);function o(t,e){this.lo=t>>>0,this.hi=e>>>0}var r=o.zero=new o(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var a=o.zeroHash="\0\0\0\0\0\0\0\0";o.fromNumber=function(t){if(0===t)return r;var e=t<0;e&&(t=-t);var n=t>>>0,i=(t-n)/4294967296>>>0;return e&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new o(n,i)},o.from=function(t){if("number"==typeof t)return o.fromNumber(t);if(i.isString(t)){if(!i.Long)return o.fromNumber(parseInt(t,10));t=i.Long.fromString(t)}return t.low||t.high?new o(t.low>>>0,t.high>>>0):r},o.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,n=~this.hi>>>0;return e||(n=n+1>>>0),-(e+4294967296*n)}return this.lo+4294967296*this.hi},o.prototype.toLong=function(t){return i.Long?new i.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var s=String.prototype.charCodeAt;o.fromHash=function(t){return t===a?r:new o((s.call(t,0)|s.call(t,1)<<8|s.call(t,2)<<16|s.call(t,3)<<24)>>>0,(s.call(t,4)|s.call(t,5)<<8|s.call(t,6)<<16|s.call(t,7)<<24)>>>0)},o.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},o.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},o.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},o.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}},function(t,e,n){"use strict";t.exports=r;var i=n(14);(r.prototype=Object.create(i.prototype)).constructor=r;var o=n(4);function r(){i.call(this)}function a(t,e,n){t.length<40?o.utf8.write(t,e,n):e.utf8Write?e.utf8Write(t,n):e.write(t,n)}r._configure=function(){r.alloc=o._Buffer_allocUnsafe,r.writeBytesBuffer=o.Buffer&&o.Buffer.prototype instanceof Uint8Array&&"set"===o.Buffer.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var i=0;i<t.length;)e[n++]=t[i++]}},r.prototype.bytes=function(t){o.isString(t)&&(t=o._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(r.writeBytesBuffer,e,t),this},r.prototype.string=function(t){var e=o.Buffer.byteLength(t);return this.uint32(e),e&&this._push(a,e,t),this},r._configure()},function(t,e,n){"use strict";t.exports=r;var i=n(16);(r.prototype=Object.create(i.prototype)).constructor=r;var o=n(4);function r(t){i.call(this,t)}r._configure=function(){o.Buffer&&(r.prototype._slice=o.Buffer.prototype.slice)},r.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},r._configure()},function(t,e,n){"use strict";e.Service=n(32)},function(t,e,n){"use strict";t.exports=o;var i=n(4);function o(t,e,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");i.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(n)}(o.prototype=Object.create(i.EventEmitter.prototype)).constructor=o,o.prototype.rpcCall=function t(e,n,o,r,a){if(!r)throw TypeError("request must be specified");var s=this;if(!a)return i.asPromise(t,s,e,n,o,r);if(s.rpcImpl)try{return s.rpcImpl(e,n[s.requestDelimited?"encodeDelimited":"encode"](r).finish(),(function(t,n){if(t)return s.emit("error",t,e),a(t);if(null!==n){if(!(n instanceof o))try{n=o[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return s.emit("error",t,e),a(t)}return s.emit("data",n,e),a(null,n)}s.end(!0)}))}catch(t){return s.emit("error",t,e),void setTimeout((function(){a(t)}),0)}else setTimeout((function(){a(Error("already ended"))}),0)},o.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(t,e,n){"use strict";t.exports={}},,function(t,e,n){"use strict";var i=n(19),o=i.Reader,r=i.Writer,a=i.util,s=i.roots.default||(i.roots.default={});s.RecordedLibrettos=function(){function t(t){if(this.librettos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e,n;return t.prototype.librettos=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=r.create()),null!=t.librettos&&t.librettos.length)for(var n=0;n<t.librettos.length;++n)s.RecordedLibrettos.RecordedLibretto.encode(t.librettos[n],e.uint32(10).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordedLibrettos;t.pos<n;){var r=t.uint32();switch(r>>>3){case 1:i.librettos&&i.librettos.length||(i.librettos=[]),i.librettos.push(s.RecordedLibrettos.RecordedLibretto.decode(t,t.uint32()));break;default:t.skipType(7&r)}}return i},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.librettos&&t.hasOwnProperty("librettos")){if(!Array.isArray(t.librettos))return"librettos: array expected";for(var e=0;e<t.librettos.length;++e){var n=s.RecordedLibrettos.RecordedLibretto.verify(t.librettos[e]);if(n)return"librettos."+n}}return null},t.fromObject=function(t){if(t instanceof s.RecordedLibrettos)return t;var e=new s.RecordedLibrettos;if(t.librettos){if(!Array.isArray(t.librettos))throw TypeError(".RecordedLibrettos.librettos: array expected");e.librettos=[];for(var n=0;n<t.librettos.length;++n){if("object"!=typeof t.librettos[n])throw TypeError(".RecordedLibrettos.librettos: object expected");e.librettos[n]=s.RecordedLibrettos.RecordedLibretto.fromObject(t.librettos[n])}}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.librettos=[]),t.librettos&&t.librettos.length){n.librettos=[];for(var i=0;i<t.librettos.length;++i)n.librettos[i]=s.RecordedLibrettos.RecordedLibretto.toObject(t.librettos[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t.Phoneme=(e={},(n=Object.create(e))[e[0]="i"]=0,n[e[1]="a"]=1,n[e[2]="e"]=2,n[e[3]="o"]=3,n[e[4]="sil"]=4,n[e[5]="r"]=5,n[e[6]="n"]=6,n[e[7]="l"]=7,n[e[8]="t"]=8,n[e[9]="s"]=9,n[e[10]="d"]=10,n[e[11]="u"]=11,n[e[12]="m"]=12,n[e[13]="p"]=13,n[e[14]="v"]=14,n[e[15]="ch"]=15,n[e[16]="c"]=16,n[e[17]="f"]=17,n[e[18]="j"]=18,n[e[19]="b"]=19,n[e[20]="h"]=20,n[e[21]="g"]=21,n[e[22]="qu"]=22,n[e[23]="sh"]=23,n[e[24]="ny"]=24,n[e[25]="y"]=25,n[e[26]="sk"]=26,n[e[27]="z"]=27,n[e[28]="tz"]=28,n),t.Note=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.name=0,t.prototype.startTimeSeconds=0,t.prototype.endTimeSeconds=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),e.uint32(8).int32(t.name),e.uint32(21).float(t.startTimeSeconds),e.uint32(29).float(t.endTimeSeconds),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordedLibrettos.Note;t.pos<n;){var r=t.uint32();switch(r>>>3){case 1:i.name=t.int32();break;case 2:i.startTimeSeconds=t.float();break;case 3:i.endTimeSeconds=t.float();break;default:t.skipType(7&r)}}if(!i.hasOwnProperty("name"))throw a.ProtocolError("missing required 'name'",{instance:i});if(!i.hasOwnProperty("startTimeSeconds"))throw a.ProtocolError("missing required 'startTimeSeconds'",{instance:i});if(!i.hasOwnProperty("endTimeSeconds"))throw a.ProtocolError("missing required 'endTimeSeconds'",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";switch(t.name){default:return"name: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:}return"number"!=typeof t.startTimeSeconds?"startTimeSeconds: number expected":"number"!=typeof t.endTimeSeconds?"endTimeSeconds: number expected":null},t.fromObject=function(t){if(t instanceof s.RecordedLibrettos.Note)return t;var e=new s.RecordedLibrettos.Note;switch(t.name){case"i":case 0:e.name=0;break;case"a":case 1:e.name=1;break;case"e":case 2:e.name=2;break;case"o":case 3:e.name=3;break;case"sil":case 4:e.name=4;break;case"r":case 5:e.name=5;break;case"n":case 6:e.name=6;break;case"l":case 7:e.name=7;break;case"t":case 8:e.name=8;break;case"s":case 9:e.name=9;break;case"d":case 10:e.name=10;break;case"u":case 11:e.name=11;break;case"m":case 12:e.name=12;break;case"p":case 13:e.name=13;break;case"v":case 14:e.name=14;break;case"ch":case 15:e.name=15;break;case"c":case 16:e.name=16;break;case"f":case 17:e.name=17;break;case"j":case 18:e.name=18;break;case"b":case 19:e.name=19;break;case"h":case 20:e.name=20;break;case"g":case 21:e.name=21;break;case"qu":case 22:e.name=22;break;case"sh":case 23:e.name=23;break;case"ny":case 24:e.name=24;break;case"y":case 25:e.name=25;break;case"sk":case 26:e.name=26;break;case"z":case 27:e.name=27;break;case"tz":case 28:e.name=28}return null!=t.startTimeSeconds&&(e.startTimeSeconds=Number(t.startTimeSeconds)),null!=t.endTimeSeconds&&(e.endTimeSeconds=Number(t.endTimeSeconds)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.name=e.enums===String?"i":0,n.startTimeSeconds=0,n.endTimeSeconds=0),null!=t.name&&t.hasOwnProperty("name")&&(n.name=e.enums===String?s.RecordedLibrettos.Phoneme[t.name]:t.name),null!=t.startTimeSeconds&&t.hasOwnProperty("startTimeSeconds")&&(n.startTimeSeconds=e.json&&!isFinite(t.startTimeSeconds)?String(t.startTimeSeconds):t.startTimeSeconds),null!=t.endTimeSeconds&&t.hasOwnProperty("endTimeSeconds")&&(n.endTimeSeconds=e.json&&!isFinite(t.endTimeSeconds)?String(t.endTimeSeconds):t.endTimeSeconds),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t.RecordedLibretto=function(){function t(t){if(this.notes=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.notes=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=r.create()),null!=t.notes&&t.notes.length)for(var n=0;n<t.notes.length;++n)s.RecordedLibrettos.Note.encode(t.notes[n],e.uint32(10).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordedLibrettos.RecordedLibretto;t.pos<n;){var r=t.uint32();switch(r>>>3){case 1:i.notes&&i.notes.length||(i.notes=[]),i.notes.push(s.RecordedLibrettos.Note.decode(t,t.uint32()));break;default:t.skipType(7&r)}}return i},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.notes&&t.hasOwnProperty("notes")){if(!Array.isArray(t.notes))return"notes: array expected";for(var e=0;e<t.notes.length;++e){var n=s.RecordedLibrettos.Note.verify(t.notes[e]);if(n)return"notes."+n}}return null},t.fromObject=function(t){if(t instanceof s.RecordedLibrettos.RecordedLibretto)return t;var e=new s.RecordedLibrettos.RecordedLibretto;if(t.notes){if(!Array.isArray(t.notes))throw TypeError(".RecordedLibrettos.RecordedLibretto.notes: array expected");e.notes=[];for(var n=0;n<t.notes.length;++n){if("object"!=typeof t.notes[n])throw TypeError(".RecordedLibrettos.RecordedLibretto.notes: object expected");e.notes[n]=s.RecordedLibrettos.Note.fromObject(t.notes[n])}}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.notes=[]),t.notes&&t.notes.length){n.notes=[];for(var i=0;i<t.notes.length;++i)n.notes[i]=s.RecordedLibrettos.Note.toObject(t.notes[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t}(),t.exports=s},function(t,e,n){"use strict";var i=n(19),o=i.Reader,r=i.Writer,a=i.util,s=i.roots.default||(i.roots.default={});s.RecordingMessage=function(){function t(t){if(this.parts=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e,n;return t.prototype.theme=0,t.prototype.parts=a.emptyArray,t.prototype.location=0,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=r.create()),e.uint32(8).int32(t.theme),null!=t.parts&&t.parts.length)for(var n=0;n<t.parts.length;++n)s.RecordingMessage.Part.encode(t.parts[n],e.uint32(18).fork()).ldelim();return null!=t.location&&Object.hasOwnProperty.call(t,"location")&&e.uint32(24).int32(t.location),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordingMessage;t.pos<n;){var r=t.uint32();switch(r>>>3){case 1:i.theme=t.int32();break;case 2:i.parts&&i.parts.length||(i.parts=[]),i.parts.push(s.RecordingMessage.Part.decode(t,t.uint32()));break;case 3:i.location=t.int32();break;default:t.skipType(7&r)}}if(!i.hasOwnProperty("theme"))throw a.ProtocolError("missing required 'theme'",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";switch(t.theme){default:return"theme: enum value expected";case 0:case 1:}if(null!=t.parts&&t.hasOwnProperty("parts")){if(!Array.isArray(t.parts))return"parts: array expected";for(var e=0;e<t.parts.length;++e){var n=s.RecordingMessage.Part.verify(t.parts[e]);if(n)return"parts."+n}}if(null!=t.location&&t.hasOwnProperty("location"))switch(t.location){default:return"location: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:}return null},t.fromObject=function(t){if(t instanceof s.RecordingMessage)return t;var e=new s.RecordingMessage;switch(t.theme){case"Normal":case 0:e.theme=0;break;case"Festive":case 1:e.theme=1}if(t.parts){if(!Array.isArray(t.parts))throw TypeError(".RecordingMessage.parts: array expected");e.parts=[];for(var n=0;n<t.parts.length;++n){if("object"!=typeof t.parts[n])throw TypeError(".RecordingMessage.parts: object expected");e.parts[n]=s.RecordingMessage.Part.fromObject(t.parts[n])}}switch(t.location){case"BlobperaHouse":case 0:e.location=0;break;case"London":case 1:e.location=1;break;case"NewYork":case 2:e.location=2;break;case"Hackney":case 3:e.location=3;break;case"Paris":case 4:e.location=4;break;case"CapeTown":case 5:e.location=5;break;case"MexicoCity":case 6:e.location=6;break;case"Seoul":case 7:e.location=7}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.parts=[]),e.defaults&&(n.theme=e.enums===String?"Normal":0,n.location=e.enums===String?"BlobperaHouse":0),null!=t.theme&&t.hasOwnProperty("theme")&&(n.theme=e.enums===String?s.RecordingMessage.Theme[t.theme]:t.theme),t.parts&&t.parts.length){n.parts=[];for(var i=0;i<t.parts.length;++i)n.parts[i]=s.RecordingMessage.Part.toObject(t.parts[i],e)}return null!=t.location&&t.hasOwnProperty("location")&&(n.location=e.enums===String?s.RecordingMessage.Location[t.location]:t.location),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t.Phoneme=(e={},(n=Object.create(e))[e[0]="i"]=0,n[e[1]="a"]=1,n[e[2]="e"]=2,n[e[3]="o"]=3,n[e[4]="sil"]=4,n[e[5]="r"]=5,n[e[6]="n"]=6,n[e[7]="l"]=7,n[e[8]="t"]=8,n[e[9]="s"]=9,n[e[10]="d"]=10,n[e[11]="u"]=11,n[e[12]="m"]=12,n[e[13]="p"]=13,n[e[14]="v"]=14,n[e[15]="ch"]=15,n[e[16]="c"]=16,n[e[17]="f"]=17,n[e[18]="j"]=18,n[e[19]="b"]=19,n[e[20]="h"]=20,n[e[21]="g"]=21,n[e[22]="qu"]=22,n[e[23]="sh"]=23,n[e[24]="ny"]=24,n[e[25]="y"]=25,n[e[26]="sk"]=26,n[e[27]="z"]=27,n[e[28]="tz"]=28,n),t.PhonemeWithDuration=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.name=0,t.prototype.duration=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),e.uint32(8).int32(t.name),e.uint32(21).float(t.duration),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordingMessage.PhonemeWithDuration;t.pos<n;){var r=t.uint32();switch(r>>>3){case 1:i.name=t.int32();break;case 2:i.duration=t.float();break;default:t.skipType(7&r)}}if(!i.hasOwnProperty("name"))throw a.ProtocolError("missing required 'name'",{instance:i});if(!i.hasOwnProperty("duration"))throw a.ProtocolError("missing required 'duration'",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";switch(t.name){default:return"name: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:}return"number"!=typeof t.duration?"duration: number expected":null},t.fromObject=function(t){if(t instanceof s.RecordingMessage.PhonemeWithDuration)return t;var e=new s.RecordingMessage.PhonemeWithDuration;switch(t.name){case"i":case 0:e.name=0;break;case"a":case 1:e.name=1;break;case"e":case 2:e.name=2;break;case"o":case 3:e.name=3;break;case"sil":case 4:e.name=4;break;case"r":case 5:e.name=5;break;case"n":case 6:e.name=6;break;case"l":case 7:e.name=7;break;case"t":case 8:e.name=8;break;case"s":case 9:e.name=9;break;case"d":case 10:e.name=10;break;case"u":case 11:e.name=11;break;case"m":case 12:e.name=12;break;case"p":case 13:e.name=13;break;case"v":case 14:e.name=14;break;case"ch":case 15:e.name=15;break;case"c":case 16:e.name=16;break;case"f":case 17:e.name=17;break;case"j":case 18:e.name=18;break;case"b":case 19:e.name=19;break;case"h":case 20:e.name=20;break;case"g":case 21:e.name=21;break;case"qu":case 22:e.name=22;break;case"sh":case 23:e.name=23;break;case"ny":case 24:e.name=24;break;case"y":case 25:e.name=25;break;case"sk":case 26:e.name=26;break;case"z":case 27:e.name=27;break;case"tz":case 28:e.name=28}return null!=t.duration&&(e.duration=Number(t.duration)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.name=e.enums===String?"i":0,n.duration=0),null!=t.name&&t.hasOwnProperty("name")&&(n.name=e.enums===String?s.RecordingMessage.Phoneme[t.name]:t.name),null!=t.duration&&t.hasOwnProperty("duration")&&(n.duration=e.json&&!isFinite(t.duration)?String(t.duration):t.duration),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t.LibrettoChunk=function(){function t(t){if(this.suffix=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.vowel=null,t.prototype.suffix=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=r.create()),s.RecordingMessage.PhonemeWithDuration.encode(t.vowel,e.uint32(10).fork()).ldelim(),null!=t.suffix&&t.suffix.length)for(var n=0;n<t.suffix.length;++n)s.RecordingMessage.PhonemeWithDuration.encode(t.suffix[n],e.uint32(18).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordingMessage.LibrettoChunk;t.pos<n;){var r=t.uint32();switch(r>>>3){case 1:i.vowel=s.RecordingMessage.PhonemeWithDuration.decode(t,t.uint32());break;case 2:i.suffix&&i.suffix.length||(i.suffix=[]),i.suffix.push(s.RecordingMessage.PhonemeWithDuration.decode(t,t.uint32()));break;default:t.skipType(7&r)}}if(!i.hasOwnProperty("vowel"))throw a.ProtocolError("missing required 'vowel'",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(n=s.RecordingMessage.PhonemeWithDuration.verify(t.vowel))return"vowel."+n;if(null!=t.suffix&&t.hasOwnProperty("suffix")){if(!Array.isArray(t.suffix))return"suffix: array expected";for(var e=0;e<t.suffix.length;++e){var n;if(n=s.RecordingMessage.PhonemeWithDuration.verify(t.suffix[e]))return"suffix."+n}}return null},t.fromObject=function(t){if(t instanceof s.RecordingMessage.LibrettoChunk)return t;var e=new s.RecordingMessage.LibrettoChunk;if(null!=t.vowel){if("object"!=typeof t.vowel)throw TypeError(".RecordingMessage.LibrettoChunk.vowel: object expected");e.vowel=s.RecordingMessage.PhonemeWithDuration.fromObject(t.vowel)}if(t.suffix){if(!Array.isArray(t.suffix))throw TypeError(".RecordingMessage.LibrettoChunk.suffix: array expected");e.suffix=[];for(var n=0;n<t.suffix.length;++n){if("object"!=typeof t.suffix[n])throw TypeError(".RecordingMessage.LibrettoChunk.suffix: object expected");e.suffix[n]=s.RecordingMessage.PhonemeWithDuration.fromObject(t.suffix[n])}}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.suffix=[]),e.defaults&&(n.vowel=null),null!=t.vowel&&t.hasOwnProperty("vowel")&&(n.vowel=s.RecordingMessage.PhonemeWithDuration.toObject(t.vowel,e)),t.suffix&&t.suffix.length){n.suffix=[];for(var i=0;i<t.suffix.length;++i)n.suffix[i]=s.RecordingMessage.PhonemeWithDuration.toObject(t.suffix[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t.Note=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.timeSeconds=0,t.prototype.midiPitch=0,t.prototype.librettoChunk=null,t.prototype.controlled=!1,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),e.uint32(13).float(t.timeSeconds),e.uint32(21).float(t.midiPitch),s.RecordingMessage.LibrettoChunk.encode(t.librettoChunk,e.uint32(26).fork()).ldelim(),null!=t.controlled&&Object.hasOwnProperty.call(t,"controlled")&&e.uint32(32).bool(t.controlled),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordingMessage.Note;t.pos<n;){var r=t.uint32();switch(r>>>3){case 1:i.timeSeconds=t.float();break;case 2:i.midiPitch=t.float();break;case 3:i.librettoChunk=s.RecordingMessage.LibrettoChunk.decode(t,t.uint32());break;case 4:i.controlled=t.bool();break;default:t.skipType(7&r)}}if(!i.hasOwnProperty("timeSeconds"))throw a.ProtocolError("missing required 'timeSeconds'",{instance:i});if(!i.hasOwnProperty("midiPitch"))throw a.ProtocolError("missing required 'midiPitch'",{instance:i});if(!i.hasOwnProperty("librettoChunk"))throw a.ProtocolError("missing required 'librettoChunk'",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if("number"!=typeof t.timeSeconds)return"timeSeconds: number expected";if("number"!=typeof t.midiPitch)return"midiPitch: number expected";var e=s.RecordingMessage.LibrettoChunk.verify(t.librettoChunk);return e?"librettoChunk."+e:null!=t.controlled&&t.hasOwnProperty("controlled")&&"boolean"!=typeof t.controlled?"controlled: boolean expected":null},t.fromObject=function(t){if(t instanceof s.RecordingMessage.Note)return t;var e=new s.RecordingMessage.Note;if(null!=t.timeSeconds&&(e.timeSeconds=Number(t.timeSeconds)),null!=t.midiPitch&&(e.midiPitch=Number(t.midiPitch)),null!=t.librettoChunk){if("object"!=typeof t.librettoChunk)throw TypeError(".RecordingMessage.Note.librettoChunk: object expected");e.librettoChunk=s.RecordingMessage.LibrettoChunk.fromObject(t.librettoChunk)}return null!=t.controlled&&(e.controlled=Boolean(t.controlled)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.timeSeconds=0,n.midiPitch=0,n.librettoChunk=null,n.controlled=!1),null!=t.timeSeconds&&t.hasOwnProperty("timeSeconds")&&(n.timeSeconds=e.json&&!isFinite(t.timeSeconds)?String(t.timeSeconds):t.timeSeconds),null!=t.midiPitch&&t.hasOwnProperty("midiPitch")&&(n.midiPitch=e.json&&!isFinite(t.midiPitch)?String(t.midiPitch):t.midiPitch),null!=t.librettoChunk&&t.hasOwnProperty("librettoChunk")&&(n.librettoChunk=s.RecordingMessage.LibrettoChunk.toObject(t.librettoChunk,e)),null!=t.controlled&&t.hasOwnProperty("controlled")&&(n.controlled=t.controlled),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t.Part=function(){function t(t){if(this.notes=[],this.startSuffix=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.notes=a.emptyArray,t.prototype.startSuffix=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=r.create()),null!=t.notes&&t.notes.length)for(var n=0;n<t.notes.length;++n)s.RecordingMessage.Note.encode(t.notes[n],e.uint32(10).fork()).ldelim();if(null!=t.startSuffix&&t.startSuffix.length)for(n=0;n<t.startSuffix.length;++n)s.RecordingMessage.PhonemeWithDuration.encode(t.startSuffix[n],e.uint32(18).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordingMessage.Part;t.pos<n;){var r=t.uint32();switch(r>>>3){case 1:i.notes&&i.notes.length||(i.notes=[]),i.notes.push(s.RecordingMessage.Note.decode(t,t.uint32()));break;case 2:i.startSuffix&&i.startSuffix.length||(i.startSuffix=[]),i.startSuffix.push(s.RecordingMessage.PhonemeWithDuration.decode(t,t.uint32()));break;default:t.skipType(7&r)}}return i},t.decodeDelimited=function(t){return t instanceof o||(t=new o(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.notes&&t.hasOwnProperty("notes")){if(!Array.isArray(t.notes))return"notes: array expected";for(var e=0;e<t.notes.length;++e){if(n=s.RecordingMessage.Note.verify(t.notes[e]))return"notes."+n}}if(null!=t.startSuffix&&t.hasOwnProperty("startSuffix")){if(!Array.isArray(t.startSuffix))return"startSuffix: array expected";for(e=0;e<t.startSuffix.length;++e){var n;if(n=s.RecordingMessage.PhonemeWithDuration.verify(t.startSuffix[e]))return"startSuffix."+n}}return null},t.fromObject=function(t){if(t instanceof s.RecordingMessage.Part)return t;var e=new s.RecordingMessage.Part;if(t.notes){if(!Array.isArray(t.notes))throw TypeError(".RecordingMessage.Part.notes: array expected");e.notes=[];for(var n=0;n<t.notes.length;++n){if("object"!=typeof t.notes[n])throw TypeError(".RecordingMessage.Part.notes: object expected");e.notes[n]=s.RecordingMessage.Note.fromObject(t.notes[n])}}if(t.startSuffix){if(!Array.isArray(t.startSuffix))throw TypeError(".RecordingMessage.Part.startSuffix: array expected");e.startSuffix=[];for(n=0;n<t.startSuffix.length;++n){if("object"!=typeof t.startSuffix[n])throw TypeError(".RecordingMessage.Part.startSuffix: object expected");e.startSuffix[n]=s.RecordingMessage.PhonemeWithDuration.fromObject(t.startSuffix[n])}}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.notes=[],n.startSuffix=[]),t.notes&&t.notes.length){n.notes=[];for(var i=0;i<t.notes.length;++i)n.notes[i]=s.RecordingMessage.Note.toObject(t.notes[i],e)}if(t.startSuffix&&t.startSuffix.length){n.startSuffix=[];for(i=0;i<t.startSuffix.length;++i)n.startSuffix[i]=s.RecordingMessage.PhonemeWithDuration.toObject(t.startSuffix[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t.Theme=function(){var t={},e=Object.create(t);return e[t[0]="Normal"]=0,e[t[1]="Festive"]=1,e}(),t.Location=function(){var t={},e=Object.create(t);return e[t[0]="BlobperaHouse"]=0,e[t[1]="London"]=1,e[t[2]="NewYork"]=2,e[t[3]="Hackney"]=3,e[t[4]="Paris"]=4,e[t[5]="CapeTown"]=5,e[t[6]="MexicoCity"]=6,e[t[7]="Seoul"]=7,e}(),t}(),t.exports=s},function(t,e,n){"use strict";var i=n(40),o=n.n(i)()((function(t){return t[1]}));o.push([t.i,'html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:"";content:none}table{border-collapse:collapse;border-spacing:0}.prompt{position:fixed;color:#000;font-weight:300;font-size:16px;line-height:20px;padding:10px;text-align:center;background:#ffffffcc;border-radius:10px;z-index:1}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.prompt{font-size:12px;line-height:16px;padding:6px}}.voice-prompt{will-change:transform;transform:translateZ(0)}#pitch-prompt{will-change:transform;transform:translateZ(0)}.voice-prompt span{font-weight:800}#pitch-prompt-pitch{font-weight:400;transition:font-weight .1s linear}#pitch-prompt-pitch.sounding{font-weight:600}.prompt-right-arrow{margin-left:10px}.prompt-right-arrow:after{position:absolute;left:100%;border-top:5px solid transparent;border-bottom:5px solid transparent;border-left:5px solid #ffffffcc;content:" ";margin-top:-5px;top:50%}.prompt-left-arrow{margin-right:10px}.prompt-left-arrow:after{position:absolute;right:100%;border-top:5px solid transparent;border-bottom:5px solid transparent;border-right:5px solid #ffffffcc;content:" ";margin-top:-5px;top:50%}.prompt-bottom-arrow:after{position:absolute;top:100%;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid #ffffffcc;content:" ";margin-left:-5px;left:50%}#vowel-prompt{transform:translate(-50%, 0)}#vowel-prompt-vowel{font-weight:400;transition:font-weight .1s linear}#vowel-prompt-vowel.sounding{font-weight:600}#stop-recording-prompt{left:90px;bottom:45px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#stop-recording-prompt{left:75px;bottom:40px}}.share-prompt{bottom:100px;left:105px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.share-prompt{left:85px;bottom:80px}}.share-prompt:after{left:25px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.share-prompt:after{left:15px}}#festive-prompt{bottom:85px;right:10px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#festive-prompt{bottom:75px;right:5px}}#festive-prompt:after{left:auto;right:30px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#festive-prompt:after{right:20px}}#carols-prompt{bottom:100px;right:20px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#carols-prompt{bottom:80px;right:10px}}#carols-prompt:after{left:auto;right:80px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#carols-prompt:after{right:70px}}#location-selection-prompt{bottom:100px;right:22px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#location-selection-prompt{bottom:100px;right:27px}}#location-selection-prompt:after{left:auto;right:30px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#location-selection-prompt:after{right:20px}}#location-songs-prompt{bottom:100px;right:81px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#location-songs-prompt{bottom:101px;right:56px}}#location-songs-prompt:after{left:auto;right:30px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#location-songs-prompt:after{right:49px}}#loading{width:300px;margin:30px auto 0 auto;color:#fff;text-align:center}.loading-visible{-moz-animation:fade .3s;-webkit-animation:fade .3s;animation:fade .3s;opacity:1}.loading-hidden{-moz-animation:fade-out .3s !important;-webkit-animation:fade-out .3s !important;animation:fade-out .3s !important;opacity:0}#loading-bar{width:200px;height:15px;margin:0 auto 0 auto;border-width:1px;border-style:solid;border-color:#fff;border-radius:15px;overflow:hidden;transition:width .3s,height .3s,margin .3s,border-radius .3s,border-color .3s}#loading-fill{background-color:#fff;height:100%;width:0%;transition:background-color .3s linear,width .2s linear;position:relative;overflow:hidden}.loading-button{width:120px !important;height:50px !important;margin-top:-10px !important;border-radius:25px !important;border-color:transparent !important;cursor:pointer;pointer-events:auto;-webkit-tap-highlight-color:rgba(255,255,255,0)}.loading-button #loading-fill{background:#22b82e;box-shadow:0px 0px 6px #0000008e}#loading-play{position:absolute;height:30px;width:100%;top:50%;margin-top:-15px;line-height:30px;text-align:center;color:#fff;font-size:20px;opacity:0;display:none}.loading-button #loading-play{display:block !important}.loading-button #loading-fill #loading-play{opacity:1 !important}#audio-prompt{font-weight:200;font-size:16px;margin-top:20px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#audio-prompt{font-size:14px}}#silent-hint{display:none;font-weight:100}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#silent-hint{font-size:14px}}.silent-hint-show{display:block !important}#error{text-align:center;font-size:20px}#disclaimer{position:fixed;left:20px;bottom:20px;right:20px;color:#fff;text-align:center}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#disclaimer{font-size:14px;left:10px;right:10px;bottom:10px}}#info-overlay{top:0;left:0;background:#000000cc;position:fixed;width:100%;height:100%;overflow:auto}#info-container{margin:100px auto;padding:20px;max-width:500px;color:#fff;font-weight:300;font-size:16px;line-height:20px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#info-container{margin:10px auto;font-size:12px;line-height:14px}}#info-container p{margin-top:1em}#info-container span{font-weight:bold}#info-container a{color:#fff}#info-container a:visited{color:#fff}#info-title{color:#fff;font-size:24px;margin-bottom:1em}#info-title-image{width:auto;height:auto;max-width:180px}#close-info{color:#000;position:relative;margin-top:40px}.menu-container{bottom:95px;right:20px;width:250px;position:fixed;color:#000;font-weight:300;font-size:14px;text-align:left;background:#ffffffcc;padding:5px;border-radius:10px;white-space:nowrap;z-index:100}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.menu-container{left:50%;margin-left:-125px;font-size:12px}}.menu-container:after{left:auto;right:80px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.menu-container:after{display:none}}.menu-container .menu-items .material-icons{vertical-align:middle;padding-bottom:3px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.menu-container .menu-items .material-icons{font-size:18px}}.menu-container .menu-items li{position:relative;padding:5px;border-top:1px solid #aaa;cursor:pointer;transition:background-color .1s linear}.menu-container .menu-items li:first-child{border-top:none}@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.menu-container .menu-items li .spinner{position:absolute;width:12px;height:12px;left:3px;top:3px;border-radius:50%;border:3px solid currentColor;border-top-color:currentcolor;border-right-color:currentcolor;border-bottom-color:currentcolor;border-left-color:currentcolor;border-color:currentColor transparent currentColor transparent;display:none}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.menu-container .menu-items li .spinner{left:0;top:0}}.menu-container .menu-items li.loading .spinner{display:block;animation:spin 1.2s linear infinite}.menu-container .menu-items li.loading .material-icons{opacity:0}.menu-container .menu-items .song-name{margin-left:5px}.menu-container .menu-items .song-description{display:block;margin-left:32px;margin-bottom:5px;color:#666}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.menu-container .menu-items .song-description{margin-left:25px}}.menu-container .menu-items .song-description.hidden{display:none}.menu-container .menu-items .loaded,.menu-container .menu-items .playing{color:#22b82e}.menu-items .list-item-icon{display:inline-block;position:relative;top:1px}#location-songs.menu-items .list-item-icon{top:11px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#location-songs.menu-items .list-item-icon{top:9px}}.festive-button{position:fixed;width:55px;height:55px;line-height:55px;border-radius:50%;box-shadow:0px 0px 12px #00000063;background-color:#eee;cursor:pointer;transition:background-color .1s linear,box-shadow .1s linear,fill .1s linear,#fff .1s linear;color:#000;text-align:center;user-select:none}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.festive-button{width:40px;height:40px;line-height:40px}}.festive-button.depressed{color:#fff;background-color:#666}#festive-playlist{right:80px;bottom:30px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#festive-playlist{right:65px;bottom:30px}}#festive-songs-container{bottom:95px;right:20px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#festive-songs-container{left:50%;margin-left:-125px;font-size:12px}}#festive-songs-container:after{left:auto;right:80px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#festive-songs-container:after{display:none}}#festive-switch-container{position:absolute;right:20px;bottom:45px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#festive-switch-container{right:10px;bottom:40px}}.switch{position:relative;display:inline-block;width:48px;height:20px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#eee;-webkit-transition:.4s;transition:.4s;border-radius:34px}.slider:before{position:absolute;content:"";height:32px;width:32px;left:0px;bottom:-6px;background-color:#fff;box-shadow:0px 0px 12px #00000063;-webkit-transition:.4s;transition:125ms;border-radius:50%;background-image:url("/blob-opera/tree.svg");background-repeat:no-repeat;background-position:center}input:checked+.slider:before{background-color:#22b82e}input:checked+.slider{background-color:#afdab3}input:focus+.slider{box-shadow:0 0 1px #afdab3}input:checked+.slider:before{-webkit-transform:translateX(19px);-ms-transform:translateX(19px);transform:translateX(19px)}.location-button{width:55px;height:55px;line-height:55px;background-color:#eee;border-radius:27.5px;box-shadow:0px 0px 12px #00000063;cursor:pointer;transition:background-color .1s linear,box-shadow .1s linear,fill .1s linear,#fff .1s linear;color:#000;text-align:center;user-select:none}.playlist-button{position:absolute;top:6px;left:5px;width:44px;height:44px;line-height:44px;background-color:#eee;border-radius:22px;box-shadow:0px 0px 12px #00000063;cursor:pointer;transition:background-color .1s linear,box-shadow .1s linear,fill .1s linear,#fff .1s linear;color:#000;text-align:center;user-select:none}.location-button.depressed,.playlist-button.depressed{color:#fff;background-color:#666}#location-selector-button{position:fixed;right:30px;bottom:30px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#location-selector-button{right:25px;bottom:30px}}#location-selector-container{bottom:95px;right:20px;width:250px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#location-selector-container{left:50%;margin-left:-125px;font-size:12px}}#location-selector-container:after{left:auto;right:33px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#location-selector-container:after{display:none}}#location-playlist-tray{position:fixed;width:112px;height:55px;line-height:55px;right:30px;bottom:30px;background-color:#333333cc;border-radius:55px;box-shadow:0px 0px 12px #00000063;cursor:pointer;transition:background-color .1s linear,box-shadow .1s linear,fill .1s linear,#fff .1s linear;color:#000;text-align:center;user-select:none;text-align:left}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#location-playlist-tray{right:25px;bottom:30px}}#location-label{position:absolute;top:6px;left:30px;color:#fff;display:none}#location-songs-container.menu-container:after{right:91px}.indicator{position:fixed;width:20px;height:20px;border-radius:20px;margin-left:-10px;margin-top:-10px;left:0;right:0;opacity:0;transition:opacity .2s linear;pointer-events:none;border:2px solid #fff}.indicator.active{opacity:1}#multiplayer-container{position:absolute;right:170px;bottom:10px;pointer-events:none;text-align:center;width:80px}#multiplayer-status{background:#00000080;padding:8px 10px;display:inline-block;vertical-align:middle;margin-bottom:5px}#multiplayer-people-label{font-weight:300;color:#fff;font-weight:200;margin-top:10px}#multiplayer-people{margin-left:-100%;margin-right:-100%;white-space:nowrap}.multiplayer-person{font-family:"Material Icons";vertical-align:middle;transition:width .3s linear,height .3s linear,margin .3s linear,opacity .2s linear;animation:slidein .3s forwards;opacity:.4;overflow:hidden}.multiplayer-person.self{-webkit-text-stroke:1px #fff}.multiplayer-person.inactive{animation:slideout .3s forwards}.multiplayer-person.connected{opacity:1}@keyframes slidein{from{font-size:0px}to{font-size:30px}}@keyframes slideout{from{font-size:30px}to{font-size:0px}}.tutorial-prompt{position:fixed;color:#fff;font-size:24px;top:20%;text-align:center;width:90%;padding:0 5% 0 5%}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.tutorial-prompt{font-size:16px}}body{margin:0;padding:0;overflow:hidden;font-family:"Google Sans",sans-serif;width:100%;height:100%;background:url("/blob-opera/background.jpg") no-repeat center center fixed,#000;-webkit-background-size:cover;-moz-background-size:cover;-o-background-size:cover;background-size:cover}#skip{position:fixed;bottom:20px;right:20px;font-size:16px;font-weight:300;cursor:pointer;color:#fff}.hideable-clickable{opacity:0;pointer-events:none;transition:opacity .2s}.hideable-clickable.visible{opacity:1;pointer-events:auto}.hideable-unclickable{opacity:0;pointer-events:none;transition:opacity .4s}.hideable-unclickable.visible{opacity:1}#intro{font-size:21px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#intro{font-size:16px}}#title{margin-top:20px}.title{color:#fff;pointer-events:none}#title-image{width:auto;height:auto;max-width:455px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#title-image{max-width:300px}}#splash{position:fixed;width:100%;top:25%;text-align:center;color:#fff}#tagline{font-weight:200;margin-top:20px;font-size:21px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#tagline{font-size:16px}}#title-small{position:fixed;font-size:32px;left:20px;top:20px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#title-small{left:10px;font-size:24px}}#title-small-image{width:auto;height:auto;max-width:180px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#title-small-image{max-width:120px}}#record-container{left:10px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#record-container{left:0px}}#record,#stop-record{position:absolute;border-width:6px;border-style:solid;border-color:#fff;bottom:24px;width:46px;height:46px;border-radius:50%;box-shadow:0px 0px 12px #00000063;cursor:pointer;left:50%;transform:translate(-50%, 0)}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#record,#stop-record{width:36px;height:36px;bottom:20px;border-width:5px}}@keyframes pulse{from{border-color:#fff}50%{border-color:#ffffffcc}to{border-color:#fff}}#record-start{position:absolute;width:40px;height:40px;border-radius:50%;background:#ff3030;margin:0 auto;position:absolute;left:50%;top:50%;transform:translate(-50%, -50%);box-shadow:0px 0px 12px #00000063;transition:width .1s linear,height .1s linear,border-radius .1s linear}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#record-start{width:30px;height:30px}}.recording #record-start{width:20px;height:20px;border-radius:0}#stop-recording-container{left:50%;margin-left:-40px}#record-text{opacity:1}.recording #record-text{opacity:0}#finish-text{opacity:0}.recording #finish-text{opacity:1}.timecode{transition:opacity .1s linear;opacity:0;position:absolute;top:-35px;text-align:center;pointer-events:none;width:100%;font-size:14px;font-family:"Roboto Mono",monospace;color:#fff;padding:5px 0 5px 0;border-radius:10px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.timecode{font-size:12px;top:-10px;width:90%;left:10%}}#recording-timecode{background:#ff3030}.recording #recording-timecode{opacity:1}#playback-timecode{opacity:1;background:#0000008a}.button-container{position:fixed;bottom:10px;width:80px;height:80px}.button{width:55px;height:55px;line-height:55px;border-radius:27.5px;text-align:center;position:absolute;bottom:24px;left:50%;transform:translate(-50%, 0);box-shadow:0px 0px 12px #00000063;background-color:#eee;cursor:pointer;transition:background-color .1s linear,box-shadow .1s linear;user-select:none}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.button{font-size:18px;width:40px;height:40px;line-height:40px;bottom:20px}}.button-text{position:absolute;text-align:center;color:#fff;font-weight:200;bottom:0;pointer-events:none;width:100%;transition:opacity .1s linear;user-select:none;font-size:16px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.button-text{font-size:14px;font-weight:300}}#save-container{left:90px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#save-container{left:60px}}#save-text{opacity:1}.saving #save-text{opacity:0}#saving-text{opacity:0}.saving #saving-text{opacity:1}#discard-container{left:160px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#discard-container{left:110px}}#startstop-container{left:10px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#startstop-container{left:0px}}#recording-copy-link-container{left:90px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#recording-copy-link-container{left:60px}}.copy-link-text{opacity:1}.copying .copy-link-text{opacity:0}.copying-link-text{opacity:0}.copying .copying-link-text{opacity:1}#back-container{left:160px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#back-container{left:110px}}#startstop{position:absolute;bottom:31px;left:50%;transform:translate(-50%, 0);width:40px;height:40px;border-radius:50%;box-shadow:0px 0px 12px #00000063;background-color:#eee;cursor:pointer;transition:background-color .1s linear,box-shadow .1s linear}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#startstop{width:30px;height:30px;bottom:28px}}.playing #startstop-stop{opacity:1}.playing #startstop-play{opacity:0}#startstop-stop{position:absolute;background:#333;width:15px;height:15px;left:50%;top:50%;transform:translate(-50%, -50%);transition:opacity .1s linear;opacity:0}#startstop-ring{width:58px;height:58px;border-radius:50%;box-shadow:0px 0px 12px #00000063;position:absolute;left:50%;bottom:22px;transform:translate(-50%, 0%)}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#startstop-ring{width:46px;height:46px;bottom:20px}}#startstop-play{position:absolute;width:0;height:0;left:50%;top:50%;transform:translate(-40%, -50%);border-radius:2px;border-top:10px solid transparent;border-bottom:10px solid transparent;border-left:15px solid #333;transition:opacity .1s linear;opacity:1}#play-text{opacity:1}.playing #play-text{opacity:0}#stop-text{opacity:0}.playing #stop-text{opacity:1}#play{background:#22b82e;color:#fff;text-align:center;position:fixed;right:20px;bottom:20px;width:150px;height:60px;border-radius:30px;font-weight:100;line-height:60px;cursor:pointer;font-size:20px;box-shadow:0px 0px 6px #0000008e}#muted-container{position:fixed;width:150px;height:150px;left:50%;top:50%;margin-left:-75px;margin-top:-75px;background:#ffffff33;pointer-events:none;border-radius:75px}#muted-text{color:#fff;font-weight:300;text-align:center;margin-top:10px}.silence-button{position:fixed;width:50px;height:50px;margin-left:-25px;border-radius:50%;background:#ffffff33;cursor:pointer}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.silence-button{width:36px;height:36px;margin-left:-18px}}.silence-button .silence-line{transform-origin:20% 20%;transform:scale(0);transition:transform .1s linear}.silenced .silence-line{transform:scale(1)}#error{color:#fff;position:absolute;width:400px;left:50%;margin-left:-200px;top:50%;margin-top:-25px;pointer-events:none}#info{color:#fff;position:fixed;width:25px;height:25px;top:20px;left:220px;border:1px solid #fff;line-height:25px;border-radius:50%;cursor:pointer;user-select:none;text-align:center;font-size:16px;font-weight:900;z-index:999;background-color:rgba(255,255,255,0);transition:background-color .1s linear}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#info{width:20px;height:20px;line-height:20px;font-size:11px;left:140px}}#recording-indicator{position:fixed;top:90px;left:40px;color:#fff;font-size:24px;padding-left:25px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#recording-indicator{left:35px;top:85px;font-size:18px;padding-left:20px}}#recording-icon{position:absolute;left:0;top:2px;width:20px;height:20px;border-radius:50%;background:#ff3030;margin-right:10px;opacity:1}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#recording-icon{width:15px;height:15px;margin-right:5px}}@keyframes recording-pulse{from{opacity:.7}50%{opacity:1}to{opacity:.7}}#recording-frame{position:fixed;top:50px;bottom:0;left:0;right:0}.recording-frame-corner{display:block;position:fixed;stroke:rgba(255,255,255,.7);width:60px;height:60px;stroke-width:.15}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.recording-frame-corner{width:40px;height:40px;stroke-width:.1}}@keyframes recording-frame-pulse{from{stroke:rgba(255,255,255,.7)}50%{stroke:#fff}to{stroke:rgba(255,255,255,.7)}}#recording-frame-top-left{top:70px;left:20px}#recording-frame-top-right{top:70px;right:20px}#recording-frame-bottom-left{bottom:20px;left:20px}#recording-frame-bottom-right{bottom:20px;right:20px}#landscape-warning-overlay{display:none;position:fixed;width:100%;height:100%;overflow:none;background:#000;z-index:99999999;align-items:center !important;justify-content:center !important}.landscape-warning-icon{position:auto;width:24px;height:24px;padding:16px;background:#fff;border-radius:50%;margin-left:auto;margin-right:auto}.landscape-warning-text{color:#fff;font-size:20px;text-align:center;margin-top:15px}#timer{font-family:"Roboto Mono",monospace;font-weight:bold;position:fixed;left:10px;top:80px;color:#fff;font-size:20px}#performance-warning{display:flex;position:fixed;left:0;right:0;top:0;bottom:0;overflow:none;margin:30px;z-index:9999999;align-items:center !important;justify-content:center !important;text-align:center}#performance-warning-content{border-radius:10px;background:rgba(0,0,0,.9);padding:20px;max-width:500px}#performance-warning-icon{color:#fff;position:auto;font-size:48px;margin-left:auto;margin-right:auto}#performance-warning-text{color:#fff;font-size:20px;text-align:center;margin-top:10px}#performance-warning-dismiss{display:inline-block;background:#333;color:#fff;padding:10px;margin-top:15px;border-radius:5px;cursor:pointer;user-select:none}#credit{cursor:pointer;text-decoration:underline}#info-link{cursor:pointer;text-decoration:underline}',""]),e.a=o},function(t,e){t.exports=[["Name","en-US","af"," es-ES","fr-FR","hi"," it-IT ","ja","ko"," pt-BR","sw","zh-CN","zh-TW"],["splash_intro","Google Arts & Culture presents",null,null,null,null,null,null,null,null,null,null,null],["splash_title","Blob Opera",null,null,null,null,null,null,null,null,null,null,null],["splash_description","Play four voices in cities around the world, with the help of machine learning",null,null,null,null,null,null,null,null,null,null,null],["splash_sound_hint","Turn up your sound!",null,null,null,null,null,null,null,null,null,null,null],["splash_silent_hint","Make sure your device isn't on silent",null,null,null,null,null,null,null,null,null,null,null],["label_skip_tutorial","Skip tutorial",null,null,null,null,null,null,null,null,null,null,null],["button_begin","Ready!",null,null,null,null,null,null,null,null,null,null,null],["label_record","Record",null,null,null,null,null,null,null,null,null,null,null],["label_finish","Finish",null,null,null,null,null,null,null,null,null,null,null],["label_back","Back",null,null,null,null,null,null,null,null,null,null,null],["label_share","Share",null,null,null,null,null,null,null,null,null,null,null],["label_play","Play",null,null,null,null,null,null,null,null,null,null,null],["label_stop","Stop",null,null,null,null,null,null,null,null,null,null,null],["label_saving","Saving...",null,null,null,null,null,null,null,null,null,null,null],["label_discard","Discard",null,null,null,null,null,null,null,null,null,null,null],["label_copy_link","Copy link",null,null,null,null,null,null,null,null,null,null,null],["label_copied_link","Copied!",null,null,null,null,null,null,null,null,null,null,null],["label_leave","Leave",null,null,null,null,null,null,null,null,null,null,null],["tutorial_pitch","Drag blobs up and down to sing different pitches",null,null,null,null,null,null,null,null,null,null,null],["tutorial_vowel","Drag blobs forwards and backwards to sing different vowels",null,null,null,null,null,null,null,null,null,null,null],["tutorial_harmonization","The highest voice leads the harmony",null,null,null,null,null,null,null,null,null,null,null],["tutorial_mute","All together now! Use the mute buttons to silence blobs",null,null,null,null,null,null,null,null,null,null,null],["tutorial_end","That's it! Now sing your own operas. Hit record if you want to share what you make.",null,null,null,null,null,null,null,null,null,null,null],["prompt_in_playback_shared","Have a go!",null,null,null,null,null,null,null,null,null,null,null],["prompt_in_playback_creator","Start again",null,null,null,null,null,null,null,null,null,null,null],["prompt_share","Share your creation",null,null,null,null,null,null,null,null,null,null,null],["prompt_share_carol","Share this carol",null,null,null,null,null,null,null,null,null,null,null],["prompt_unmute","Click to unmute",null,null,null,null,null,null,null,null,null,null,null],["prompt_soprano","Drag to sing *soprano*",null,null,null,null,null,null,null,null,null,null,null],["prompt_mezzo","Drag to sing *mezzo-soprano*",null,null,null,null,null,null,null,null,null,null,null],["prompt_tenor","Drag to sing *tenor*",null,null,null,null,null,null,null,null,null,null,null],["prompt_bass","Drag to sing *bass*",null,null,null,null,null,null,null,null,null,null,null],["prompt_pitch","Pitch:",null,null,null,null,null,null,null,null,null,null,null],["prompt_vowel","Vowel:",null,null,null,null,null,null,null,null,null,null,null],["prompt_stop_recording","Press to finish your recording",null,null,null,null,null,null,null,null,null,null,null],["prompt_festive","Let it snow!",null,null,null,null,null,null,null,null,null,null,null],["prompt_harmonization","The highest voice type leads the harmony",null,null,null,null,null,null,null,null,null,null,null],["prompt_carols","Hear some festive songs!",null,null,null,null,null,null,null,null,null,null,null],["prompt_location_songs","Hear a local song!",null,null,null,null,null,null,null,null,null,null,null],["info_body","*Blob Opera is a machine learning experiment by David Li in collaboration with Google Arts and Culture.*\n\nOpera singers use their voices as expressive and beautiful musical instruments. This experiment pays tribute to those voices, as musical instruments anyone can learn how to play. Play four opera voices in real time. No singing skills required! \n\n*How it works:*\nWe collaborated with four opera singers to teach a machine learning model how to sing. Tenor, Christian Joel, bass Frederick Tong, mezzo-soprano Joanna Gamble and soprano Olivia Doutney recorded 16 hours of singing to train an algorithm called a Convolutional Neural Network. In the experiment you dont hear their voices, but the machine learning models understanding of what opera singing sounds like, based on what it learnt from them.\n\nDrag the blobs up and down to change pitch. Or forwards and backwards for different vowel sounds. Another machine learning model lets the blobs respond to and harmonise with your input in real time. \n\n*Blob Opera - on tour*\nWe've seen the blobs do their thing in The Blobpera House, now you can take them on tour. Take the blobs to cities around the world, and find inspiration in the music and landmarks of London, New York, Mexico City, Seoul, Cape Town, and Paris.\n\n*With special thanks to:*\nTenor Christian Joel, bass Frederick Tong, mezzo-soprano Joanna Gamble and soprano Olivia Doutney. Additional singing from Ingunn Gyda Hrafnkelsdottir and John Holland-Avery.\n\n*Not working?*\nBlob Opera is an experiment using the latest web audio technology and may not perform optimally on older devices. If you're on a mobile device, why not try a desktop one!\n\n*Learn more about Performing Arts*\nJourney through the world of performing arts and watch the world's greatest performers come to life in 360 on <performing_arts_link>",null,null,null,null,null,null,null,null,null,null,null],["info_performing_arts_link","Google Arts & Cuture",null,null,null,null,null,null,null,null,null,null,null],["axl_share_recording_ugc","Blob Opera is on tour! Play four opera voices and see them perform in cities around the world. Here's one I made for <city>  ",null,null,null,null,null,null,null,null,null,null,null],["axl_share_recording_cc","Blob Opera is on tour! Hear them sing <song> in <city> then create your own composition ",null,null,null,null,null,null,null,null,null,null,null],["landscape_warning_desktop","Expand the height of your window to view this experiment",null,null,null,null,null,null,null,null,null,null,null],["landscape_warning_mobile","This experiment is best viewed in portrait mode",null,null,null,null,null,null,null,null,null,null,null],["performance_warning","We've detected that you may not be having an optimal experience. Why not try this on a desktop device!",null,null,null,null,null,null,null,null,null,null,null],["performance_warning_dismiss","Try anyway",null,null,null,null,null,null,null,null,null,null,null],["disclaimer","This is an experiment using the latest web audio technology. It may not perform optimally on older devices.",null,null,null,null,null,null,null,null,null,null,null],["prompt_locations","Take the blobs on tour!",null,null,null,null,null,null,null,null,null,null,null],["location_blobpera_house","The Blobpera House",null,null,null,null,null,null,null,null,null,null,null],["location_london","London, UK",null,null,null,null,null,null,null,null,null,null,null],["location_paris","Paris, France",null,null,null,null,null,null,null,null,null,null,null],["location_new_york","New York, USA",null,null,null,null,null,null,null,null,null,null,null],["location_cape_town","Cape Town, South Africa",null,null,null,null,null,null,null,null,null,null,null],["location_mexico_city","Mexico City, Mexico",null,null,null,null,null,null,null,null,null,null,null],["location_seoul","Seoul, South Korea",null,null,null,null,null,null,null,null,null,null,null],["song_hallelujah_chorus_name","Hallelujah Chorus",null,null,null,null,null,null,null,null,null,null,null],["song_hallelujah_chorus_description","George Frideric Handel",null,null,null,null,null,null,null,null,null,null,null],["song_londonderry_air_name","Londonderry Air",null,null,null,null,null,null,null,null,null,null,null],["song_londonderry_air_description","Traditional Irish song",null,null,null,null,null,null,null,null,null,null,null],["song_loch_lomond_name","Loch Lomond",null,null,null,null,null,null,null,null,null,null,null],["song_loch_lomond_description","Traditional Scottish song",null,null,null,null,null,null,null,null,null,null,null],["song_wellerman_name","Wellerman",null,null,null,null,null,null,null,null,null,null,null],["song_wellerman_description","Traditional sea shanty",null,null,null,null,null,null,null,null,null,null,null],["song_ar_hyd_y_nos_name","Ar Hyd Y Nos",null,null,null,null,null,null,null,null,null,null,null],["song_ar_hyd_y_nos_description","Traditional Welsh song",null,null,null,null,null,null,null,null,null,null,null],["song_hun_honge_kamiyab_name","Hum Honge Kamiyab",null,null,null,null,null,null,null,null,null,null,null],["song_hun_honge_kamiyab_description","A traditional Hindi song",null,null,null,null,null,null,null,null,null,null,null],["song_new_world_symphony_name","Symphony No. 9 ",null,null,null,null,null,null,null,null,null,null,null],["song_new_world_symphony_description","Antonn Dvok",null,null,null,null,null,null,null,null,null,null,null],["song_down_to_the_river_name","Down to the River to Pray",null,null,null,null,null,null,null,null,null,null,null],["song_down_to_the_river_description","American folk song",null,null,null,null,null,null,null,null,null,null,null],["song_frere_jacques_name","Frre Jacques",null,null,null,null,null,null,null,null,null,null,null],["song_frere_jacques_description","Jean-Phillippe Rameau",null,null,null,null,null,null,null,null,null,null,null],["song_gymnopedie_name","Gymnopdie No. 1",null,null,null,null,null,null,null,null,null,null,null],["song_gymnopedie_description","Erik Satie",null,null,null,null,null,null,null,null,null,null,null],["song_habanera_name","Habaera (Carmen)",null,null,null,null,null,null,null,null,null,null,null],["song_habanera_description","Georges Bizet",null,null,null,null,null,null,null,null,null,null,null],["song_shosholoza_name","Shosholoza",null,null,null,null,null,null,null,null,null,null,null],["song_shosholoza_description","South African folk song",null,null,null,null,null,null,null,null,null,null,null],["song_when_the_saints_name","When the Saints go Marching In",null,null,null,null,null,null,null,null,null,null,null],["song_when_the_saints_description","American gospel song",null,null,null,null,null,null,null,null,null,null,null],["song_lakdi_ki_kathi_name","Lakdi Ki Kathi",null,null,null,null,null,null,null,null,null,null,null],["song_lakdi_ki_kathi_description","Traditional Hindi song",null,null,null,null,null,null,null,null,null,null,null],["song_thula_baba_name","Thula Baba, Thula Sana",null,null,null,null,null,null,null,null,null,null,null],["song_thula_baba_description","Zulu lullaby",null,null,null,null,null,null,null,null,null,null,null],["song_country_club_name","Country Club",null,null,null,null,null,null,null,null,null,null,null],["song_country_club_description","Scott Joplin",null,null,null,null,null,null,null,null,null,null,null],["song_la_bamba_name","La Bamba",null,null,null,null,null,null,null,null,null,null,null],["song_la_bamba_description","Mexican folk song",null,null,null,null,null,null,null,null,null,null,null],["song_summertime_name","Summertime",null,null,null,null,null,null,null,null,null,null,null],["song_summertime_description","George Gershwin",null,null,null,null,null,null,null,null,null,null,null],["song_la_llorona_name","La Llorona",null,null,null,null,null,null,null,null,null,null,null],["song_la_llorona_description","Mexican folk song",null,null,null,null,null,null,null,null,null,null,null],["song_dynamite_name","Dynamite ",null,null,null,null,null,null,null,null,null,null,null],["song_dynamite_description","BTS",null,null,null,null,null,null,null,null,null,null,null],["song_dios_nunca_muera_name","Dios Nunca Muere",null,null,null,null,null,null,null,null,null,null,null],["song_dios_nunca_muera_description","Macedonio Alcal",null,null,null,null,null,null,null,null,null,null,null],["song_nkosi_name","Nkosi Sikelel' iAfrika",null,null,null,null,null,null,null,null,null,null,null],["song_nkosi_description","Enoch Sontonga",null,null,null,null,null,null,null,null,null,null,null],["song_arirang_name","Arirang",null,null,null,null,null,null,null,null,null,null,null],["song_arirang_description","Korean folk song",null,null,null,null,null,null,null,null,null,null,null],["song_han_river_name","Han River",null,null,null,null,null,null,null,null,null,null,null],["song_han_river_description","Korean folk song",null,null,null,null,null,null,null,null,null,null,null],["song_doraji_name","Doraji Taryeong",null,null,null,null,null,null,null,null,null,null,null],["song_doraji_description","Korean folk song",null,null,null,null,null,null,null,null,null,null,null]]},function(t,e,n){"use strict";var i,o=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},r=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),a=[];function s(t){for(var e=-1,n=0;n<a.length;n++)if(a[n].identifier===t){e=n;break}return e}function l(t,e){for(var n={},i=[],o=0;o<t.length;o++){var r=t[o],l=e.base?r[0]+e.base:r[0],u=n[l]||0,c="".concat(l," ").concat(u);n[l]=u+1;var h=s(c),f={css:r[1],media:r[2],sourceMap:r[3]};-1!==h?(a[h].references++,a[h].updater(f)):a.push({identifier:c,updater:g(f,e),references:1}),i.push(c)}return i}function u(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var o=n.nc;o&&(i.nonce=o)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var a=r(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var c,h=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function f(t,e,n,i){var o=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(t.styleSheet)t.styleSheet.cssText=h(e,o);else{var r=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function d(t,e,n){var i=n.css,o=n.media,r=n.sourceMap;if(o?t.setAttribute("media",o):t.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var p=null,m=0;function g(t,e){var n,i,o;if(e.singleton){var r=m++;n=p||(p=u(e)),i=f.bind(null,n,r,!1),o=f.bind(null,n,r,!0)}else n=u(e),i=d.bind(null,n,e),o=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else o()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=o());var n=l(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var i=0;i<n.length;i++){var o=s(n[i]);a[o].references--}for(var r=l(t,e),u=0;u<n.length;u++){var c=s(n[u]);0===a[c].references&&(a[c].updater(),a.splice(c,1))}n=r}}}},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=t(e);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,i){"string"==typeof t&&(t=[[null,t,""]]);var o={};if(i)for(var r=0;r<this.length;r++){var a=this[r][0];null!=a&&(o[a]=!0)}for(var s=0;s<t.length;s++){var l=[].concat(t[s]);i&&o[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),e.push(l))}},e}},function(t,e,n){(function(t){!function(t){"use strict";var e,n=function(){try{if(t.URLSearchParams&&"bar"===new t.URLSearchParams("foo=bar").get("foo"))return t.URLSearchParams}catch(t){}return null}(),i=n&&"a=1"===new n({a:1}).toString(),o=n&&"+"===new n("s=%2B").get("s"),r=!n||((e=new n).append("s"," &"),"s=+%26"===e.toString()),a=c.prototype,s=!(!t.Symbol||!t.Symbol.iterator);if(!(n&&i&&o&&r)){a.append=function(t,e){m(this.__URLSearchParams__,t,e)},a.delete=function(t){delete this.__URLSearchParams__[t]},a.get=function(t){var e=this.__URLSearchParams__;return this.has(t)?e[t][0]:null},a.getAll=function(t){var e=this.__URLSearchParams__;return this.has(t)?e[t].slice(0):[]},a.has=function(t){return b(this.__URLSearchParams__,t)},a.set=function(t,e){this.__URLSearchParams__[t]=[""+e]},a.toString=function(){var t,e,n,i,o=this.__URLSearchParams__,r=[];for(e in o)for(n=h(e),t=0,i=o[e];t<i.length;t++)r.push(n+"="+h(i[t]));return r.join("&")};var l=!!o&&n&&!i&&t.Proxy;Object.defineProperty(t,"URLSearchParams",{value:l?new Proxy(n,{construct:function(t,e){return new t(new c(e[0]).toString())}}):c});var u=t.URLSearchParams.prototype;u.polyfill=!0,u.forEach=u.forEach||function(t,e){var n=p(this.toString());Object.getOwnPropertyNames(n).forEach((function(i){n[i].forEach((function(n){t.call(e,n,i,this)}),this)}),this)},u.sort=u.sort||function(){var t,e,n,i=p(this.toString()),o=[];for(t in i)o.push(t);for(o.sort(),e=0;e<o.length;e++)this.delete(o[e]);for(e=0;e<o.length;e++){var r=o[e],a=i[r];for(n=0;n<a.length;n++)this.append(r,a[n])}},u.keys=u.keys||function(){var t=[];return this.forEach((function(e,n){t.push(n)})),d(t)},u.values=u.values||function(){var t=[];return this.forEach((function(e){t.push(e)})),d(t)},u.entries=u.entries||function(){var t=[];return this.forEach((function(e,n){t.push([n,e])})),d(t)},s&&(u[t.Symbol.iterator]=u[t.Symbol.iterator]||u.entries)}function c(t){((t=t||"")instanceof URLSearchParams||t instanceof c)&&(t=t.toString()),this.__URLSearchParams__=p(t)}function h(t){var e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'\(\)~]|%20|%00/g,(function(t){return e[t]}))}function f(t){return t.replace(/[ +]/g,"%20").replace(/(%[a-f0-9]{2})+/gi,(function(t){return decodeURIComponent(t)}))}function d(e){var n={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return s&&(n[t.Symbol.iterator]=function(){return n}),n}function p(t){var e={};if("object"==typeof t)if(g(t))for(var n=0;n<t.length;n++){var i=t[n];if(!g(i)||2!==i.length)throw new TypeError("Failed to construct 'URLSearchParams': Sequence initializer must only contain pair elements");m(e,i[0],i[1])}else for(var o in t)t.hasOwnProperty(o)&&m(e,o,t[o]);else{0===t.indexOf("?")&&(t=t.slice(1));for(var r=t.split("&"),a=0;a<r.length;a++){var s=r[a],l=s.indexOf("=");-1<l?m(e,f(s.slice(0,l)),f(s.slice(l+1))):s&&m(e,f(s),"")}}return e}function m(t,e,n){var i="string"==typeof n?n:null!=n&&"function"==typeof n.toString?n.toString():JSON.stringify(n);b(t,e)?t[e].push(i):t[e]=[i]}function g(t){return!!t&&"[object Array]"===Object.prototype.toString.call(t)}function b(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(void 0!==t?t:"undefined"!=typeof window?window:this)}).call(this,n(15))},function(t,e,n){"use strict";function i(t,e,n,i){var r=t.createProgram(),a=o(t,t.VERTEX_SHADER,e),s=o(t,t.FRAGMENT_SHADER,n);for(var l in t.attachShader(r,a),t.attachShader(r,s),i)t.bindAttribLocation(r,i[l],l);t.linkProgram(r);for(var u={},c=t.getProgramParameter(r,t.ACTIVE_UNIFORMS),h=0;h<c;h+=1){var f=t.getActiveUniform(r,h),d=t.getUniformLocation(r,f.name);u[f.name]=d}return{program:r,uniformLocations:u,vertexShaderSource:e,fragmentShaderSource:n}}function o(t,e,n){var i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)||console.log(t.getShaderInfoLog(i)),i}function r(t,e,n,i,o,r,a,s,l,u,c){var h=t.createTexture();return t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,n,o,r,0,n,i,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,l),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,c),h}function a(t,e,n,i,o,r,a,s,l,u,c,h){return t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,i,r,a,0,i,o,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,l),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,c),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,h),e}function s(t,e,n,i,o,r,a,s){void 0===s&&(s=!1);var l=t.createTexture();return t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,l),s&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,a),r!==t.LINEAR_MIPMAP_LINEAR&&r!==t.LINEAR_MIPMAP_NEAREST||t.generateMipmap(t.TEXTURE_2D),l}function l(t,e,n,i){var o=t.createRenderbuffer();return t.bindRenderbuffer(t.RENDERBUFFER,o),t.renderbufferStorage(t.RENDERBUFFER,e,n,i),o}function u(t,e,n,i){var o=t.createBuffer();return t.bindBuffer(e,o),t.bufferData(e,n,i),o}n.r(e);var c={set:function(t,e,n,i,o,r,a,s,l,u,c,h,f,d,p,m,g){t[0]=e,t[1]=n,t[2]=i,t[3]=o,t[4]=r,t[5]=a,t[6]=s,t[7]=l,t[8]=u,t[9]=c,t[10]=h,t[11]=f,t[12]=d,t[13]=p,t[14]=m,t[15]=g},copy:function(t,e){for(var n=0;n<16;n++)t[n]=e[n]},makeIdentity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},makeTranslation:function(t,e,n,i){return c.makeIdentity(t),t[12]=e,t[13]=n,t[14]=i,t},makeScale:function(t,e,n,i){return t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},makeXRotation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=Math.cos(e),t[6]=Math.sin(e),t[7]=0,t[8]=0,t[9]=-Math.sin(e),t[10]=Math.cos(e),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},makeYRotation:function(t,e){return t[0]=Math.cos(e),t[1]=0,t[2]=-Math.sin(e),t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=Math.sin(e),t[9]=0,t[10]=Math.cos(e),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},transformPosition:function(t,e,n){var i=e[0],o=e[1],r=e[2];return t[0]=n[0]*i+n[4]*o+n[8]*r+n[12],t[1]=n[1]*i+n[5]*o+n[9]*r+n[13],t[2]=n[2]*i+n[6]*o+n[10]*r+n[14],t[3]=n[3]*i+n[7]*o+n[11]*r+n[15],t},transformDirection:function(t,e,n){var i=e[0],o=e[1],r=e[2];return t[0]=n[0]*i+n[4]*o+n[8]*r,t[1]=n[1]*i+n[5]*o+n[9]*r,t[2]=n[2]*i+n[6]*o+n[10]*r,t[3]=n[3]*i+n[7]*o+n[11]*r,t},multiplyVector:function(t,e,n){var i=n[0],o=n[1],r=n[2],a=n[3];return t[0]=e[0]*i+e[4]*o+e[8]*r+e[12]*a,t[1]=e[1]*i+e[5]*o+e[9]*r+e[13]*a,t[2]=e[2]*i+e[6]*o+e[10]*r+e[14]*a,t[3]=e[3]*i+e[7]*o+e[11]*r+e[15]*a,t},premultiply:function(t,e,n){var i=n[0],o=n[4],r=n[8],a=n[12],s=n[1],l=n[5],u=n[9],c=n[13],h=n[2],f=n[6],d=n[10],p=n[14],m=n[3],g=n[7],b=n[11],v=n[15],y=e[0],_=e[1],x=e[2],w=e[3];return t[0]=i*y+o*_+r*x+a*w,t[1]=s*y+l*_+u*x+c*w,t[2]=h*y+f*_+d*x+p*w,t[3]=m*y+g*_+b*x+v*w,y=e[4],_=e[5],x=e[6],w=e[7],t[4]=i*y+o*_+r*x+a*w,t[5]=s*y+l*_+u*x+c*w,t[6]=h*y+f*_+d*x+p*w,t[7]=m*y+g*_+b*x+v*w,y=e[8],_=e[9],x=e[10],w=e[11],t[8]=i*y+o*_+r*x+a*w,t[9]=s*y+l*_+u*x+c*w,t[10]=h*y+f*_+d*x+p*w,t[11]=m*y+g*_+b*x+v*w,y=e[12],_=e[13],x=e[14],w=e[15],t[12]=i*y+o*_+r*x+a*w,t[13]=s*y+l*_+u*x+c*w,t[14]=h*y+f*_+d*x+p*w,t[15]=m*y+g*_+b*x+v*w,t},transpose:function(t,e){if(t===e){var n=e[1],i=e[2],o=e[3],r=e[6],a=e[7],s=e[11];e[1]=e[4],e[4]=n,e[2]=e[8],e[8]=i,e[3]=e[12],e[12]=o,e[6]=e[9],e[9]=r,e[7]=e[13],e[13]=a,e[11]=e[14],e[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]},invert:function(t,e){var n=e[0],i=e[4],o=e[8],r=e[12],a=e[1],s=e[5],l=e[9],u=e[13],c=e[2],h=e[6],f=e[10],d=e[14],p=e[3],m=e[7],g=e[11],b=e[15],v=f*b,y=d*g,_=h*b,x=d*m,w=h*g,P=f*m,S=c*b,A=d*p,T=c*g,E=f*p,R=c*m,M=h*p,F=o*u,k=r*l,I=i*u,C=r*s,B=i*l,D=o*s,L=n*u,N=r*a,O=n*l,j=o*a,U=n*s,z=i*a,G=v*s+x*l+w*u-(y*s+_*l+P*u),V=y*a+S*l+E*u-(v*a+A*l+T*u),H=_*a+A*s+R*u-(x*a+S*s+M*u),Y=P*a+T*s+M*l-(w*a+E*s+R*l),W=1/(n*G+i*V+o*H+r*Y);return t[0]=W*G,t[1]=W*V,t[2]=W*H,t[3]=W*Y,t[4]=W*(y*i+_*o+P*r-(v*i+x*o+w*r)),t[5]=W*(v*n+A*o+T*r-(y*n+S*o+E*r)),t[6]=W*(x*n+S*i+M*r-(_*n+A*i+R*r)),t[7]=W*(w*n+E*i+R*o-(P*n+T*i+M*o)),t[8]=W*(F*m+C*g+B*b-(k*m+I*g+D*b)),t[9]=W*(k*p+L*g+j*b-(F*p+N*g+O*b)),t[10]=W*(I*p+N*m+U*b-(C*p+L*m+z*b)),t[11]=W*(D*p+O*m+z*g-(B*p+j*m+U*g)),t[12]=W*(I*f+D*d+k*h-(B*d+F*h+C*f)),t[13]=W*(O*d+F*c+N*f-(L*f+j*d+k*c)),t[14]=W*(L*h+z*d+C*c-(U*d+I*c+N*h)),t[15]=W*(U*f+B*c+j*h-(O*h+z*f+D*c)),t},fromQuaternion:function(t,e){var n=e[3],i=e[0],o=e[1],r=e[2];return t[0]=1-2*o*o-2*r*r,t[1]=2*i*o+2*n*r,t[2]=2*i*r-2*n*o,t[3]=0,t[4]=2*i*o-2*n*r,t[5]=1-2*i*i-2*r*r,t[6]=2*o*r+2*n*i,t[7]=0,t[8]=2*i*r+2*n*o,t[9]=2*o*r-2*n*i,t[10]=1-2*i*i-2*o*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},makePerspective:function(t,e,n,i,o){var r=1/Math.tan(e/2),a=1/(i-o);return t[0]=r/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(o+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*i*a,t[15]=0,t},makeInfinitePerspective:function(t,e,n,i,o){var r=1/Math.tan(e/2);return t[0]=r/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1e-8-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=(1e-8-2)*i,t[15]=0,t},makePerspectiveHorizontal:function(t,e,n,i,o){var r=1/Math.tan(e/2),a=1/(i-o);return t[0]=r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r*n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(o+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*i*a,t[15]=0,t},makeLookAt:function(t,e,n,i){var o=e[0],r=e[1],a=e[2],s=i[0],l=i[1],u=i[2],c=o-n[0],h=r-n[1],f=a-n[2],d=c*c+h*h+f*f;d>0&&(c*=d=1/Math.sqrt(d),h*=d,f*=d);var p=l*f-u*h,m=u*c-s*f,g=s*h-l*c;return(d=p*p+m*m+g*g)>0&&(p*=d=1/Math.sqrt(d),m*=d,g*=d),t[0]=p,t[1]=m,t[2]=g,t[3]=0,t[4]=h*g-f*m,t[5]=f*p-c*g,t[6]=c*m-h*p,t[7]=0,t[8]=c,t[9]=h,t[10]=f,t[11]=0,t[12]=o,t[13]=r,t[14]=a,t[15]=1,t},makeOrthographic:function(t,e,n,i,o,r,a){return t[0]=2/(n-e),t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2/(o-i),t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=-2/(a-r),t[11]=0,t[12]=-(n+e)/(n-e),t[13]=-(o+i)/(o-i),t[14]=-(a+r)/(a-r),t[15]=1,t}},h=n(2),f=n(0),d=n(3),p=function(){function t(t,e,n){this.centerPosition=new Float32Array(3),this.attachPosition=new Float32Array(3),this.lookPitch=0,this.lookYaw=0,this.lookDirection=new Float32Array([0,0,1]),this.localLookDirection=new Float32Array([0,0,1]),this.gl=t,this.module=e,this.eyePointer=n,this.vertexCount=this.module._eyeGetVertexCount(this.eyePointer),this.indexCount=this.module._eyeGetIndexCount(this.eyePointer);var i=this.module.HEAPU16.subarray(this.module._eyeGetIndices(this.eyePointer)>>1,(this.module._eyeGetIndices(this.eyePointer)>>1)+this.indexCount);this.indexBuffer=u(t,t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),this.positionsBuffer=t.createBuffer(),this.normalsBuffer=t.createBuffer();var o=this.module.HEAPF32.subarray(this.module._eyeGetRestPositions(this.eyePointer)>>2,(this.module._eyeGetRestPositions(this.eyePointer)>>2)+3*this.vertexCount);this.restPositionsBuffer=u(t,t.ARRAY_BUFFER,o,t.STATIC_DRAW)}return t.prototype.step=function(t,e){var n=this.module.HEAPF32.subarray(this.module._eyeGetPositions(this.eyePointer)>>2,(this.module._eyeGetPositions(this.eyePointer)>>2)+3*this.vertexCount),i=this.module.HEAPF32.subarray(this.module._eyeGetNormals(this.eyePointer)>>2,(this.module._eyeGetNormals(this.eyePointer)>>2)+3*this.vertexCount),o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,this.positionsBuffer),o.bufferData(o.ARRAY_BUFFER,n,o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this.normalsBuffer),o.bufferData(o.ARRAY_BUFFER,i,o.DYNAMIC_DRAW);var r=this.module._eyeGetCenterPosition(this.eyePointer);this.centerPosition[0]=this.module.HEAPF32[0+(r>>2)],this.centerPosition[1]=this.module.HEAPF32[1+(r>>2)],this.centerPosition[2]=this.module.HEAPF32[2+(r>>2)];for(var a=this.module._eyeGetAttachPosition(this.eyePointer),s=0;s<3;++s)this.attachPosition[0]=this.module.HEAPF32[0+(a>>2)],this.attachPosition[1]=this.module.HEAPF32[1+(a>>2)],this.attachPosition[2]=this.module.HEAPF32[2+(a>>2)];h.a.subtract(this.localLookDirection,t,this.centerPosition),h.a.normalize(this.localLookDirection,this.localLookDirection);var l=Object(f.b)(Math.atan2(this.localLookDirection[0],this.localLookDirection[2]),-Math.PI/2,Math.PI/2*.3),u=Object(f.b)(Math.acos(this.localLookDirection[1]),e,.5*Math.PI);this.lookYaw=Object(f.n)(this.lookYaw,l,.5),this.lookPitch=Object(f.n)(this.lookPitch,u,.5),this.lookDirection[0]=Math.sin(this.lookPitch)*Math.sin(this.lookYaw),this.lookDirection[1]=Math.cos(this.lookPitch),this.lookDirection[2]=Math.sin(this.lookPitch)*Math.cos(this.lookYaw)},t}(),m=function(){function t(t,e){this.vertexCount=0,this.gl=t,this.positionsBuffer=t.createBuffer(),this.colorsBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.positionsData=new Float32Array(3*e*3),this.colorsData=new Float32Array(3*e*4),this.clear()}return t.prototype.clear=function(){this.vertexCount=0},t.prototype.drawTriangle=function(t,e,n,i,o,r,a,s,l,u,c,h,f){this.positionsData[3*this.vertexCount+0]=t,this.positionsData[3*this.vertexCount+1]=e,this.positionsData[3*this.vertexCount+2]=n,this.positionsData[3*this.vertexCount+3]=i,this.positionsData[3*this.vertexCount+4]=o,this.positionsData[3*this.vertexCount+5]=r,this.positionsData[3*this.vertexCount+6]=a,this.positionsData[3*this.vertexCount+7]=s,this.positionsData[3*this.vertexCount+8]=l;for(var d=0;d<3;++d)this.colorsData[4*this.vertexCount+4*d+0]=u,this.colorsData[4*this.vertexCount+4*d+1]=c,this.colorsData[4*this.vertexCount+4*d+2]=h,this.colorsData[4*this.vertexCount+4*d+3]=f;this.vertexCount+=3},t.prototype.commit=function(){var t=this.gl;this.vertexCount>0&&(t.bindBuffer(t.ARRAY_BUFFER,this.positionsBuffer),t.bufferData(t.ARRAY_BUFFER,this.positionsData.subarray(0,3*this.vertexCount),t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.colorsBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorsData.subarray(0,4*this.vertexCount),t.DYNAMIC_DRAW))},t}(),g=function(){function t(t,e){this.gl=t,this.maxVertices=e,this.clear(),this.positionsBuffer=t.createBuffer(),this.colorsBuffer=t.createBuffer(),this.positionsData=new Float32Array(3*e),this.colorsData=new Float32Array(4*e)}return t.prototype.clear=function(){this.vertexCount=0},t.prototype.addLine=function(t,e,n,i){for(var o=0;o<3;++o)this.positionsData[3*this.vertexCount+o]=t[o];for(o=0;o<3;++o)this.positionsData[3*this.vertexCount+3+o]=e[o];for(o=0;o<4;++o)this.colorsData[4*this.vertexCount+o]=n[o];for(o=0;o<4;++o)this.colorsData[4*this.vertexCount+4+o]=i[o];this.vertexCount+=2},t.prototype.commit=function(){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.positionsBuffer),t.bufferData(t.ARRAY_BUFFER,this.positionsData.subarray(0,3*this.vertexCount),t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.colorsBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorsData.subarray(0,4*this.vertexCount),t.DYNAMIC_DRAW)},t}(),b=function(){function t(t,e,n,i,o){this.indicatorY=new d.a(0),this.alpha=new d.a(0),this.overrideAlpha=new d.a(1),this.soundingAlphas=[],this.yOffset=new d.a(0),this.gl=t,this.scale=e,this.minY=n,this.maxY=i,this.modelMatrix=o;for(var r=0;r<e.length;++r)this.soundingAlphas.push(new d.a(0));this.lines=new g(t,2*(this.scale.length+1)),this.triangles=new m(t,2*this.scale.length+1);var a=[1,1,1,.5];for(r=0;r<=this.scale.length;++r){var s=Object(f.n)(this.minY,this.maxY,r/this.scale.length);this.lines.addLine([0,s,0],[.2,s,0],a,a)}this.lines.commit()}return t.prototype.getModelMatrix=function(){return c.premultiply(new Float32Array(16),this.modelMatrix,c.makeTranslation([],0,this.yOffset.evaluate(),0))},t.prototype.drawRect=function(t,e,n,i,o){this.triangles.drawTriangle(t,e,0,t+n,e,0,t+n,e+i,0,1,1,1,o),this.triangles.drawTriangle(t,e,0,t+n,e+i,0,t,e+i,0,1,1,1,o)},t.prototype.update=function(t,e,n){this.triangles.clear();var i=-1;if(t){this.currentDraggedValue=e;var o=this.scale.indexOf(e);i=o;var r=Object(f.n)(this.minY,this.maxY,(o+.5)/this.scale.length);this.indicatorY.change(r,.05)}this.alpha.change(t?1:0,.2);var a=this.indicatorY.evaluate();this.triangles.drawTriangle(0,a,0,-.1,a-.05,0,-.1,a+.05,0,1,1,1,1),this.currentSoundedValue=n;var s=-1;null!==n&&(s=this.scale.indexOf(n));for(var l=0;l<this.soundingAlphas.length;++l){var u=this.soundingAlphas[l];l===s?u.change(1,.1):l===i?u.change(.1,.1):u.change(0,.1);var c=u.evaluate();if(c>0){var h=(this.maxY-this.minY)/this.scale.length;this.drawRect(0,this.minY+l*h,.2,h,c)}}this.triangles.commit()},t}(),v=n(8);var y=n(1);function _(t,e){for(var n=t._malloc(e.length),i=t.HEAPU8.subarray(n,n+e.length),o=0;o<e.length;++o)i[o]=e[o];return n}function x(t,e,n,i){var o=c.makeScale(new Float32Array(16),i,i,i),r=c.makeYRotation(new Float32Array(16),n),a=c.makeXRotation(new Float32Array(16),e),s=c.makeTranslation(new Float32Array(16),t[0],t[1],t[2]),l=o;return c.premultiply(l,l,a),c.premultiply(l,l,r),c.premultiply(l,l,s),l}function w(t,e,n){var i=c.makeScale(new Float32Array(16),n,n,n),o=c.fromQuaternion([],e),r=c.makeTranslation(new Float32Array(16),t[0],t[1],t[2]),a=i;return c.premultiply(a,a,o),c.premultiply(a,a,r),a}var P,S=function(){function t(){this.lastBlinkTime=0,this.lastBlinkTime=Date.now()-Object(f.n)(3e3,6e3,Math.random()),this.msToNextBlink=Object(f.n)(3e3,6e3,Math.random())}return t.prototype.evaluate=function(){var t=Date.now();t-this.lastBlinkTime>this.msToNextBlink&&(this.lastBlinkTime=t,this.msToNextBlink=Object(f.n)(3e3,6e3,Math.random()));var e=Math.max(t-this.lastBlinkTime,0);return 1-Object(f.l)(0,120,e)*Object(f.l)(300,180,e)},t}();function A(t,e){return t.midiPitch===e.midiPitch&&t.vowel===e.vowel}function T(t,e,n,i){var o=t.indexOf(n);return-1!==o&&e>(o-i)/t.length&&e<(o+1+i)/t.length?n:t[Object(f.b)(Math.floor(e*t.length),0,t.length-1)]}function E(t,e){if(t<=e[0])return 0;if(t>=e[e.length-1])return e.length-1;for(var n=0;n<e.length-1;++n)if(t>=e[n]&&t<=e[n+1])return n+Object(f.l)(e[n],e[n+1],t)}!function(t){t[t.Offscreen=0]="Offscreen",t[t.Falling=1]="Falling",t[t.Rising=2]="Rising",t[t.Idle=3]="Idle"}(P||(P={}));var R={scale:[1.3,.2,1],bend:0},M={scale:[1.3,.2,1],bend:0},F={};F[y.b.a]={scale:[1.8,1.8,1],bend:.4},F[y.b.e]={scale:[1.2,1,1],bend:.5},F[y.b.i]={scale:[1.5,.7,1],bend:.5},F[y.b.o]={scale:[.8,.8,2],bend:0},F[y.b.u]={scale:[.4,.4,3],bend:0};var k=[y.b.a,y.b.e,y.b.i,y.b.o,y.b.u];function I(t,e,n){if(t.state===P.Idle){var i=t.rayIntersect(e,n);if(-1!==i){t.indices[3*i+0];var o=t.getIntersectedRestPosition();return{draggingRestPosition:[o[0],o[1],o[2]]}}return null}}var C=[0,0,1],B=function(){function t(t,e){this.draggingRestPosition=[0,0,0],this.yScale=1,this.zOffset=0,this.localRayOrigin=[0,0,0],this.localRayDirection=[0,0,0],this.localZDirection=[0,0,0],this.planeIntersection=[0,0,0],this.blob=t,this.draggingRestPosition=e}return t.prototype.step=function(t,e){c.transformPosition(this.localRayOrigin,t,this.blob.inverseModelMatrix),c.transformDirection(this.localRayDirection,e,this.blob.inverseModelMatrix),h.a.normalize(this.localRayDirection,this.localRayDirection),c.transformDirection(this.localZDirection,C,this.blob.inverseModelMatrix),Object(f.j)(this.planeIntersection,this.draggingRestPosition,this.localZDirection,this.localRayOrigin,this.localRayDirection),this.localPosition=this.planeIntersection;var n=.45*this.blob.config.stretch;this.yScale=Math.max(1+(this.planeIntersection[1]-this.draggingRestPosition[1])*n,.6),this.zOffset=Object(f.b)(.2*(this.planeIntersection[2]-this.draggingRestPosition[2]),-.15,.35)},t}();var D=function(){function t(t,e,n,i,o,r,a,s,l,h){this.MIN_Y=1.85,this.MAX_Y=6.25,this.MIN_Z=0,this.MAX_Z=1.7,this.eyes=[],this.modelMatrix=new Float32Array(16),this.inverseModelMatrix=new Float32Array(16),this.offset=[0,0,0],this.blinker=new S,this.state=P.Offscreen,this.timeCurrentNoteReached=0,this.frame=0,this.fallStartFrame=0,this.fallStartY=0,this.riseStartFrame=0,this.riseStartY=0,this.exiting=!1,this.exitStartFrame=0,this.lookPosition=[0,0,0],this.localLookPosition=[0,0,0],this.yScale=1,this.zOffset=0,this.mouthScaleX=new d.a(M.scale[0]),this.mouthScaleY=new d.a(M.scale[1]),this.mouthScaleZ=new d.a(M.scale[2]),this.mouthBend=new d.a(M.bend),this.mouthRotation=new d.a(0),this.isSinging=!1,this.lastSoundedVowel=null,this.isDragging=!1,this.hatOffset=new d.a(1,(function(t){return Object(f.r)(0,1,t)})),this.eyeBottomOpenness=new d.a(0),this.eyeTopOpenness=new d.a(1),this.eyeOverrideOpenness=new d.a(.2),this.baseYScale=1,this.overrideHipnotized=!1,this.smoothIsSinging=new d.a(0,(function(t){return Object(f.r)(0,1,t)})),this.rimLevel=new d.a(0,(function(t){return Object(f.r)(0,1,t)})),this.topPosition=new Float32Array(3),this.tempMatrix=new Float32Array(16),this.hatModelMatrix=new Float32Array(16),this.gl=t,this.module=e,this.config=s,this.scale=r,this.mouthRotation.change(s.mouthRotation,0),this.assets=o;var m=_(this.module,o.meshBuffer),g=_(this.module,n);s.parameters.blobDensity=void 0!==s.parameters.blobDensity?s.parameters.blobDensity:1.2,s.parameters.blobMu=void 0!==s.parameters.blobMu?s.parameters.blobMu:5,s.parameters.eyeDensity=void 0!==s.parameters.eyeDensity?s.parameters.eyeDensity:1.2,s.parameters.eyeMu=void 0!==s.parameters.eyeMu?s.parameters.eyeMu:5,s.parameters.eyeAttachOffset=void 0!==s.parameters.eyeAttachOffset?s.parameters.eyeAttachOffset:.1;var A=function(t,e){var n=t._malloc(60),i=t.HEAPF32.subarray(n>>2,15+(n>>2));return i[0]=e.leftEyeScale[0],i[1]=e.leftEyeScale[1],i[2]=e.leftEyeScale[2],i[3]=e.rightEyeScale[0],i[4]=e.rightEyeScale[1],i[5]=e.rightEyeScale[2],i[6]=e.leftEyeX,i[7]=e.leftEyeZ,i[8]=e.rightEyeX,i[9]=e.rightEyeZ,i[10]=e.blobDensity,i[11]=e.blobMu,i[12]=e.eyeDensity,i[13]=e.eyeMu,i[14]=e.eyeAttachOffset,n}(this.module,s.parameters),T=s.scale;this.blobPointer=this.module._createBlob(m,o.meshBuffer.length,o.isJSONMesh?1:0,g,n.length,i?1:0,A,a,T,s.inflation),this.topIndex=this.module._blobGetTopIndex(this.blobPointer),this.vertexCount=this.module._blobGetVertexCount(this.blobPointer),this.renderingVertexCount=this.module._blobGetRenderingVertexCount(this.blobPointer),this.renderingIndexCount=this.module._blobGetRenderingIndexCount(this.blobPointer),this.indexCount=this.module._blobGetIndexCount(this.blobPointer),this.indices=this.module.HEAPU16.subarray(this.module._blobGetIndices(this.blobPointer)>>1,(this.module._blobGetIndices(this.blobPointer)>>1)+this.indexCount).slice(0);var E=this.module.HEAPU16.subarray(this.module._blobGetRenderingIndices(this.blobPointer)>>1,(this.module._blobGetRenderingIndices(this.blobPointer)>>1)+this.renderingIndexCount).slice(0);this.indexBuffer=u(t,t.ELEMENT_ARRAY_BUFFER,E,t.STATIC_DRAW),this.positionsBuffer=t.createBuffer(),this.normalsBuffer=t.createBuffer(),this.speedsBuffer=t.createBuffer();var R=this.module.HEAPF32.subarray(this.module._blobGetRenderingUVs(this.blobPointer)>>2,(this.module._blobGetRenderingUVs(this.blobPointer)>>2)+2*this.renderingVertexCount);this.uvsBuffer=u(t,t.ARRAY_BUFFER,R,t.STATIC_DRAW),this.restPositions=this.module.HEAPF32.subarray(this.module._blobGetRestPositions(this.blobPointer)>>2,(this.module._blobGetRestPositions(this.blobPointer)>>2)+3*this.vertexCount).slice(0);for(var F=0;F<2;++F){var I=this.module._blobGetEye(this.blobPointer,F);this.eyes.push(new p(t,this.module,I))}var C=this.module._blobGetRestMouthCentroid(this.blobPointer);if(this.restMouthCentroid=this.module.HEAPF32.subarray(C>>2,3+(C>>2)).slice(0),h){var B=new Float32Array(x(s.position,0,Object(f.e)(s.rotationDegrees),1));this.baseModelMatrix=c.premultiply(new Float32Array(16),B,x(l,0,0,1))}else this.baseModelMatrix=new Float32Array(x(s.position,0,Object(f.e)(s.rotationDegrees),1));this.mouthTriangleIndexCount=this.module._blobGetMouthTriangleIndexCount(this.blobPointer);var D=this.module.HEAPU16.subarray(this.module._blobGetMouthTriangleIndices(this.blobPointer)>>1,(this.module._blobGetMouthTriangleIndices(this.blobPointer)>>1)+this.mouthTriangleIndexCount);this.mouthTriangleIndexBuffer=u(t,t.ELEMENT_ARRAY_BUFFER,D,t.STATIC_DRAW),this.mouthPositionCount=this.module._blobGetMouthPositionCount(this.blobPointer),this.mouthGeometry=function(t,e,n,i){for(var o=[],r=[],a=[],s=0;s<e;++s)for(var l=0;l<n;++l)for(var c=(s+l/n)/e,h=0;h<i;++h){var f=2*Math.PI*h/i,d=Math.cos(f),p=Math.sin(f);o.push(d),o.push(p),o.push(c),r.push(d),r.push(p),r.push(0),a.push(0),a.push(0)}var m=u(t,t.ARRAY_BUFFER,new Float32Array(o),t.STATIC_DRAW),g=u(t,t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),b=u(t,t.ARRAY_BUFFER,new Float32Array(a),t.STATIC_DRAW),v=[],y=e*n;for(s=0;s<y;++s)for(h=0;h<i;++h){var _=0+s*i+h,x=0+s*i+(h+1)%i,w=0+(s+1)%y*i+h,P=0+(s+1)%y*i+(h+1)%i;v.push(_),v.push(w),v.push(P),v.push(P),v.push(x),v.push(_)}return{vertexBuffer:m,normalsBuffer:g,uvsBuffer:b,indexBuffer:u(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(v),t.STATIC_DRAW),indexCount:v.length}}(t,this.mouthPositionCount,10,10),this.tonguePointer=this.module._blobGetTongue(this.blobPointer),this.tonguePositionCount=this.module._tongueGetPointCount(this.tonguePointer),this.currentPitchVowel={midiPitch:0,vowel:y.b.a},this.mouthY=this.restMouthCentroid[1],this.liveMidiNote=new d.a(this.scale[0]),this.frame=Math.floor(1e4*Math.random()),this.MIN_Y=this.restMouthCentroid[1]*this.config.stretch-2.5/this.scale.length*(4.4*.9),this.MAX_Y=this.MIN_Y+4.4*.9;var L=w([0,0,this.restMouthCentroid[2]+.65],v.a.fromAxisAngle([],[0,1,0],-Math.PI/2),1),N=c.premultiply(new Float32Array(16),L,this.baseModelMatrix);this.pitchUI=new b(t,this.scale,this.MIN_Y,this.MAX_Y,N);var O=v.a.multiply([],v.a.fromAxisAngle([],[0,1,0],Math.PI/2),v.a.fromAxisAngle([],[0,0,1],Math.PI/2)),j=w([0,Math.min(1.3,this.MIN_Y),0],O,1),U=c.premultiply(new Float32Array(16),j,this.baseModelMatrix);this.MIN_Z=this.restMouthCentroid[2]-1.5/k.length*1.7,this.MAX_Z=this.MIN_Z+1.7,this.vowelUI=new b(t,k,this.MIN_Z,this.MAX_Z,U),this.baseYScale=s.stretch,this.yScale=this.baseYScale;var z=Object(f.n)(.8,1.5,Math.random());this.tongueScale=new Float32Array([z,1/z])}return t.prototype.recomputeMatrices=function(){var t=c.makeTranslation(this.tempMatrix,this.offset[0],this.offset[1],this.offset[2]);c.premultiply(this.modelMatrix,this.baseModelMatrix,t),c.invert(this.inverseModelMatrix,this.modelMatrix)},t.prototype.startFalling=function(t){this.state!==P.Falling&&(this.fallStartFrame=this.frame+(this.state===P.Rising?0:t),this.state===P.Rising?this.fallStartY=this.getRiseY():this.fallStartY=12,this.state=P.Falling,this.module._blobReset(this.blobPointer,1,0,0,0,0),this.offset[1]=this.fallStartY,this.recomputeMatrices())},t.prototype.startRising=function(t){this.state!==P.Rising&&(this.state===P.Falling?this.riseStartY=this.getFallY():this.riseStartY=0,this.riseStartFrame=this.frame+(this.state===P.Falling?0:t),this.state=P.Rising,this.offset[1]=0,this.recomputeMatrices())},t.prototype.exitStageLeft=function(){this.exiting||(this.exiting=!0,this.exitStartFrame=this.frame)},t.prototype.canDestroy=function(){return this.exiting&&this.frame-this.exitStartFrame>120},t.prototype.getFallY=function(){if(this.state===P.Falling){var e=Math.max(0,this.frame-this.fallStartFrame);return this.fallStartY+t.INITIAL_FALL_SPEED*e+.5*t.GRAVITY*e*e}return 0},t.prototype.getFallVelocity=function(){if(this.state===P.Falling){return Math.max(0,this.frame-this.fallStartFrame)*t.GRAVITY-.02}return 0},t.prototype.getRiseY=function(){var e=Math.max(0,this.frame-this.riseStartFrame);return this.riseStartY+t.INITIAL_RISE_SPEED*e+.5*t.RISE_ACCELERATION*e*e},t.prototype.step=function(e,n){var i=n?function(t){return t.getMuted()?R:t.getPhoneme()in F?t.getPhoneme()in F?F[t.getPhoneme()]:null:M}(n):R;this.mouthScaleX.change(i.scale[0],.1),this.mouthScaleY.change(i.scale[1],.1),this.mouthScaleZ.change(i.scale[2],.1),this.mouthBend.change(i.bend,.1),this.mouthRotation.change(n?1*this.config.mouthRotation:this.config.mouthRotation,.1);var o=1+.04*Math.sin(.5*this.frame);if(n&&!n.getMuted()||(o=1),this.module._blobSetMouthScale(this.blobPointer,this.mouthScaleX.evaluate()*o,this.mouthScaleY.evaluate()*o,this.mouthScaleZ.evaluate()*o),this.module._blobSetMouthBend(this.blobPointer,this.mouthBend.evaluate()),this.module._blobSetMouthNoiseScale(this.blobPointer,!n||n.getMuted()?0:.04*this.mouthScaleY.evaluate()),this.module._blobSetMouthNoiseFrequency(this.blobPointer,2.5),this.module._blobSetMouthNoiseOffset(this.blobPointer,.05*this.frame),this.module._blobSetMouthRotation(this.blobPointer,this.mouthRotation.evaluate()),this.isSinging=n&&!n.getMuted(),this.isSinging){if(Object(f.k)(n.getVowel())&&n.getVowel()!==this.lastSoundedVowel){this.eyeOverrideOpenness.change(Object(f.o)(Math.max(0,1*Math.random()-.4),.2),.2),this.lastSoundedVowel=n.getVowel()}}else this.lastSoundedVowel=y.b.sil,this.eyeOverrideOpenness.change(0,.2);this.overrideHipnotized&&this.eyeOverrideOpenness.change(.25,.2);var r=[0,0,0];if(this.state===P.Idle)if(e.length>0){for(var a=0,s=0,l=0,u=e;l<u.length;l++){var h=u[l];a+=h.yScale/e.length,s+=h.zOffset/e.length}this.yScale=a,this.zOffset=s,this.module._blobSetMouthDamping(this.blobPointer,.05),this.module._blobSetDamping(this.blobPointer,.995),this.module._blobSetIsDragging(this.blobPointer,!0),this.isDragging=!0}else if(this.module._blobSetIsDragging(this.blobPointer,!1),this.isDragging=!1,!n||n.getMuted()){this.yScale=Object(f.n)(this.yScale,this.baseYScale,.07),this.zOffset=Object(f.n)(this.zOffset,0,.07),this.module._blobSetMouthDamping(this.blobPointer,.995)}else{var d=n.getF0(),p=Object(f.g)(d)-mt,m=E(p,this.scale),g=(1+m/(this.scale.length-1)*this.config.pitchScale)*this.baseYScale,b=.1;if(n.getControlled())g=Object(f.n)(this.MIN_Y,this.MAX_Y,m/(this.scale.length-1))/this.restMouthCentroid[1],b=.3;this.yScale=Object(f.n)(this.yScale,g,b),this.module._blobSetMouthDamping(this.blobPointer,0),this.module._blobSetDamping(this.blobPointer,.995);var v=0;if(n.getControlled())v=E(this.lastSoundedVowel,k)/(k.length-1)*.1-.05;this.zOffset=Object(f.n)(this.zOffset,v,.3),this.liveMidiNote.change(p,0)}else if(this.state===P.Falling){var _=this.getFallY(),x=this.getFallVelocity();this.offset[1]=_,_<=0&&(this.state=P.Idle,this.offset[1]=0,this.module._blobAddImpulse(this.blobPointer,0,60*x,0)),this.module._blobSetMouthDamping(this.blobPointer,.97),this.module._blobSetDamping(this.blobPointer,.97)}else if(this.state===P.Rising){_=this.getRiseY();this.offset[1]=_;_>=12&&(this.state=P.Offscreen,this.offset[1]=12),this.module._blobSetMouthDamping(this.blobPointer,.97),this.module._blobSetDamping(this.blobPointer,.97)}if(this.exiting){var w=Math.max(0,this.frame-this.exitStartFrame),S=0-t.INITIAL_RISE_SPEED*w-.5*t.RISE_ACCELERATION*3*w*w;this.offset[0]=S;this.module._blobAddImpulse(this.blobPointer,.5,0,0)}var I=2*this.frame,C=this.isSinging?.4:0;this.module._blobSetNoiseParameters(this.blobPointer,100,I,C);var B=1+.2*Math.sin(this.frame/60*3);this.module._blobSetBreathVolumeScale(this.blobPointer,B);var D=this.isSinging?2:0;this.module._tongueSetWindForce(this.tonguePointer,.006),this.module._tongueSetOscillationScale(this.tonguePointer,D);if(this.frame,this.exitStartFrame,this.module._blobStep(this.blobPointer,this.yScale,this.zOffset,r[0],r[1],r[2]),e.length>0){var L=this.getMouthCentroid();this.mouthY=Object(f.n)(this.mouthY,L[1],1);var N={midiPitch:T(this.scale,Object(f.l)(this.MIN_Y,this.MAX_Y,this.mouthY),this.currentPitchVowel.midiPitch,.3),vowel:T(k,Object(f.l)(this.MIN_Z,this.MAX_Z,L[2]),this.currentPitchVowel.vowel,.2)};this.liveMidiNote.change(N.midiPitch,.2),A(this.currentPitchVowel,N)||(this.timeCurrentNoteReached=Date.now(),this.currentPitchVowel=N)}else this.currentPitchVowel={midiPitch:0,vowel:y.b.a};var O=this.isSinging?n.getMidiNote()-mt:null;this.pitchUI.update(!!e.find((function(t){return t.isSelf})),this.currentPitchVowel.midiPitch,O),this.vowelUI.update(!!e.find((function(t){return t.isSelf})),this.currentPitchVowel.vowel,this.isSinging?this.lastSoundedVowel:null),this.recomputeMatrices(),c.transformPosition(this.localLookPosition,this.lookPosition,this.inverseModelMatrix);for(var j=0,U=this.eyes;j<U.length;j++){U[j].step(this.localLookPosition,Math.PI/2-this.getTopEyelidAngleWithoutBlink())}this.updateRenderData(),this.smoothIsSinging.change(this.isSinging?1:0,.1),this.rimLevel.change(this.isDragging?.4:0,.1),this.frame+=1},t.prototype.getTimeOnCurrentNote=function(){return(Date.now()-this.timeCurrentNoteReached)/1e3},t.prototype.updateRenderData=function(){var t=this.module.HEAPF32.subarray(this.module._blobGetRenderingPositions(this.blobPointer)>>2,(this.module._blobGetRenderingPositions(this.blobPointer)>>2)+3*this.renderingVertexCount),e=this.module.HEAPF32.subarray(this.module._blobGetRenderingNormals(this.blobPointer)>>2,(this.module._blobGetRenderingNormals(this.blobPointer)>>2)+3*this.renderingVertexCount),n=this.module.HEAPF32.subarray(this.module._blobGetRenderingSpeeds(this.blobPointer)>>2,(this.module._blobGetRenderingSpeeds(this.blobPointer)>>2)+1*this.renderingVertexCount),i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,this.positionsBuffer),i.bufferData(i.ARRAY_BUFFER,t,i.DYNAMIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this.normalsBuffer),i.bufferData(i.ARRAY_BUFFER,e,i.DYNAMIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this.speedsBuffer),i.bufferData(i.ARRAY_BUFFER,n,i.DYNAMIC_DRAW)},t.prototype.getMouthPositions=function(){return this.module.HEAPF32.subarray(this.module._blobGetMouthPositions(this.blobPointer)>>2,(this.module._blobGetMouthPositions(this.blobPointer)>>2)+3*this.mouthPositionCount)},t.prototype.rayIntersect=function(t,e){var n=c.transformPosition([],t,this.inverseModelMatrix),i=c.transformDirection([],e,this.inverseModelMatrix);return h.a.normalize(i,i),this.module._blobRayIntersect(this.blobPointer,n[0],n[1],n[2],i[0],i[1],i[2])},t.prototype.getVertexPosition=function(t){return this.module.HEAPF32.subarray((this.module._blobGetPositions(this.blobPointer)>>2)+3*t,(this.module._blobGetPositions(this.blobPointer)>>2)+3*t+3)},t.prototype.getRestPosition=function(t){return this.module.HEAPF32.subarray((this.module._blobGetRestPositions(this.blobPointer)>>2)+3*t,(this.module._blobGetRestPositions(this.blobPointer)>>2)+3*t+3)},t.prototype.getBrimPositions=function(){return this.module.HEAPF32.subarray(this.module._blobGetBrimPositions(this.blobPointer)>>2,48+(this.module._blobGetBrimPositions(this.blobPointer)>>2))},t.prototype.getHatModelMatrix=function(){return c.premultiply(this.hatModelMatrix,c.makeTranslation(this.tempMatrix,0,10*this.hatOffset.evaluate(),0),this.modelMatrix),this.hatModelMatrix},t.prototype.getTonguePositions=function(){return this.module.HEAPF32.subarray(this.module._tongueGetPositions(this.tonguePointer)>>2,(this.module._tongueGetPositions(this.tonguePointer)>>2)+3*this.tonguePositionCount)},t.prototype.getTongueTangents=function(){return this.module.HEAPF32.subarray(this.module._tongueGetTangents(this.tonguePointer)>>2,(this.module._tongueGetTangents(this.tonguePointer)>>2)+3*this.tonguePositionCount)},t.prototype.getTongueNormals=function(){return this.module.HEAPF32.subarray(this.module._tongueGetNormals(this.tonguePointer)>>2,(this.module._tongueGetNormals(this.tonguePointer)>>2)+3*this.tonguePositionCount)},t.prototype.getBottomEyelidAngle=function(){return this.blinker.evaluate()*this.eyeBottomOpenness.evaluate()*Math.PI*.5},t.prototype.getTopEyelidAngleWithoutBlink=function(){return Math.max(0,Object(f.n)(0,1-this.config.eye.topLidClamp,this.eyeTopOpenness.evaluate()-this.eyeOverrideOpenness.evaluate()))*Math.PI*.5},t.prototype.getTopEyelidAngle=function(){return Object(f.n)(0,this.getTopEyelidAngleWithoutBlink(),this.blinker.evaluate())},t.prototype.getMouthCentroid=function(){var t=this.module._blobGetMouthCentroid(this.blobPointer);return this.module.HEAPF32.subarray(t>>2,3+(t>>2))},t.prototype.getIntersectedRestPosition=function(){var t=this.module._blobGetIntersectedRestPosition(this.blobPointer);return this.module.HEAPF32.subarray(t>>2,3+(t>>2))},t.prototype.getRestWidth=function(){for(var t=1/0,e=-1/0,n=0;n<this.vertexCount;++n){var i=this.restPositions[3*n+0];t=Math.min(t,i),e=Math.max(e,i)}return e-t},t.prototype.getTopPosition=function(){for(var t=0;t<3;++t)this.topPosition[t]=.5*(this.eyes[0].attachPosition[t]+this.eyes[1].attachPosition[t]);return this.topPosition},t.prototype.destroy=function(){this.module._deleteBlob(this.blobPointer);var t=this.gl;t.deleteBuffer(this.positionsBuffer),t.deleteBuffer(this.uvsBuffer),t.deleteBuffer(this.normalsBuffer),t.deleteBuffer(this.indexBuffer),t.deleteBuffer(this.speedsBuffer)},t.INITIAL_FALL_SPEED=-.02,t.GRAVITY=-.002,t.INITIAL_RISE_SPEED=0,t.RISE_ACCELERATION=.006,t}();function L(t,e){return t+Math.random()*(e-t)}function N(t,e,n,i){var o=L(-10,10),r=L(-10,10);return[o,(-i-t*o-n*r)/e,r]}var O=function(){function t(t,e,n,i){this.particleCount=1e4,this.nextSpawnIndex=0,this.gl=t;for(var o=[],r=[],a=0;a<this.particleCount;++a){r.push(-1,-1),r.push(1,-1),r.push(1,1),r.push(-1,1);var s=4*a;o.push(s+0,s+1,s+2),o.push(s+2,s+3,s+0)}this.offsetBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW);var l=-i[1]+i[3],c=-i[5]+i[7],h=-i[9]+i[11],f=-i[13]+i[15],d=[],p=[];for(a=0;a<this.particleCount;++a)for(var m=e?-(this.particleCount-1-a)/n:-999999999,g=e?N(l,c,h,f):[0,0,0],b=0;b<4;++b)d.push(m),p.push(g[0]),p.push(g[1]),p.push(g[2]);this.spawnTimeBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(d),t.DYNAMIC_DRAW),this.spawnPositionBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(p),t.DYNAMIC_DRAW);var v=[];for(a=0;a<this.particleCount;++a){var y=[Math.random(),Math.random(),Math.random(),Math.random()];for(b=0;b<4;++b)v.push(Math.random(),y[1],y[2],y[3])}this.randomBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(v),t.STATIC_DRAW),this.indexBuffer=u(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(o),t.STATIC_DRAW),this.spawnTimeData=new Float32Array(4*this.particleCount),this.spawnPositionData=new Float32Array(3*this.particleCount*4)}return t.prototype.prespawn=function(t){},t.prototype.spawn=function(t,e,n,i){if(0!==e){this.nextSpawnIndex+e>=this.particleCount&&(this.nextSpawnIndex=0);for(var o=-i[1]+i[3],r=-i[5]+i[7],a=-i[9]+i[11],s=-i[13]+i[15],l=0;l<e;++l)for(var u=N(o,r,a,s),c=t-Math.random()*n,h=0;h<4;++h)this.spawnTimeData[4*l+h]=c,this.spawnPositionData[4*l*3+3*h+0]=u[0],this.spawnPositionData[4*l*3+3*h+1]=u[1],this.spawnPositionData[4*l*3+3*h+2]=u[2];var f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,this.spawnTimeBuffer),f.bufferSubData(f.ARRAY_BUFFER,4*this.nextSpawnIndex*4,this.spawnTimeData.subarray(0,4*e)),f.bindBuffer(f.ARRAY_BUFFER,this.spawnPositionBuffer),f.bufferSubData(f.ARRAY_BUFFER,4*this.nextSpawnIndex*3*4,this.spawnPositionData.subarray(0,4*e*3)),this.nextSpawnIndex+=e}},t.prototype.update=function(t,e,n,i){var o=Math.floor(e*n);this.spawn(t,o,e,i)},t}();var j=[1,.37,.3];function U(t,e){for(var n=[],i=0;i<3;++i){var o=e/(.001+j[i]);n[i]=Math.exp(-o*o/(2*t))/(2*Math.PI*t)}return n}function z(t,e){for(var n=function(t){for(var e=t>20?3:2,n=[],i=2*e/(t-1),o=0;o<t;++o){var r=o*i-e,a=r<0?-1:1;n.push(e*a*Math.abs(Math.pow(r,2))/Math.pow(e,2))}var s,l=[];for(o=0;o<t;++o){var u=((o>0?Math.abs(n[o]-n[o-1]):0)+(o<t-1?Math.abs(n[o]-n[o+1]):0))/2;(c=h.a.multiplyByScalar([],(s=n[o],h.a.addList([],[h.a.multiplyByScalar([],U(.0484,s),.1),h.a.multiplyByScalar([],U(.187,s),.118),h.a.multiplyByScalar([],U(.567,s),.113),h.a.multiplyByScalar([],U(1.99,s),.358),h.a.multiplyByScalar([],U(7.41,s),.078)])),u))[3]=n[o],l.push(c)}var c=l[Math.floor(t/2)];for(o=Math.floor(t/2);o>0;--o)l[o]=l[o-1];l[0]=c;var f=h.a.addList([],l);for(o=0;o<t;++o)l[o][0]/=f[0],l[o][1]/=f[1],l[o][2]/=f[2];return l}(t),i="vec3("+n[0][0].toFixed(10)+","+n[0][1].toFixed(10)+","+n[0][2].toFixed(10)+")",o="precision highp float;\n\n        varying vec2 v_coordinates;\n\n        uniform sampler2D u_colorTexture;\n\n        uniform vec2 u_direction;\n        uniform vec2 u_resolution;\n\n        uniform mat4 u_projectionMatrix;\n        uniform float u_near;\n        uniform float u_far;\n\n        #define SSS_INDEX_COUNT 8\n        float getSSSAlpha(int sssIndex) {\n            return float(sssIndex + 1) / float(SSS_INDEX_COUNT);\n        }\n\n        int sssAlphaToIndex(float sssAlpha) {\n            return int(sssAlpha * float(SSS_INDEX_COUNT) - 0.9);\n        }\n\n        float linearizeDepth (float depth, float near, float far) {\n            depth = 2.0 * depth - 1.0;\n            return 2.0 * near * far / (far + near - depth * (far - near));\n        }\n\n        float rand(vec2 co){\n            return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n        }\n\n        void main () {\n            vec4 color = texture2D(u_colorTexture, v_coordinates);\n\n            if (color.a == 0.0) discard;\n\n            vec3 colorM = color.rgb;\n            float z = 20.0;\n\n            float width = 0.1; //filter width in world space\n            width *= (1.0 + rand(gl_FragCoord.xy) * 0.3);\n\n            vec4 corner = vec4(width, width, z, 1.0);\n            corner = u_projectionMatrix * corner;\n            corner.xyz /= corner.w;\n            corner.xy *= 0.5;\n            corner.xy = abs(corner.xy);\n\n            int sssIndex = sssAlphaToIndex(color.a);\n            vec3 strength = vec3(0.2);\n            ",r=0;r<e.length;++r){var a=e[r];o+="\n                    "+(0===r?"if":"else if")+"  (sssIndex == "+r.toFixed(0)+") {\n                        strength = vec3("+a[0].toFixed(10)+", "+a[1].toFixed(10)+", "+a[2].toFixed(10)+");\n                    }\n                \n                "}o+="\n            vec3 kernel0 = "+i+";\n            kernel0 = (1.0 - strength) + strength * kernel0;\n\n            vec3 colorBlurred = colorM;\n            colorBlurred *= kernel0;\n\n            vec2 delta = u_direction * corner.xy;\n    ",o+="\n";for(r=1;r<n.length;++r){var s=n[r],l="sample"+r.toFixed(0);o+="\n            vec4 "+l+" = texture2D(u_colorTexture, v_coordinates + delta * "+s[3].toFixed(10)+");\n            //'if (' + sampleName + '.a == 0.0) ' + sampleName + '.rgb = colorM;\n            "+l+".rgb = color.a == "+l+".a ? "+l+".rgb : colorM;\n            colorBlurred.rgb += vec3("+s[0].toFixed(10)+", "+s[1].toFixed(10)+", "+s[2].toFixed(10)+") * "+l+".rgb * strength;\n        "}return o+="\n            gl_FragColor = vec4(colorBlurred, color.a);\n        }"}function G(t,e){return t+Math.random()*(e-t)}function V(t,e){var n=G(-10,10),i=G(-10,10),o=G(-10,10);return 0===e?n=(-t.d-t.b*i-t.c*o)/t.a:1===e&&(i=(-t.d-t.a*n-t.c*o)/t.b),[n,i,o]}function H(t,e){t.a=-e[1]+e[3],t.b=-e[5]+e[7],t.c=-e[9]+e[11],t.d=-e[13]+e[15]}function Y(t,e){t.a=e[1]+e[3],t.b=e[5]+e[7],t.c=e[9]+e[11],t.d=e[13]+e[15]}function W(t,e){t.a=-e[0]+e[3],t.b=-e[4]+e[7],t.c=-e[8]+e[11],t.d=-e[12]+e[15]}function q(t,e){t.a=e[0]+e[3],t.b=e[4]+e[7],t.c=e[8]+e[11],t.d=e[12]+e[15]}var X=["left","right","bottom","top"],Z=function(){function t(t,e,n,i){this.particleCount=1e4,this.nextSpawnIndex=0,this.gl=t;for(var o=[],r=[],a=0;a<this.particleCount;++a){r.push(-1,-1),r.push(1,-1),r.push(1,1),r.push(-1,1);var s=4*a;o.push(s+0,s+1,s+2),o.push(s+2,s+3,s+0)}this.offsetBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),this.spawnTimeBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(4*this.particleCount),t.DYNAMIC_DRAW),this.spawnPositionBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(4*this.particleCount*3),t.DYNAMIC_DRAW),this.spawnVelocityBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(4*this.particleCount*3),t.DYNAMIC_DRAW);var l=[];for(a=0;a<this.particleCount;++a)for(var c=[Math.random(),Math.random(),Math.random(),Math.random()],h=0;h<4;++h)l.push(Math.random(),c[1],c[2],c[3]);this.randomBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(l),t.STATIC_DRAW),this.indexBuffer=u(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(o),t.STATIC_DRAW),this.spawnTimeData=new Float32Array(4*this.particleCount*1),this.spawnPositionData=new Float32Array(4*this.particleCount*3),this.spawnVelocityData=new Float32Array(4*this.particleCount*3),e&&this.spawn(0,this.particleCount,0,i,1/n)}return t.prototype.spawn=function(t,e,n,i,o){if(0!==e){this.nextSpawnIndex+e>=this.particleCount&&(this.nextSpawnIndex=0);for(var r=0;r<e;++r){var a=X[Math.floor(Math.random()*X.length)],s={a:0,b:0,c:0,d:0},l=.5*Math.PI,u=G(-l/2,l/2),c=0;"left"===a?(W(s,i),c=Math.PI+u):"right"===a?(q(s,i),c=0+u):"top"===a?(H(s,i),c=-Math.PI/2+u):"bottom"===a&&(Y(s,i),c=Math.PI/2+u);var h=void 0;"left"===a||"right"===a?h=V(s,0):"bottom"!==a&&"top"!==a||(h=V(s,1));for(var f=G(.01,.1),d=t-Math.random()*n-(this.particleCount-1-r)*o,p=0;p<4;++p)this.spawnTimeData[4*r+p]=d,this.spawnPositionData[4*r*3+3*p+0]=h[0],this.spawnPositionData[4*r*3+3*p+1]=h[1],this.spawnPositionData[4*r*3+3*p+2]=h[2],this.spawnVelocityData[4*r*3+3*p+0]=Math.cos(c)*f,this.spawnVelocityData[4*r*3+3*p+1]=Math.sin(c)*f,this.spawnVelocityData[4*r*3+3*p+2]=0}var m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,this.spawnTimeBuffer),m.bufferSubData(m.ARRAY_BUFFER,4*this.nextSpawnIndex*4,this.spawnTimeData.subarray(0,4*e)),m.bindBuffer(m.ARRAY_BUFFER,this.spawnPositionBuffer),m.bufferSubData(m.ARRAY_BUFFER,4*this.nextSpawnIndex*3*4,this.spawnPositionData.subarray(0,4*e*3)),m.bindBuffer(m.ARRAY_BUFFER,this.spawnVelocityBuffer),m.bufferSubData(m.ARRAY_BUFFER,4*this.nextSpawnIndex*3*4,this.spawnVelocityData.subarray(0,4*e*3)),this.nextSpawnIndex+=e}},t.prototype.update=function(t,e,n,i){var o=Math.floor(e*n);this.spawn(t,o,e,i,0)},t}();var J="\nprecision highp float;\n\nattribute vec3 a_data;\nattribute vec3 a_normal;\nattribute vec2 a_uv;\n\nuniform int u_vertexCount;\nuniform vec3 u_positions[24];\n\nuniform mat4 u_modelMatrix;\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\n\nuniform float u_lipScale;\n\nvarying float v_linearPosition;\nvarying vec3 v_normal;\nvarying vec3 v_position;\nvarying vec2 v_uv;\nvarying vec3 v_localPosition;\n\n#ifdef SHADOW\nvarying vec4 v_clipSpacePosition;\n#endif\n\nvec3 sampleFilament(float filamentIndex, float vertexIndex) {\n    return u_positions[int(vertexIndex + 0.001)] + vec3(0.0, 0.0, 0.04);\n}\n\nvec3 evaluateCubicSpline(vec3 leftPosition, vec3 rightPosition, vec3 leftTangent, vec3 rightTangent, float t) {\n    float t2 = t * t;\n    float t3 = t2 * t;\n\n    return (2.0 * t3 - 3.0 * t2 + 1.0) * leftPosition + (t3 - 2.0 * t2 + t) * leftTangent + (-2.0 * t3 + 3.0 * t2) * rightPosition + (t3 - t2) * rightTangent;\n}\n\nvec3 evaluateCubicSplineTangent(vec3 leftPosition, vec3 rightPosition, vec3 leftTangent, vec3 rightTangent, float t) {\n    float t2 = t * t;\n    return (6.0 * t2 - 6.0 * t) * leftPosition + (3.0 * t2 - 4.0 * t + 1.0) * leftTangent + (-6.0 * t2 + 6.0 * t) * rightPosition + (3.0 * t2 - 2.0 * t) * rightTangent;\n}\n\nfloat posMod(float i, float n) {\n    return mod((n + mod(i, n)), n);\n}\n\nvoid main () {\n    float lipScale = u_lipScale * 0.032;\n    vec3 position = a_data.xyz * vec3(lipScale, lipScale, float(u_vertexCount - 1));\n    float filamentIndex = 0.0;\n\n    v_linearPosition = a_data.z;\n\n    float index = position.z;\n    float leftIndex = floor(position.z + 0.001);\n    float rightIndex = floor(mod(leftIndex + 1.0001, float(u_vertexCount)));\n    \n    float t = clamp(index - leftIndex, 0.0, 1.0);\n\n    vec3 leftLeftPosition = sampleFilament(filamentIndex, floor(posMod(leftIndex - 0.9999, float(u_vertexCount)))).xyz;\n    vec3 leftPosition = sampleFilament(filamentIndex, leftIndex).xyz;\n    vec3 rightPosition = sampleFilament(filamentIndex, rightIndex).xyz;\n    vec3 rightRightPosition = sampleFilament(filamentIndex, floor(posMod(rightIndex + 1.0001, float(u_vertexCount)))).xyz;\n\n    vec3 leftTangent = (rightPosition - leftLeftPosition) * 0.5;\n    vec3 rightTangent = (rightRightPosition - leftPosition) * 0.5;\n\n    //vec3 tangent = normalize(mix(leftTangent, rightTangent, t));\n    vec3 tangent = normalize(evaluateCubicSplineTangent(leftPosition, rightPosition, leftTangent, rightTangent, t));\n\n    vec3 right = normalize(cross(tangent, vec3(0.0, 0.0, 1.0)));\n    vec3 up = normalize(cross(right, tangent));\n\n    vec3 localNormal = normalize(vec3(a_data.x, a_data.y, 0.0));\n\n    localNormal = normalize(localNormal.x * right + localNormal.y * up);\n    v_normal = (u_modelMatrix * vec4(localNormal, 0.0)).xyz;\n\n    vec3 localPosition = evaluateCubicSpline(leftPosition, rightPosition, leftTangent, rightTangent, t) + position.x * right + position.y * up;\n    v_localPosition = localPosition;\n\n    vec3 worldPosition = (u_modelMatrix * vec4(localPosition, 1.0)).xyz;\n    v_position = worldPosition;\n    v_uv = a_uv;\n\n    #ifdef SHADOW\n    v_clipSpacePosition = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n    #endif\n\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n\n    //gl_Position = vec4(position.xz, 0.0, 1.0);\n}\n",K="\nprecision highp float;\n\nvarying vec4 v_clipSpacePosition;\n\nconst float PackUpscale = 256.0 / 255.0;\nconst float UnpackDownscale = 255.0 / 256.0;\n\nconst vec3 PackFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);\nconst vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);\n\nconst float ShiftRight8 = 1.0 / 256.0;\n\nvec4 packDepthToRGBA(const in float v) {\n    vec4 r = vec4(fract(v * PackFactors), v);\n    r.yzw -= r.xyz * ShiftRight8;\n    return r * PackUpscale;\n}\n\nvoid main () {\n\tfloat ndcDepth = v_clipSpacePosition.z / v_clipSpacePosition.w;\n\tgl_FragColor = packDepthToRGBA(ndcDepth * 0.5 + 0.5);\n}\n",Q="\nprecision highp float;\n\nattribute vec2 a_position;\nvarying vec2 v_uv;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\n\nuniform mat4 u_referenceProjectionViewMatrix;\n\nvarying vec4 v_clipSpacePosition;\nvarying vec4 v_referenceClipSpacePosition;\n\nuniform float u_transitionT;\n\nvec2 rotate(vec2 v, float a) {\n\tfloat s = sin(a);\n\tfloat c = cos(a);\n\tmat2 m = mat2(c, -s, s, c);\n\treturn m * v;\n}\n\n#define PI 3.1415926535\n\nvoid main () {\n    v_uv = a_position * 0.5 + 0.5;\n\n    vec2 planarPosition = rotate(vec2(a_position.x, 0.0), 0.523599);\n\n    vec3 worldPosition = vec3(\n        planarPosition.x,\n        a_position.y,\n        planarPosition.y\n    );\n\n    worldPosition *= 1000.0;\n    worldPosition.z -= 0.0;\n\n    v_referenceClipSpacePosition = u_referenceProjectionViewMatrix * vec4(worldPosition, 1.0);\n    v_clipSpacePosition = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n\n    vec4 position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n    position.z = position.w - 0.001;\n    gl_Position = position;\n}\n",$="\nprecision highp float;\n\nvarying vec2 v_uv;\n\nvarying vec4 v_clipSpacePosition;\nvarying vec4 v_referenceClipSpacePosition;\nuniform sampler2D u_texture;\nuniform sampler2D u_newTexture;\n\nuniform float u_transitionT;\n\nuniform vec2 u_screenResolution;\nuniform vec2 u_imageResolution;\n\nuniform float u_zoom;\n\nuniform float u_intensity;\nuniform float u_time;\n\nuniform vec2 u_fov;\nuniform float u_yScale;\n\nvec3 hsv2rgb(vec3 c) {\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvec3 rgb2hsv(vec3 c) {\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec2 cover(vec2 uv, vec2 s, vec2 i) {\n    float imageRatio = i.y / i.x;\n    float screenRatio = s.y / s.x;\n\n    vec2 imageDimensions = screenRatio > imageRatio ?\n        vec2(s.y / imageRatio, s.y) :\n        vec2(s.x, s.x * imageRatio);\n\n    vec2 imageOrigin = s * 0.5 - imageDimensions * vec2(1.0, 1.0) * 0.5;\n    vec2 result = (((vec2(uv.x, 1.0 - uv.y) * s)) - imageOrigin) / imageDimensions;\n    result.y = result.y;\n    return result;\n}\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n#define SAMPLES 5\n\nvec4 sampleBlurred(sampler2D tex, vec2 uv, float blurWidth) {\n    blurWidth *= 1.0 + rand(uv) * 0.2;\n    vec4 accumulate = vec4(0.0);\n    float sampleCount = float(2 * SAMPLES + 1);\n    for (int i = -SAMPLES; i <= SAMPLES; ++i) {\n        accumulate += texture2D(tex, uv + vec2(blurWidth * float(i) / float(SAMPLES), 0.0));\n    }\n    accumulate /= sampleCount;\n    return accumulate;\n}\n\nvoid main () {\n    vec2 referenceTextureCoordinates = (v_referenceClipSpacePosition.xy / v_referenceClipSpacePosition.w);\n\n    float targetFOV = 0.3926991 * 2.5;\n    referenceTextureCoordinates *= u_fov / targetFOV;\n    referenceTextureCoordinates.xy *= u_yScale;\n    referenceTextureCoordinates = referenceTextureCoordinates * 0.5 + 0.5;\n\n    referenceTextureCoordinates.y += 0.075;\n\n    #ifdef BLUR\n    float OFFSET = 0.3;\n    float BLUR_WIDTH = 0.12;\n    vec4 color = sampleBlurred(u_texture, referenceTextureCoordinates + vec2(u_transitionT * OFFSET, 0.0), u_transitionT * BLUR_WIDTH);\n    vec4 newColor = sampleBlurred(u_newTexture, referenceTextureCoordinates + vec2(-(1.0 - u_transitionT) * OFFSET, 0.0), (1.0 - u_transitionT) * BLUR_WIDTH);\n    //vec4 newColor = texture2D(u_newTexture, referenceTextureCoordinates);\n    color = mix(color, newColor, u_transitionT);\n    #else\n    vec4 color = texture2D(u_newTexture, referenceTextureCoordinates);\n    #endif\n\n    color.rgb = vec3(0.5) + (color.rgb - 0.5) * 1.0;\n\n    vec3 hsv = rgb2hsv(color.rgb);\n    hsv.g *= mix(1.0, 1.5, u_intensity);\n    // hsv.g -= 0.1;\n    //hsv.b = max(hsv.b - 0.3, 0.0);\n    // //hsv.z *= mix(1.0, 0.5, u_intensity);\n\n    vec3 finalColor = hsv2rgb(hsv);\n\n    vec2 textureCoordinates = (v_clipSpacePosition.xy / v_clipSpacePosition.w) * 0.5 + 0.5;\n    vec3 direction = normalize(vec3(\n    \t(textureCoordinates * 2.0 - 1.0) * mix(0.001, 1.0, u_intensity),\n    \t-1.0));\n\n    float factor = pow(max(-direction.z, 0.0), 4.0);\n    finalColor *= factor;\n\n    gl_FragColor = vec4(finalColor, 1.0);\n\n   // gl_FragColor = vec4(vec3(factor * 0.3), 1.0);\n}\n",tt="\nprecision highp float;\n\nattribute vec4 a_parameters; //(aroundIndex, alongIndex, scale, material)\nattribute vec3 a_normal;\n\nvarying vec3 v_worldPosition;\nvarying vec3 v_color;\nvarying vec3 v_normal;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_modelMatrix;\n\nuniform vec3 u_profilePoints[16];\n\n#define PI 3.14159265358979323846\n#define SPLINE_POINT_COUNT 10\n\nuniform vec3 u_splinePositions[SPLINE_POINT_COUNT];\nuniform vec3 u_splineTangents[SPLINE_POINT_COUNT];\nuniform vec3 u_splineNormals[SPLINE_POINT_COUNT];\n\n#ifdef SHADOW\nvarying vec4 v_clipSpacePosition;\n#endif\n\nfloat linearstep(float left, float right, float x) {\n    return clamp((x - left) / (right - left), 0.0, 1.0);\n}\n\nvoid main() {\n    float aroundIndex = a_parameters.x;\n    float alongIndex = a_parameters.y;\n    float scale = a_parameters.z;\n    float material = a_parameters.w;\n\n    float angle = 2.0 * PI * float(aroundIndex) / 16.0;\n    vec3 flatPlanarPosition = vec3(\n        -cos(angle),\n        -sin(angle),\n        0.0\n    ) * 0.35;\n\n    vec3 planarPosition = u_profilePoints[int(aroundIndex + 0.1)];\n    planarPosition = mix(planarPosition, flatPlanarPosition, linearstep(3.0, float(SPLINE_POINT_COUNT - 1), alongIndex));\n\n    vec3 planarNormal = a_normal;\n\n    vec3 framePosition = vec3(0.0);\n    vec3 frameTangent = vec3(0.0);\n    vec3 frameNormal = vec3(0.0);\n\n    float SPACING = 0.13;\n\n    if (alongIndex >= float(SPLINE_POINT_COUNT - 1)) {\n        framePosition = u_splinePositions[SPLINE_POINT_COUNT - 1] + u_splineTangents[SPLINE_POINT_COUNT - 1] * SPACING * (alongIndex - float(SPLINE_POINT_COUNT - 1));\n        frameTangent = u_splineTangents[SPLINE_POINT_COUNT - 1];\n        frameNormal = u_splineNormals[SPLINE_POINT_COUNT - 1];\n    } else if (alongIndex <= 0.0) {\n        framePosition = u_splinePositions[0];\n        frameTangent = u_splineTangents[0];\n        frameNormal = u_splineNormals[0];\n    } else {\n        int leftIndex = int(alongIndex + 0.001);\n        int rightIndex = leftIndex + 1;\n\n        framePosition = mix(u_splinePositions[leftIndex], u_splinePositions[rightIndex], fract(alongIndex));\n        frameTangent = normalize(mix(u_splineTangents[leftIndex], u_splineTangents[rightIndex], fract(alongIndex)));\n        frameNormal = normalize(mix(u_splineNormals[leftIndex], u_splineNormals[rightIndex], fract(alongIndex)));\n    }\n\n    vec3 frameRight = normalize(cross(frameTangent, frameNormal));\n\n    vec3 localPosition = framePosition + planarPosition.x * frameRight * scale + planarPosition.y * frameNormal * scale + planarPosition.z * frameTangent;\n    vec3 localNormal = normalize(planarNormal.x * frameRight + planarNormal.y * frameNormal + planarNormal.z * frameTangent);\n\n    v_normal = (u_modelMatrix * vec4(localNormal, 0.0)).xyz;\n\n    v_color = material < 0.5 ? vec3(1.0, 1.0, 1.0) : vec3(1.0, vec2(0.03));\n\n    vec3 worldPosition = (u_modelMatrix * vec4(localPosition, 1.0)).xyz;\n    v_worldPosition = worldPosition;\n\n    #ifdef SHADOW\n    v_clipSpacePosition = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n    #endif\n\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",et="\nprecision highp float;\n\nattribute vec2 a_position;\n\nvarying vec2 v_coordinates;\n\nvoid main () {\n    v_coordinates = a_position * 0.5 + 0.5;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n}\n",nt=function(t,e,n,i,o,a){this.color=new Float32Array([o,o,o]),this.shadowsEnabled=a;var s=[0,4.25,2];this.position=new Float32Array([s[0]+i*Math.sin(Math.PI/2-n)*Math.sin(-e),s[1]+i*Math.cos(Math.PI/2-n),s[2]+i*Math.sin(Math.PI/2-n)*Math.cos(-e)]),this.shadowsEnabled&&(this.viewMatrix=c.makeLookAt(new Float32Array(16),this.position,[0,.5,0],[0,1,0]),c.invert(this.viewMatrix,this.viewMatrix),this.projectionMatrix=c.makePerspective(new Float32Array(16),Math.PI/8,1,.5,100),this.projectionViewMatrix=c.premultiply(new Float32Array(16),this.viewMatrix,this.projectionMatrix),this.shadowMapWidth=512,this.depthColorTexture=r(t,0,t.RGBA,t.UNSIGNED_BYTE,this.shadowMapWidth,this.shadowMapWidth,null,t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE,t.LINEAR,t.LINEAR),this.depthRenderbuffer=l(t,t.DEPTH_COMPONENT16,this.shadowMapWidth,this.shadowMapWidth))};var it=function(){function t(t,e,n,o,a,h,p,m){this.projectionMatrix=new Float32Array(16),this.infiniteProjectionMatrix=new Float32Array(16),this.referenceProjectionMatrix=new Float32Array(16),this.inverseProjectionMatrix=new Float32Array(16),this.viewMatrix=new Float32Array(16),this.inverseViewMatrix=new Float32Array(16),this.cameraPosition=new Float32Array(3),this.projectionViewMatrix=new Float32Array(16),this.lights=[],this.dustScale=new d.a(0),this.paddingHeight=0,this.snowSpawnRate=0,this.backgroundIntensity=new d.a(0),this.backgroundTransitionT=new d.a(0,(function(t){return Object(f.r)(0,1,t)})),this.canvas=t,this.gl=e;var g=e.getExtension("OES_standard_derivatives");this.fov=Object(f.e)(p);var b=function(t){var e="\nprecision highp float;\n\n#define PI 3.14159265358979323846\n\nuniform vec3 u_cameraPosition;\n\nuniform float u_gamma;\n\nuniform vec3 u_lightPosition0;\nuniform vec3 u_lightColor0;\nuniform mat4 u_lightProjectionViewMatrix0;\nuniform sampler2D u_shadowDepthTexture0;\nuniform vec2 u_shadowResolution0;\n\nuniform vec3 u_lightPosition1;\nuniform vec3 u_lightColor1;\nuniform mat4 u_lightProjectionViewMatrix1;\nuniform sampler2D u_shadowDepthTexture1;\nuniform vec2 u_shadowResolution1;\n\nuniform vec3 u_lightPosition2;\nuniform vec3 u_lightColor2;\n\nfloat square (float x) {\n    return x * x;\n}\n\nfloat fresnel (float F0, float lDotH) {\n    float f = pow(1.0 - lDotH, 5.0);\n\n    return (1.0 - F0) * f + F0;\n}\n\nfloat GGX (float alpha, float nDotH) {\n    float a2 = square(alpha);\n\n    return a2 / (PI * square(square(nDotH) * (a2 - 1.0) + 1.0));\n}\n\nfloat GGGX (float alpha, float nDotL, float nDotV) {\n    float a2 = square(alpha);\n\n    float gl = nDotL + sqrt(a2 + (1.0 - a2) * square(nDotL));\n    float gv = nDotV + sqrt(a2 + (1.0 - a2) * square(nDotV));\n\n    return 1.0 / (gl * gv);\n}\n\nfloat saturate (float x) {\n    return clamp(x, 0.0, 1.0);\n}\n\nfloat specularBRDF (vec3 lightDirection, vec3 eyeDirection, vec3 normal, float roughness, float F0) {\n    vec3 halfVector = normalize(lightDirection + eyeDirection);\n\n    float nDotH = saturate(dot(normal, halfVector));\n    float nDotL = saturate(dot(normal, lightDirection));\n    float nDotV = saturate(dot(normal, eyeDirection));\n    float lDotH = saturate(dot(lightDirection, halfVector));\n\n    float D = GGX(roughness, nDotH);\n    float G = GGGX(roughness, nDotL, nDotV);\n    float F = fresnel(F0, lDotH);\n\n    return smoothstep(-0.2, 0.0, dot(lightDirection, normal)) * D * G * F;\n}\n\n\nconst float PackUpscale = 256.0 / 255.0;\nconst float UnpackDownscale = 255.0 / 256.0;\n\nconst vec3 PackFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);\nconst vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);\n\nconst float ShiftRight8 = 1.0 / 256.0;\n\nfloat unpackRGBAToDepth(const in vec4 v) {\n    return dot(v, UnpackFactors);\n}\n\nfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n    return step(compare, unpackRGBAToDepth(texture2D( depths, uv)));\n}\n\nfloat texture2DShadow(sampler2D depths, vec2 size, vec2 uv, float compare) {\n    return texture2DCompare(depths, uv, compare);\n}\n\nfloat getShadow (vec3 worldPosition, vec3 worldNormal, mat4 projectionViewMatrix, sampler2D depthTexture, vec2 resolution) {\n    vec4 lightSpacePosition = projectionViewMatrix * vec4(worldPosition + worldNormal * 0.00001, 1.0);\n    lightSpacePosition /= lightSpacePosition.w;\n    lightSpacePosition = lightSpacePosition * 0.5 + 0.5;\n    vec2 lightSpaceCoordinates = lightSpacePosition.xy;\n\n    <shadow>\n}\n\nvec3 shadeSurfaceWithLightWithoutShadow(vec3 worldPosition, vec3 worldNormal, vec3 albedo, float roughness, float F0, vec3 lightPosition, vec3 lightColor) {\n    vec3 lightDirection = normalize(lightPosition - worldPosition);\n    vec3 eyeDirection = normalize(u_cameraPosition - worldPosition);\n\n    float diffuse = saturate(dot(lightDirection, worldNormal));\n    float specular = specularBRDF(lightDirection, eyeDirection, worldNormal, roughness, F0);\n\n    float ambient = 0.0;\n    vec3 color = ((diffuse + ambient) * albedo + vec3(specular)) * lightColor;\n\n    return color;\n}\n\nvec3 shadeSurfaceWithLight (vec3 worldPosition, vec3 normal, vec3 albedo, float roughness, float F0, vec3 lightPosition, vec3 lightColor, mat4 projectionViewMatrix, sampler2D depthTexture, vec2 depthResolution) {\n    float shadow = getShadow(worldPosition, normal, projectionViewMatrix, depthTexture, depthResolution);\n    float ambient = 0.04;\n    vec3 color = shadeSurfaceWithLightWithoutShadow(worldPosition, normal, albedo, roughness, F0, lightPosition, lightColor) * shadow + ambient * albedo;\n    return color;\n}\n\nvec3 shadeSurfaceWithLights(vec3 worldPosition, vec3 worldNormal, vec3 albedo, float roughness, float F0) {\n    vec3 total = vec3(0.0);\n    total += shadeSurfaceWithLight(worldPosition, worldNormal, albedo, roughness, F0, u_lightPosition0, u_lightColor0, u_lightProjectionViewMatrix0, u_shadowDepthTexture0, u_shadowResolution0);\n    total += shadeSurfaceWithLight(worldPosition, worldNormal, albedo, roughness, F0, u_lightPosition1, u_lightColor1, u_lightProjectionViewMatrix1, u_shadowDepthTexture1, u_shadowResolution1);\n    total += shadeSurfaceWithLightWithoutShadow(worldPosition, worldNormal, albedo, roughness, F0, u_lightPosition2, u_lightColor2);\n    return total;\n}\n\nvec3 shadeSurfaceWithLightsWithoutShadow(vec3 worldPosition, vec3 worldNormal, vec3 albedo, float roughness, float F0) {\n    vec3 total = vec3(0.0);\n    total += shadeSurfaceWithLightWithoutShadow(worldPosition, worldNormal, albedo, roughness, F0, u_lightPosition0, u_lightColor0);\n    total += shadeSurfaceWithLightWithoutShadow(worldPosition, worldNormal, albedo, roughness, F0, u_lightPosition1, u_lightColor1);\n    total += shadeSurfaceWithLightWithoutShadow(worldPosition, worldNormal, albedo, roughness, F0, u_lightPosition2, u_lightColor2);\n    return total;\n}\n\nfloat getShadowFromLights(vec3 worldPosition) {\n    float total = 1.0;\n    total *= getShadow(worldPosition, vec3(0.0, 1.0, 0.0), u_lightProjectionViewMatrix0, u_shadowDepthTexture0, u_shadowResolution0);\n    total *= getShadow(worldPosition, vec3(0.0, 1.0, 0.0), u_lightProjectionViewMatrix1, u_shadowDepthTexture1, u_shadowResolution1);\n    return total;\n}\n\n#define SSS_INDEX_COUNT 32\nfloat getSSSAlpha(int sssIndex) {\n    return float(sssIndex + 1) / float(SSS_INDEX_COUNT);\n}\n\nint sssAlphaToIndex(float sssAlpha) {\n    return int(sssAlpha * float(SSS_INDEX_COUNT) - 0.99);\n}\n\n#ifdef HAS_STANDARD_DERIVATIVES\nmat3 cotangentFrame(vec3 N, vec3 p, vec2 uv) {\n    // get edge vectors of the pixel triangle\n    vec3 dp1 = dFdx(p);\n    vec3 dp2 = dFdy(p);\n    vec2 duv1 = dFdx(uv);\n    vec2 duv2 = dFdy(uv);   \n    // solve the linear system \n    vec3 dp2perp = cross(dp2, N);\n    vec3 dp1perp = cross(N, dp1);\n    vec3 T = dp2perp * duv1.x + dp1perp * duv2.x;\n    vec3 B = dp2perp * duv1.y + dp1perp * duv2.y;\n    // construct a scale-invariant frame\n    float invmax = inversesqrt(max(dot(T, T), dot(B, B)));\n    return mat3(T * invmax, B * invmax, N);\n}\n#endif\n\n".replace("<shadow>",function(t,e){for(var n=function(t,e){var n=[],i=.5/(t/2)-1,o=1/(t/2);i*=e,o*=e;for(var r=0;r<t;++r)for(var a=0;a<t;++a)n.push([i+a*o,i+r*o]);return n}(t,e/1024),i=["float shadow = 0.0;"],o=1/n.length,r=0;r<n.length;++r){var a=n[r],s="vec2("+a[0].toFixed(8)+","+a[1].toFixed(8)+")";i.push("shadow += "+o.toFixed(8)+" * texture2DShadow(depthTexture, resolution, lightSpaceCoordinates + "+s+", lightSpacePosition.z);")}return i.push("float ambient = 0.0;"),i.push("return ambient + shadow * (1.0 - ambient);"),i.join("\n")}(3,10));return t&&(e="#extension GL_OES_standard_derivatives : enable \n"+(e="#define HAS_STANDARD_DERIVATIVES 1 \n"+e)),e}(null!==g);this.backgroundOriginalViewMatrix=h,this.blobProgram=i(e,"\nprecision highp float;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_uv;\nattribute float a_speed;\n\nvarying vec3 v_normal;\nvarying vec3 v_position;\nvarying vec2 v_uv;\nvarying float v_speed;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelMatrix;\nuniform mat4 u_viewMatrix;\n\nfloat smin( float a, float b, float k ) {\n    float h = max( k-abs(a-b), 0.0 )/k;\n    return min( a, b ) - h*h*k*(1.0/4.0);\n}\n\nfloat smax(float a, float b, float k) {\n    return -smin(-a, -b, k);\n}\n\nvoid main () {\n    v_uv = a_uv;\n    vec3 worldPosition = (u_modelMatrix * vec4(a_position, 1.0)).xyz;\n    worldPosition.y = smax(worldPosition.y, 0.01, 0.1);\n    v_normal = (u_modelMatrix * vec4(-a_normal, 0.0)).xyz;\n    v_speed = a_speed;\n\n    v_position = worldPosition;\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",b+"\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying vec2 v_uv;\nvarying float v_speed;\n\nuniform vec3 u_color;\nuniform vec3 u_rimColor;\nuniform int u_blobIndex;\nuniform float u_normalScale;\nuniform float u_isSinging;\nuniform vec3 u_hsvShift;\n\nuniform sampler2D u_albedoTexture;\nuniform sampler2D u_materialMap;\n\nvec3 hsv2rgb(vec3 c) {\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvec3 rgb2hsv(vec3 c) {\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvoid main () {\n    vec3 diffuseColor = u_color;\n    vec4 albedo_with_alpha = texture2D(u_albedoTexture, v_uv);\n    vec3 albedo = albedo_with_alpha.rgb;\n    albedo = pow(albedo, vec3(2.2));\n    diffuseColor *= albedo;\n\n    vec3 diffuseHsv = rgb2hsv(diffuseColor);\n    diffuseHsv = diffuseHsv + u_hsvShift;//, vec3(0.0), vec3(1.0));\n    diffuseColor = hsv2rgb(diffuseHsv);\n\n    vec3 normal = normalize(v_normal);\n\n    vec4 materialParameters = texture2D(u_materialMap, v_uv);\n    float roughness = max(materialParameters.b, 0.001);\n    float f0 = materialParameters.b;\n\n    #ifdef HAS_STANDARD_DERIVATIVES\n    vec3 localNormal = vec3(materialParameters.r * 2.0 - 1.0, materialParameters.g * 2.0 - 1.0, 0.0);\n    localNormal.z = sqrt(1.0 - localNormal.x * localNormal.x - localNormal.y * localNormal.y);\n    mat3 frame = cotangentFrame(normal, v_position, v_uv);\n    normal = frame * localNormal;\n    #endif\n\n    float rim = abs(dot(normalize(u_cameraPosition - v_position), normalize(normal)));\n\n    vec3 color = shadeSurfaceWithLights(v_position, normal, diffuseColor, roughness, f0);\n\n    float rim2 = abs(dot(normalize(u_cameraPosition - v_position), normalize(v_normal)));\n    float shiftStrength = pow(rim2, 5.0);\n    float shift = clamp(pow(abs(v_speed), 1.0) * 0.04, -0.2, 0.2) * shiftStrength;\n    diffuseHsv.r += shift;\n\n    color += hsv2rgb(diffuseHsv) * abs(shift) * 3.0 * u_isSinging;\n\n    color.rgb += pow(1.0 - rim, 4.0) * u_rimColor;\n\n    gl_FragColor = vec4(color, getSSSAlpha(u_blobIndex));\n}\n",{a_position:0,a_normal:1,a_uv:2}),this.eyeProgram=i(e,"\nprecision highp float;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec3 a_restPosition;\n\nvarying vec3 v_normal;\nvarying vec3 v_localPosition;\nvarying vec3 v_restPosition;\nvarying vec3 v_position;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelMatrix;\nuniform mat4 u_viewMatrix;\n\nvoid main () {\n    vec3 worldPosition = (u_modelMatrix * vec4(a_position, 1.0)).xyz;\n    v_normal = (u_modelMatrix * vec4(-a_normal, 0.0)).xyz;\n    v_restPosition = a_restPosition;\n\n    v_localPosition = a_position;\n    v_position = worldPosition;\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",b+"\nvarying vec3 v_normal;\nvarying vec3 v_position;\nvarying vec3 v_localPosition;\nvarying vec3 v_restPosition;\n\nuniform int u_blobIndex;\nuniform float u_time;\nuniform vec3 u_lookDirection;\nuniform vec3 u_eyePosition;\nuniform float u_pupilNoiseOffset;\nuniform bool u_hipnotized;\nuniform vec3 u_lidColor;\nuniform float u_lidRoughness;\nuniform float u_lidF0;\nuniform float u_bottomEyelidAngle;\nuniform float u_topEyelidAngle;\nuniform float u_pupilSize;\n\n//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\nvec3 closestPointOnAxis (vec3 base, vec3 direction, vec3 point) {\n    return base + dot(point - base, direction) * direction;\n}\n\nfloat distanceFromAxis (vec3 base, vec3 direction, vec3 point) {\n    return distance(point, closestPointOnAxis(base, direction, point));\n}\n\nfloat spiral(float theta, float r) {\n  float alpha = step(0.1 * (u_pupilSize / 0.045), r);\n  return mix(step(0.5, mod(r * 25.0 / (u_pupilSize / 0.045) + theta / (2.0 * PI) - u_time * 1.1, 1.0)), 1.0, alpha);\n}\n\nvec3 eyeColor (vec3 point) {\n    //closest point on cylinder axis\n    vec3 closestPoint = closestPointOnAxis(u_eyePosition, u_lookDirection, point);\n\n    if (dot(u_lookDirection, v_localPosition - u_eyePosition) < 0.0) return vec3(1.0);\n\n    vec3 offset = point - closestPoint;\n\n    //find plane of cylinder\n    vec3 right = normalize(cross(vec3(0.0, 1.0, 0.0), u_lookDirection));\n    vec3 up = cross(u_lookDirection, right);\n\n    //project onto cylinder plane\n    float x = dot(offset, right);\n    float y = dot(offset, up);\n\n    float theta = mod(atan(y, x) + PI + u_pupilNoiseOffset, 2.0 * PI);\n\n    if (u_hipnotized) {\n      return vec3(spiral(theta, length(vec2(x, y)))) * 2.0 - 1.0;\n    } else {\n      float PUPIL_FREQUENCY = 8.0;\n\n      float r = u_pupilSize;// + snoise(vec2(PUPIL_FREQUENCY * theta / (2.0 * PI), 0.0)) * 0.003;\n\n      vec3 color = length(vec2(x, y)) < r ? vec3(-1.0) : vec3(1.0);\n      color += smoothstep(r * 0.3, r * 0.2, distance(vec2(x, y), vec2(r) * 0.3)) * 10.0;\n      return color;\n    }\n}\n\nfloat linearstep(float left, float right, float x) {\n    return clamp((x - left) / (right - left), 0.0, 1.0);\n}\n\nvoid main () {\n    vec3 normal = normalize(v_normal);\n\n    vec3 albedo = eyeColor(v_localPosition);\n\n    float roughness = 0.1;\n    float F0 = 0.5;\n\n    vec3 restOffset = vec3(0.0, -0.03, 0.05);\n\n    float angle = atan(v_restPosition.y - restOffset.y, -v_restPosition.z - restOffset.z);\n    \n    bool isEyelid = angle > -PI + u_bottomEyelidAngle && angle < PI - u_topEyelidAngle;\n\n    float angleRange = 0.2;\n    float bottomEyelidness = linearstep(-PI + u_bottomEyelidAngle, -PI + u_bottomEyelidAngle + angleRange, angle);\n    float topEyelidness = linearstep(PI - u_topEyelidAngle, PI - u_topEyelidAngle - angleRange, angle);\n\n    if (v_restPosition.y > restOffset.y && isEyelid) {\n        normal.y -= (1.0 - topEyelidness) * 1.0;\n    } else if (isEyelid) {\n        normal.y += (1.0 - bottomEyelidness) * 0.4;\n    }\n    normal = normalize(normal);\n\n    if (isEyelid) {\n        albedo = u_lidColor;\n        roughness = u_lidRoughness;\n        F0 = u_lidF0;\n    }\n\n    vec3 color = shadeSurfaceWithLights(v_position, normal, albedo, roughness, F0);\n\n    float alpha = 0.0;\n\n    if (!isEyelid) {\n        color += step(0.1, albedo.r) * 0.2;\n        color *= 1.5;\n        /*\n        alpha = getSSSAlpha(u_blobIndex) * step(0.1, albedo.r);\n        */\n        alpha = getSSSAlpha(5) * step(0.1, albedo.r);\n    } else {\n        alpha = getSSSAlpha(u_blobIndex);\n        //color += albedo * 0.3;\n    }\n\n    gl_FragColor = vec4(color, alpha);\n}\n",{a_position:0,a_normal:1,a_restPosition:2}),this.mouthInsideProgram=i(e,"\nprecision highp float;\n\nattribute vec3 a_position;\n\nvarying vec3 v_position;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelMatrix;\nuniform mat4 u_viewMatrix;\n\nvoid main () {\n    vec3 worldPosition = (u_modelMatrix * vec4(a_position, 1.0)).xyz;\n    v_position = worldPosition;\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n","\nprecision highp float;\n\nvarying vec3 v_position;\n\nvoid main () {\n    gl_FragColor = vec4(vec3(0.0), 0.0);\n}\n",{a_position:0}),this.mouthProgram=i(e,J,b+"\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying vec2 v_uv;\nvarying float v_linearPosition;\nvarying vec3 v_localPosition;\n\nuniform float u_normalScale;\nuniform vec3 u_restMouthCentroid;\n\nuniform vec3 u_color;\nuniform int u_blobIndex;\n\nuniform int u_blendSubsurface;\n\nvec3 rgb2hsv(vec3 c) {\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvoid main () {\n    vec3 diffuseColor = u_color;\n\n    vec3 hsv = rgb2hsv(diffuseColor);\n    //hsv.r += pow(1.0 - rim, 1.0);\n    //float shift = v_linearPosition < 0.5 ? v_linearPosition : 1.0 - v_linearPosition;\n    float shift = v_localPosition.y - u_restMouthCentroid.y;\n    hsv.r += shift * 0.2;\n    diffuseColor = hsv2rgb(hsv);\n\n    diffuseColor *= 1.5;\n\n    vec3 normal = normalize(v_normal);\n\n    float roughness = 0.1;\n    float f0 = 0.5;\n\n    vec3 color = shadeSurfaceWithLights(v_position, normal, diffuseColor, roughness, f0);\n\n    float rim = abs(dot(normalize(u_cameraPosition - v_position), normalize(normal)));\n\n    gl_FragColor = vec4(color, getSSSAlpha(u_blobIndex) + (u_blendSubsurface == 1 ? 0.0 : 0.05));\n}\n",{a_data:0}),this.tongueProgram=i(e,"\nprecision highp float;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\n\nvarying float v_z;\nvarying vec3 v_worldPosition;\nvarying vec3 v_normal;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_modelMatrix;\nuniform vec2 u_scale;\n\n#define SPLINE_POINT_COUNT 20\n\nuniform vec3 u_splinePositions[SPLINE_POINT_COUNT];\nuniform vec3 u_splineTangents[SPLINE_POINT_COUNT];\nuniform vec3 u_splineNormals[SPLINE_POINT_COUNT];\n\nfloat linearstep(float left, float right, float x) {\n    return clamp((x - left) / (right - left), 0.0, 1.0);\n}\n\nvoid main() {\n    v_z = a_position.z;\n    float alongIndex = a_position.z * float(SPLINE_POINT_COUNT - 1);\n\n    vec3 framePosition = vec3(0.0);\n    vec3 frameTangent = vec3(0.0);\n    vec3 frameNormal = vec3(0.0);\n\n    float SPACING = 0.13;\n\n    if (alongIndex >= float(SPLINE_POINT_COUNT - 1)) {\n        framePosition = u_splinePositions[SPLINE_POINT_COUNT - 1] + u_splineTangents[SPLINE_POINT_COUNT - 1] * SPACING * (alongIndex - float(SPLINE_POINT_COUNT - 1));\n        frameTangent = u_splineTangents[SPLINE_POINT_COUNT - 1];\n        frameNormal = u_splineNormals[SPLINE_POINT_COUNT - 1];\n    } else if (alongIndex <= 0.0) {\n        framePosition = u_splinePositions[0];\n        frameTangent = u_splineTangents[0];\n        frameNormal = u_splineNormals[0];\n    } else {\n        int leftIndex = int(alongIndex + 0.001);\n        int rightIndex = leftIndex + 1;\n\n        framePosition = mix(u_splinePositions[leftIndex], u_splinePositions[rightIndex], fract(alongIndex));\n        frameTangent = normalize(mix(u_splineTangents[leftIndex], u_splineTangents[rightIndex], fract(alongIndex)));\n        frameNormal = normalize(mix(u_splineNormals[leftIndex], u_splineNormals[rightIndex], fract(alongIndex)));\n    }\n\n    vec3 frameRight = normalize(cross(frameTangent, frameNormal));\n\n    vec3 position = a_position;\n    position.xy *= u_scale;\n\n    vec3 normal = a_normal;\n    normal.xy /= u_scale;\n    normal = normalize(normal);\n\n    vec3 localPosition = framePosition + position.x * frameRight + position.y * frameNormal;\n    vec3 localNormal = normalize(normal.x * frameRight + normal.y * frameNormal + normal.z * frameTangent);\n\n    v_normal = (u_modelMatrix * vec4(localNormal, 0.0)).xyz;\n\n    vec3 worldPosition = (u_modelMatrix * vec4(localPosition, 1.0)).xyz;\n    v_worldPosition = worldPosition;\n\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",b+"\nvarying float v_z;\nvarying vec3 v_worldPosition;\nvarying vec3 v_normal;\n\nvoid main () {\n    vec3 diffuseColor = vec3(1.0, 0.1, 0.1);\n\n    float roughness = 0.1;\n    float f0 = 0.05;\n\n    vec3 color = shadeSurfaceWithLights(v_worldPosition, normalize(v_normal), diffuseColor, roughness, f0);\n\n    color += diffuseColor * 0.1;\n\n    color = mix(vec3(0.0, 0.0, 0.0), color, smoothstep(0.0, 0.2, v_z));\n\n    gl_FragColor = vec4(color, 1.0);\n}\n",{a_position:0,a_normal:1}),this.floorProgram=i(e,"\nprecision highp float;\n\nattribute vec2 a_position;\n\nvarying vec2 v_uv;\nvarying vec3 v_position;\n\nvec2 rotate(vec2 v, float a) {\n\tfloat s = sin(a);\n\tfloat c = cos(a);\n\tmat2 m = mat2(c, -s, s, c);\n\treturn m * v;\n}\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\nuniform float u_yOffset;\n\nvoid main () {\n    float scale = 100.0;\n    vec3 worldPosition = vec3(0.0, 0.0, -2.0) + vec3(a_position.x * scale, u_yOffset, a_position.y * scale);\n    v_uv = rotate(worldPosition.xz / 10.0, 0.25 * 3.14159265358979323846) * 0.5 + 0.5;\n    v_position = worldPosition;\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",b+"\nvarying vec3 v_position;\nvarying vec2 v_uv;\n\nuniform sampler2D u_texture;\nuniform float u_scale;\n\nvoid main () {\n    float shadow = getShadowFromLights(v_position);\n    float alpha = smoothstep(10.0, 4.0, distance(v_position.xz, vec2(0.0, -2.0)));\n    vec4 color = texture2D(u_texture, v_uv) * vec4(vec3(u_scale), 1.0);\n    if (color.a == 0.0) {\n        alpha *= mix(0.8, 0.0, shadow);\n        gl_FragColor = vec4(vec3(0.1) * alpha, alpha);\n    } else {\n        shadow = pow(mix(0.1, 1.0, shadow), 1.0 / u_gamma);\n        if (v_position.z > 0.0) alpha = 1.0;\n        gl_FragColor = vec4(color.rgb * shadow * alpha, alpha);\n    }\n}\n",{a_position:0}),this.throatProgram=i(e,"\nprecision highp float;\n\nattribute vec2 a_data;\n\nuniform int u_vertexCount;\nuniform vec3 u_positions[24];\n\nuniform mat4 u_modelMatrix;\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\n\nvarying float v_z;\n\nvec3 sampleFilament(float filamentIndex, float vertexIndex) {\n    return u_positions[int(vertexIndex + 0.001)];\n}\n\nvec3 evaluateCubicSpline(vec3 leftPosition, vec3 rightPosition, vec3 leftTangent, vec3 rightTangent, float t) {\n    float t2 = t * t;\n    float t3 = t2 * t;\n\n    return (2.0 * t3 - 3.0 * t2 + 1.0) * leftPosition + (t3 - 2.0 * t2 + t) * leftTangent + (-2.0 * t3 + 3.0 * t2) * rightPosition + (t3 - t2) * rightTangent;\n}\n\nvec3 evaluateCubicSplineTangent(vec3 leftPosition, vec3 rightPosition, vec3 leftTangent, vec3 rightTangent, float t) {\n    float t2 = t * t;\n    return (6.0 * t2 - 6.0 * t) * leftPosition + (3.0 * t2 - 4.0 * t + 1.0) * leftTangent + (-6.0 * t2 + 6.0 * t) * rightPosition + (3.0 * t2 - 2.0 * t) * rightTangent;\n}\n\nfloat posMod(float i, float n) {\n    return mod((n + mod(i, n)), n);\n}\n\nvoid main () {\n    float filamentIndex = 0.0;\n\n    float index = a_data.x * float(u_vertexCount);\n    float leftIndex = floor(index + 0.001);\n    float rightIndex = floor(mod(leftIndex + 1.0001, float(u_vertexCount)));\n    \n    float t = clamp(index - leftIndex, 0.0, 1.0);\n\n    vec3 leftLeftPosition = sampleFilament(filamentIndex, floor(posMod(leftIndex - 0.9999, float(u_vertexCount)))).xyz;\n    vec3 leftPosition = sampleFilament(filamentIndex, leftIndex).xyz;\n    vec3 rightPosition = sampleFilament(filamentIndex, rightIndex).xyz;\n    vec3 rightRightPosition = sampleFilament(filamentIndex, floor(posMod(rightIndex + 1.0001, float(u_vertexCount)))).xyz;\n\n    vec3 leftTangent = (rightPosition - leftLeftPosition) * 0.5;\n    vec3 rightTangent = (rightRightPosition - leftPosition) * 0.5;\n\n    //vec3 tangent = normalize(mix(leftTangent, rightTangent, t));\n\n    v_z = a_data.y;\n\n    vec3 localPosition = evaluateCubicSpline(leftPosition, rightPosition, leftTangent, rightTangent, t) + vec3(0.0, 0.0, -a_data.y * 0.3);\n    vec3 worldPosition = (u_modelMatrix * vec4(localPosition, 1.0)).xyz;\n\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",b+"\nuniform vec3 u_color;\nuniform int u_blobIndex;\nvarying float v_z;\n\nfloat linearstep(float left, float right, float x) {\n    return clamp((x - left) / (right - left), 0.0, 1.0);\n}\n\nvoid main () {\n    float fade = pow(linearstep(1.0, 0.0, v_z), 2.2);\n    gl_FragColor = vec4(u_color * 0.025 * fade, getSSSAlpha(u_blobIndex));\n}\n",{a_data:0}),this.backgroundProgram=i(e,Q,$,{a_position:0}),this.backgroundBlurProgram=i(e,Q,"#define BLUR \n "+$,{a_position:0}),this.colorProgram=i(e,"\nprecision highp float;\n\nattribute vec2 a_position;\n\nvoid main () {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n}\n","\nprecision highp float;\n\nvarying vec2 v_uv;\n\nuniform vec4 u_color;\n\nvoid main () {\n    gl_FragColor = u_color;\n}\n",{a_position:0}),this.blobDepthProgram=i(e,"\nprecision highp float;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\n//attribute vec2 a_uv;\n\nvarying vec3 v_normal;\nvarying vec3 v_position;\n//varying vec2 v_uv;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelMatrix;\nuniform mat4 u_viewMatrix;\n\nvarying vec4 v_clipSpacePosition;\n\nvoid main () {\n    //v_uv = a_uv;\n    vec3 worldPosition = (u_modelMatrix * vec4(a_position, 1.0)).xyz;\n    v_normal = (u_modelMatrix * vec4(-a_normal, 0.0)).xyz;\n\n    v_position = worldPosition;\n    v_clipSpacePosition = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n    gl_Position = v_clipSpacePosition;\n}\n","\nprecision highp float;\n\nvarying vec4 v_clipSpacePosition;\n\nconst float PackUpscale = 256.0 / 255.0;\nconst float UnpackDownscale = 255.0 / 256.0;\n\nconst vec3 PackFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);\nconst vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);\n\nconst float ShiftRight8 = 1.0 / 256.0;\n\nvec4 packDepthToRGBA(const in float v) {\n    vec4 r = vec4(fract(v * PackFactors), v);\n    r.yzw -= r.xyz * ShiftRight8;\n    return r * PackUpscale;\n}\n\nvoid main () {\n\tfloat ndcDepth = v_clipSpacePosition.z / v_clipSpacePosition.w;\n\tgl_FragColor = packDepthToRGBA(ndcDepth * 0.5 + 0.5);\n}\n",{a_position:0,a_normal:1}),this.mouthDepthProgram=i(e,"#define SHADOW \n "+J,K,{a_data:0}),this.uiProgram=i(e,"\nprecision highp float;\n\nattribute vec3 a_position;\nattribute vec4 a_color;\n\nvarying vec4 v_color;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_modelMatrix;\n\nvoid main () {\n    v_color = a_color;\n    gl_Position = u_projectionMatrix * u_viewMatrix * u_modelMatrix * vec4(a_position, 1.0);\n}\n","\nprecision highp float;\n\nuniform float u_alpha;\n\nvarying vec4 v_color;\n\nvoid main () {\n    gl_FragColor = v_color * vec4(1.0, 1.0, 1.0, u_alpha);\n}\n",{a_position:0,a_color:1}),this.dustProgram=i(e,"\nprecision highp float;\n\nattribute vec2 a_offset;\nattribute vec4 a_random;\nattribute vec3 a_spawnPosition;\nattribute vec3 a_spawnVelocity;\nattribute float a_spawnTime;\n\nuniform float u_time;\nuniform float u_scale;\nuniform vec3 u_cameraPosition;\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\n\nvarying vec2 v_offset;\nvarying vec3 v_worldPosition;\nvarying vec4 v_random;\n\nvarying float v_alpha;\n\nvoid main () {\n    v_offset = a_offset;\n    v_random = a_random;\n\n    float elapsedTime = u_time - a_spawnTime;\n    vec3 particlePosition = a_spawnPosition + a_spawnVelocity * elapsedTime;\n\n    v_alpha = 1.0;\n\n    vec3 toCamera = u_cameraPosition - particlePosition;\n    vec3 forwardDirection = toCamera;\n\n    vec3 right = normalize(cross(vec3(0.0, 1.0, 0.1), forwardDirection));\n    vec3 up = normalize(cross(forwardDirection, right));\n\n    vec2 size = vec2(mix(0.01, 0.015, a_random.w)) * u_scale;\n    vec3 worldPosition = particlePosition + a_offset.x * right * size.x + a_offset.y * up * size.y;\n\n    v_worldPosition = worldPosition;\n\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",b+"\nvarying vec2 v_offset;\nvarying vec4 v_random;\nvarying vec3 v_worldPosition;\nvarying float v_alpha;\n\nvoid main() {\n    vec3 color = vec3(1.0);// * getShadowFromLights(v_worldPosition);\n    float alpha = smoothstep(1.0, mix(0.0, 0.9, v_random.y), length(v_offset)) * mix(0.05, 0.1, v_random.z);\n    alpha *= v_alpha;\n    gl_FragColor = vec4(color * alpha, alpha);\n}\n",{a_offset:0,a_random:1,a_spawnTime:2,a_spawnPosition:3,a_spawnVelocity:4}),this.snowProgram=i(e,"\nprecision highp float;\n\nattribute vec2 a_offset;\nattribute vec4 a_random;\nattribute vec3 a_spawnPosition;\nattribute float a_spawnTime;\n\nuniform float u_time;\nuniform vec3 u_cameraPosition;\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\n\nvarying vec2 v_offset;\nvarying vec3 v_worldPosition;\nvarying vec4 v_random;\n\nconst float floorY = -4.25;\nconst float GRAVITY = -0.8;\n\nvarying float v_alpha;\n\nvoid main () {\n    v_offset = a_offset;\n    v_random = a_random;\n\n    float elapsedTime = u_time - a_spawnTime;\n    vec3 particlePosition = a_spawnPosition + vec3(0.0, GRAVITY, 0.0) * elapsedTime;\n\n    float hitTime = a_spawnTime + (floorY - a_spawnPosition.y) / GRAVITY;\n    float timeSinceHit = u_time - hitTime;\n\n    bool hit = timeSinceHit > 0.0;\n    v_alpha = smoothstep(2.0, 1.0, timeSinceHit);\n\n    vec3 toCamera = u_cameraPosition - particlePosition;\n    vec3 forwardDirection = hit ? vec3(0.0, 1.0, 0.0) : toCamera;\n\n    vec3 right = normalize(cross(vec3(0.0, 1.0, 0.1), forwardDirection));\n    vec3 up = normalize(cross(forwardDirection, right));\n\n    particlePosition.y = max(particlePosition.y, floorY);\n\n    vec2 size = vec2(mix(0.005, 0.01, a_random.x));\n    if (hit) size *= 3.0;\n    vec3 worldPosition = particlePosition + a_offset.x * right * size.x + a_offset.y * up * size.y;\n\n    v_worldPosition = worldPosition;\n\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",b+"\nvarying vec2 v_offset;\nvarying vec4 v_random;\nvarying vec3 v_worldPosition;\nvarying float v_alpha;\n\nvoid main() {\n    vec3 color = vec3(1.0);// * getShadowFromLights(v_worldPosition);\n    float alpha = smoothstep(1.0, mix(0.0, 0.9, v_random.y), length(v_offset)) * mix(0.5, 1.0, v_random.z);\n    alpha *= v_alpha;\n    gl_FragColor = vec4(color * alpha, alpha);\n}\n",{a_offset:0,a_random:1,a_spawnTime:2,a_spawnPosition:3}),this.hatProgram=i(e,tt,b+"\nvarying vec3 v_worldPosition;\nvarying vec3 v_color;\nvarying vec3 v_normal;\n\nvoid main () {\n    vec3 diffuseColor = v_color;\n\n    float roughness = 0.8;\n    float f0 = 0.05;\n\n    vec3 color = shadeSurfaceWithLights(v_worldPosition, v_normal, diffuseColor, roughness, f0);\n\n    gl_FragColor = vec4(color, 0.0);\n}\n",{a_data:0,a_normal:1}),this.hatDepthProgram=i(e,"#define SHADOW \n"+tt,K,{a_data:0}),this.sssBlurProgram=i(e,et,z(17,m),{a_position:0}),this.fxaaProgram=i(e,et,"\nprecision highp float;\n\nvarying vec2 v_coordinates;\n\nuniform sampler2D u_input;\n\nuniform float u_time;\nuniform vec2 u_resolution;\n\nconst float FXAA_SPAN_MAX = 8.0;\nconst float FXAA_REDUCE_MUL = 1.0 / 8.0;\nconst float FXAA_REDUCE_MIN = 1.0 / 128.0;\n\nvec3 getDither() {\n    vec3 vDither = vec3(dot(vec2(171.0,231.0), gl_FragCoord.xy + u_time));\n    vDither.rgb = fract(vDither.rgb/vec3(103.0,71.0,97.0))-vec3(0.5,0.5,0.5);\n    return vDither / 127.0;\n}\n\nvec4 sampleFXAA() {\n    vec2 delta = 1.0 / u_resolution;\n\n    vec3 rgbNW = texture2D(u_input, v_coordinates + vec2(-1.0, -1.0) * delta).rgb;\n    vec3 rgbNE = texture2D(u_input, v_coordinates + vec2(1.0, -1.0) * delta).rgb;\n    vec3 rgbSW = texture2D(u_input, v_coordinates + vec2(-1.0, 1.0) * delta).rgb;\n    vec3 rgbSE = texture2D(u_input, v_coordinates + vec2(1.0, 1.0) * delta).rgb;\n    vec3 rgbM = texture2D(u_input, v_coordinates).rgb;\n\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    vec2 dir = vec2(\n        -((lumaNW + lumaNE) - (lumaSW + lumaSE)),\n        ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX), dir * rcpDirMin)) * delta.xy;\n\n    vec3 rgbA = 0.5 * (texture2D(u_input, v_coordinates.xy + dir * (1.0 / 3.0 - 0.5)).xyz + texture2D(u_input, v_coordinates.xy + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(u_input, v_coordinates.xy + dir * -0.5).xyz + texture2D(u_input, v_coordinates.xy + dir * 0.5).xyz);\n    float lumaB = dot(rgbB, luma);\n\n    if (lumaB < lumaMin || lumaB > lumaMax) {\n        return vec4(rgbA, 1.0);\n    } else {\n        return vec4(rgbB, 1.0);\n    }\n}\n \nvoid main () {\n    vec4 sample = sampleFXAA();\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    sample.rgb += getDither();\n    #endif\n    gl_FragColor = sample;\n}\n",{a_position:0}),this.colorCorrectProgram=i(e,et,"\nprecision highp float;\n\nuniform sampler2D u_input;\n\nuniform float u_gamma;\nvarying vec2 v_coordinates;\n\nvoid main () {\n    gl_FragColor = pow(texture2D(u_input, v_coordinates), vec4(1.0 / u_gamma));\n}\n",{a_position:0}),this.quadVertexBuffer=u(e,e.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,1]),e.STATIC_DRAW),this.triangleVertexBuffer=u(e,e.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),e.STATIC_DRAW),this.setViewMatrix(c.makeTranslation([],-a[0],-a[1],-a[2])),this.backgroundTexture=s(e,0,n,e.CLAMP_TO_EDGE,e.CLAMP_TO_EDGE,e.LINEAR,e.LINEAR,!0),this.backgroundTextureResolution=[n.width,n.height],this.floorTexture=s(e,0,o,e.REPEAT,e.REPEAT,e.LINEAR,e.LINEAR),this.newBackgroundTexture=this.backgroundTexture,this.lights.push(new nt(e,.65*-Math.PI,0*Math.PI,20,1.5,!0)),this.lights.push(new nt(e,.2*Math.PI,0*Math.PI,20,.2,!0)),this.lights.push(new nt(e,.75*Math.PI,0*Math.PI,20,.1,!1)),this.framebuffer=e.createFramebuffer(),this.shadowFramebuffer=e.createFramebuffer(),this.colorTexture=r(e,0,e.RGBA,e.UNSIGNED_BYTE,this.canvas.width,this.canvas.height,null,e.CLAMP_TO_EDGE,e.CLAMP_TO_EDGE,e.LINEAR,e.LINEAR),this.colorTextureTemp=r(e,0,e.RGBA,e.UNSIGNED_BYTE,this.canvas.width,this.canvas.height,null,e.CLAMP_TO_EDGE,e.CLAMP_TO_EDGE,e.LINEAR,e.LINEAR),this.renderbuffer=l(e,e.DEPTH_STENCIL,this.canvas.width,this.canvas.height),this.resize(),this.startTime=Date.now()/1e3,this.lastTime=0,this.dust=new Z(e,!0,10,this.projectionViewMatrix),this.snow=new O(e,!1,600,this.projectionViewMatrix),this.tongueGeometry=function(t){for(var e=[],n=0;n<20;++n)for(var i=n/19.5,o=i<.5?1:Math.sqrt(1-Math.pow(Object(f.l)(.5,1,i),2)),r=0;r<16;++r){var a=2*Math.PI*r/16;e.push(.15*Math.cos(a)*o,.075*Math.sin(a)*o,i)}for(var s=[],l=0;l<19;++l)for(r=0;r<16;++r){var c=16*l+r,h=16*l+(r+1)%16,d=c+16,p=h+16;s.push(c,h,p),s.push(p,d,c)}for(r=1;r<15;++r)s.push(304),s.push(304+r),s.push(304+r+1);var m=Object(f.c)(e,s,.3);return{positionsBuffer:u(t,t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),normalsBuffer:u(t,t.ARRAY_BUFFER,new Float32Array(m),t.STATIC_DRAW),indexBuffer:u(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(s),t.STATIC_DRAW),indexCount:s.length}}(e),this.hatGeometry=function(t){var e=[],n=0;function i(t,i,o){for(var r=9*t,a=0;a<16;++a)e.push(a),e.push(r),e.push(i),e.push(o);n+=1}for(var o=0;o<10;++o){var r=o/9;i(.2*r,s=1+.2*Math.sqrt(1-Math.pow(2*r-1,2)),0)}for(o=0;o<10;++o){var a=o/9,s=Object(f.n)(1,.1,a);i(Object(f.n)(.2,1,a),s,1)}for(o=0;o<10;++o){var l=o/9;i(1+.2*l,s=.4*Math.sqrt(1-Math.pow(2*l-1,2)),0)}for(var c=[],h=0;h<n-1;++h)for(o=0;o<16;++o){var d=16*h+o,p=16*h+(o+1)%16,m=d+16,g=p+16;c.push(d,p,g),c.push(g,m,d)}var b=[];for(o=0;o<16;++o){var v=2*Math.PI*o/16;b.push([-Math.cos(v),-Math.sin(v),0])}var y=[];for(o=0;o<e.length/4;++o){var _=e[4*o+0],x=e[4*o+1];s=.3*e[4*o+2];y.push(b[_][0]*s,b[_][1]*s,.8*x/9)}var w=Object(f.c)(y,c,2.1);return{dataBuffer:u(t,t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),normalsBuffer:u(t,t.ARRAY_BUFFER,new Float32Array(w),t.STATIC_DRAW),indexBuffer:u(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),t.STATIC_DRAW),indexCount:c.length}}(e),this.mouthInsideGeometry=function(t){for(var e=[],n=0;n<20;++n)for(var i=0;i<16;++i)e.push(i/16,n/19);for(var o=[],r=0;r<19;++r)for(i=0;i<16;++i){var a=16*r+i,s=16*r+(i+1)%16,l=a+16,c=s+16;o.push(a,s,c),o.push(c,l,a)}return{vertexBuffer:u(t,t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),indexBuffer:u(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(o),t.STATIC_DRAW),indexCount:o.length}}(e),this.setStaticLightingUniforms(this.blobProgram),this.setStaticLightingUniforms(this.eyeProgram),this.setStaticLightingUniforms(this.mouthProgram),this.setStaticLightingUniforms(this.tongueProgram),this.setStaticLightingUniforms(this.floorProgram),this.setStaticLightingUniforms(this.hatProgram),this.floorYOffset=new d.a(-10,(function(t){return 1-Math.pow(1-t,3)})),this.floorYOffset.change(0,1.5),this.backgroundZoom=new d.a(1,(function(t){return Object(f.r)(0,1,t)})),this.backgroundZoom.change(1,1.5),this.dustScale.change(1,1)}return t.prototype.resize=function(){var t=this.canvas.clientWidth,e=this.canvas.clientHeight;this.canvas.width===t&&this.canvas.height===e||(this.canvas.width=t,this.canvas.height=e,this.onResize()),this.recalculateProjectionMatrix()},t.prototype.recalculateProjectionMatrix=function(){var t=this.fov,e=this.canvas.height-2*this.paddingHeight,n=this.canvas.width/e;if(n<1){var i=2*Math.atan(1*Math.tan(t/2));t=2*Math.atan(1/n*Math.tan(i/2)),t=Math.min(t,.9*Math.PI)}this.currentVerticalFOV=t,c.makePerspective(this.projectionMatrix,t,this.canvas.width/e,.01,100),c.invert(this.inverseProjectionMatrix,this.projectionMatrix),c.makeInfinitePerspective(this.infiniteProjectionMatrix,t,this.canvas.width/e,.01,100),c.makeInfinitePerspective(this.referenceProjectionMatrix,t,1,.01,100),c.premultiply(this.projectionViewMatrix,this.viewMatrix,this.projectionMatrix)},t.prototype.setSSSColors=function(t){var e=this.gl;this.sssBlurProgram=i(e,et,z(17,t),{a_position:0}),console.log(t)},t.prototype.onResize=function(){var t=this.gl;a(t,this.colorTexture,0,t.RGBA,t.UNSIGNED_BYTE,this.canvas.width,this.canvas.height,null,t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE,t.LINEAR,t.LINEAR),a(t,this.colorTextureTemp,0,t.RGBA,t.UNSIGNED_BYTE,this.canvas.width,this.canvas.height,null,t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE,t.LINEAR,t.LINEAR),t.bindRenderbuffer(t.RENDERBUFFER,this.renderbuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,this.canvas.width,this.canvas.height)},t.prototype.getWorldRayDirection=function(t,e,n){t[0]=e,t[1]=n,t[2]=1,t[3]=1;var i=c.multiplyVector(t,this.inverseProjectionMatrix,t);i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],h.a.normalize(i,i);var o=c.transformDirection(t,i,this.inverseViewMatrix);return h.a.normalize(o,o),o},t.prototype.getScreenPosition=function(t,e){var n=c.multiplyVector(t,this.viewMatrix,[e[0],e[1],e[2],1]),i=c.multiplyVector(t,this.projectionMatrix,n);return i[0]/=i[3],i[1]/=i[3],t},t.prototype.setStaticLightingUniforms=function(t){var e=this.gl;e.useProgram(t.program),e.uniform3f(t.uniformLocations.u_cameraPosition,this.inverseViewMatrix[12],this.inverseViewMatrix[13],this.inverseViewMatrix[14]),e.uniform1f(t.uniformLocations.u_gamma,2.2);for(var n=0;n<this.lights.length;++n){var i=this.lights[n];e.uniform3fv(t.uniformLocations["u_lightPosition"+n.toFixed(0)],i.position),e.uniform3fv(t.uniformLocations["u_lightColor"+n.toFixed(0)],i.color),i.shadowsEnabled&&(e.uniform2f(t.uniformLocations["u_shadowResolution"+n.toFixed(0)],i.shadowMapWidth,i.shadowMapWidth),e.uniformMatrix4fv(t.uniformLocations["u_lightProjectionViewMatrix"+n.toFixed(0)],!1,i.projectionViewMatrix),e.uniform1i(t.uniformLocations["u_shadowDepthTexture"+n.toFixed(0)],3+n))}},t.prototype.unbindLightingTextures=function(){for(var t=this.gl,e=0;e<this.lights.length;++e)t.activeTexture(t.TEXTURE0+3+e),t.bindTexture(t.TEXTURE_2D,null)},t.prototype.bindLightingTextures=function(){for(var t=this.gl,e=0;e<this.lights.length;++e)t.activeTexture(t.TEXTURE0+3+e),t.bindTexture(t.TEXTURE_2D,this.lights[e].depthColorTexture)},t.prototype.setViewMatrix=function(t){c.copy(this.viewMatrix,t),c.invert(this.inverseViewMatrix,this.viewMatrix),this.cameraPosition[0]=this.inverseViewMatrix[12],this.cameraPosition[1]=this.inverseViewMatrix[13],this.cameraPosition[2]=this.inverseViewMatrix[14],c.premultiply(this.projectionViewMatrix,this.viewMatrix,this.projectionMatrix)},t.prototype.changeScene=function(t,e,n){var i=this.gl;this.backgroundTexture=this.newBackgroundTexture,this.newBackgroundTexture=s(i,0,t,i.CLAMP_TO_EDGE,i.CLAMP_TO_EDGE,i.LINEAR,i.LINEAR,!0),this.backgroundTextureResolution=[t.width,t.height],this.floorTexture=s(i,0,e,i.REPEAT,i.REPEAT,i.LINEAR,i.LINEAR),this.backgroundTransitionT.change(0,0),this.backgroundTransitionT.change(1,.5,n)},t.prototype.render=function(t){this.resize();var e=Date.now()/1e3-this.startTime,n=e-this.lastTime;this.lastTime=e;for(var i=!1,o=0,r=t;o<r.length;o++){(M=r[o]).isDragging&&(i=!0)}var a=this.gl;this.unbindLightingTextures();for(var s=0,l=this.lights;s<l.length;s++){var u=l[s];if(u.shadowsEnabled){a.bindFramebuffer(a.FRAMEBUFFER,this.shadowFramebuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,u.depthColorTexture,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,u.depthRenderbuffer),a.viewport(0,0,u.shadowMapWidth,u.shadowMapWidth),a.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),a.useProgram(this.blobDepthProgram.program),a.uniformMatrix4fv(this.blobDepthProgram.uniformLocations.u_projectionMatrix,!1,u.projectionMatrix),a.uniformMatrix4fv(this.blobDepthProgram.uniformLocations.u_viewMatrix,!1,u.viewMatrix),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.enable(a.DEPTH_TEST);for(var h=0,d=t;h<d.length;h++){if((M=d[h]).state!==P.Offscreen){a.uniformMatrix4fv(this.blobDepthProgram.uniformLocations.u_modelMatrix,!1,M.modelMatrix),a.bindBuffer(a.ARRAY_BUFFER,M.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,M.normalsBuffer),a.vertexAttribPointer(1,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,M.indexBuffer),a.enable(a.CULL_FACE),a.drawElements(a.TRIANGLES,M.renderingIndexCount,a.UNSIGNED_SHORT,0),a.disable(a.CULL_FACE);for(var p=0,m=M.eyes;p<m.length;p++){var g=m[p];a.bindBuffer(a.ARRAY_BUFFER,g.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,g.normalsBuffer),a.vertexAttribPointer(1,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,g.indexBuffer),a.drawElements(a.TRIANGLES,g.indexCount,a.UNSIGNED_SHORT,0)}}}a.disableVertexAttribArray(1),a.disable(a.CULL_FACE),a.useProgram(this.mouthDepthProgram.program),a.uniformMatrix4fv(this.mouthDepthProgram.uniformLocations.u_projectionMatrix,!1,u.projectionMatrix),a.uniformMatrix4fv(this.mouthDepthProgram.uniformLocations.u_viewMatrix,!1,u.viewMatrix),a.enableVertexAttribArray(0),a.enable(a.DEPTH_TEST);for(var b=0,v=t;b<v.length;b++){(M=v[b]).state!==P.Offscreen&&(a.uniformMatrix4fv(this.mouthDepthProgram.uniformLocations.u_modelMatrix,!1,M.modelMatrix),a.uniform1i(this.mouthDepthProgram.uniformLocations.u_vertexCount,M.mouthPositionCount),a.uniform1f(this.mouthDepthProgram.uniformLocations.u_lipScale,1.25*M.config.lipScale),a.uniform3fv(this.mouthDepthProgram.uniformLocations["u_positions[0]"],M.getMouthPositions()),a.bindBuffer(a.ARRAY_BUFFER,M.mouthGeometry.vertexBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,M.mouthGeometry.indexBuffer),a.drawElements(a.TRIANGLES,M.mouthGeometry.indexCount,a.UNSIGNED_SHORT,0))}}}a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTexture,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderbuffer),a.clearColor(0,0,0,0),a.clearStencil(0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT),a.viewport(0,this.paddingHeight,this.canvas.width,this.canvas.height-2*this.paddingHeight),this.bindLightingTextures(),a.useProgram(this.blobProgram.program),a.uniform3fv(this.blobProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.blobProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.blobProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.uniform1i(this.blobProgram.uniformLocations.u_albedoTexture,0),a.uniform1i(this.blobProgram.uniformLocations.u_materialMap,1),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.enableVertexAttribArray(2),a.enableVertexAttribArray(3),a.enable(a.DEPTH_TEST),a.enable(a.CULL_FACE),a.cullFace(a.FRONT);for(var y=0;y<t.length;++y){if((M=t[y]).state!==P.Offscreen){a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,t[y].assets.bodyMaterial.albedoTexture),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,t[y].assets.bodyMaterial.materialMap),a.uniform1i(this.blobProgram.uniformLocations.u_blobIndex,y),a.uniform3fv(this.blobProgram.uniformLocations.u_color,M.assets.bodyMaterial.color),a.uniform1f(this.blobProgram.uniformLocations.u_normalScale,M.assets.bodyMaterial.normalScale),a.uniform1f(this.blobProgram.uniformLocations.u_isSinging,M.smoothIsSinging.evaluate()),a.uniform3f(this.blobProgram.uniformLocations.u_hsvShift,M.assets.bodyMaterial.hueShift,M.assets.bodyMaterial.saturationBoost,M.assets.bodyMaterial.lightnessBoost);var _=M.rimLevel.evaluate();a.uniform3f(this.blobProgram.uniformLocations.u_rimColor,_,_,_),a.uniformMatrix4fv(this.blobProgram.uniformLocations.u_modelMatrix,!1,M.modelMatrix),a.bindBuffer(a.ARRAY_BUFFER,M.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,M.normalsBuffer),a.vertexAttribPointer(1,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,M.uvsBuffer),a.vertexAttribPointer(2,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,M.speedsBuffer),a.vertexAttribPointer(3,1,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,M.indexBuffer),a.drawElements(a.TRIANGLES,M.renderingIndexCount,a.UNSIGNED_SHORT,0)}}a.disable(a.CULL_FACE),a.cullFace(a.BACK),a.disableVertexAttribArray(1),a.disableVertexAttribArray(2),a.disableVertexAttribArray(3),a.useProgram(this.eyeProgram.program),a.uniform3fv(this.eyeProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.eyeProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.eyeProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.uniform1f(this.eyeProgram.uniformLocations.u_time,e),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.enableVertexAttribArray(2),a.enable(a.DEPTH_TEST);for(y=0;y<t.length;++y){if((M=t[y]).state!==P.Offscreen){a.uniform1i(this.eyeProgram.uniformLocations.u_blobIndex,y),a.uniformMatrix4fv(this.eyeProgram.uniformLocations.u_modelMatrix,!1,M.modelMatrix),a.uniform3fv(this.eyeProgram.uniformLocations.u_lidColor,M.assets.lidColor),a.uniform1i(this.eyeProgram.uniformLocations.u_hipnotized,M.overrideHipnotized?1:0),a.uniform1f(this.eyeProgram.uniformLocations.u_bottomEyelidAngle,M.getBottomEyelidAngle()),a.uniform1f(this.eyeProgram.uniformLocations.u_topEyelidAngle,M.getTopEyelidAngle()),a.uniform1f(this.eyeProgram.uniformLocations.u_pupilSize,.08*Math.pow(M.config.parameters.leftEyeScale[0],.5)),a.uniform1f(this.eyeProgram.uniformLocations.u_lidF0,M.config.eye.lidF0),a.uniform1f(this.eyeProgram.uniformLocations.u_lidRoughness,M.config.eye.lidRoughness);for(var x=M.eyes.length-1;x>=0;--x){g=M.eyes[x];a.uniform3fv(this.eyeProgram.uniformLocations.u_eyePosition,g.attachPosition),a.uniform3fv(this.eyeProgram.uniformLocations.u_lookDirection,g.lookDirection),a.bindBuffer(a.ARRAY_BUFFER,g.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,g.normalsBuffer),a.vertexAttribPointer(1,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,g.restPositionsBuffer),a.vertexAttribPointer(2,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,g.indexBuffer),a.drawElements(a.TRIANGLES,g.indexCount,a.UNSIGNED_SHORT,0)}}}a.depthMask(!0),a.disableVertexAttribArray(1),a.disableVertexAttribArray(2),a.useProgram(this.mouthProgram.program),a.uniform3fv(this.mouthProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.mouthProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.mouthProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.uniform1i(this.mouthProgram.uniformLocations.u_albedoTexture,0),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.enableVertexAttribArray(2),a.enable(a.DEPTH_TEST);for(y=0;y<t.length;++y){(M=t[y]).state!==P.Offscreen&&(a.uniform1i(this.mouthProgram.uniformLocations.u_blobIndex,y),a.uniform3fv(this.mouthProgram.uniformLocations.u_color,M.assets.mouthColor),a.uniform1i(this.mouthProgram.uniformLocations.u_blendSubsurface,0),a.uniform3fv(this.mouthProgram.uniformLocations.u_restMouthCentroid,M.restMouthCentroid),a.uniform1f(this.mouthProgram.uniformLocations.u_lipScale,M.config.lipScale),a.uniformMatrix4fv(this.mouthProgram.uniformLocations.u_modelMatrix,!1,M.modelMatrix),a.uniform1i(this.mouthProgram.uniformLocations.u_vertexCount,M.mouthPositionCount),a.uniform3fv(this.mouthProgram.uniformLocations["u_positions[0]"],M.getMouthPositions()),a.bindBuffer(a.ARRAY_BUFFER,M.mouthGeometry.vertexBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,M.mouthGeometry.normalsBuffer),a.vertexAttribPointer(1,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,M.mouthGeometry.uvsBuffer),a.vertexAttribPointer(2,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,M.mouthGeometry.indexBuffer),a.drawElements(a.TRIANGLES,M.mouthGeometry.indexCount,a.UNSIGNED_SHORT,0))}a.disableVertexAttribArray(1),a.disableVertexAttribArray(2),a.enable(a.STENCIL_TEST),a.stencilOp(a.KEEP,a.KEEP,a.REPLACE),a.useProgram(this.mouthInsideProgram.program),a.uniformMatrix4fv(this.mouthInsideProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.mouthInsideProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.enableVertexAttribArray(0),a.enable(a.DEPTH_TEST);for(y=0;y<t.length;++y){(M=t[y]).state!==P.Offscreen&&(a.uniformMatrix4fv(this.mouthInsideProgram.uniformLocations.u_modelMatrix,!1,M.modelMatrix),a.bindBuffer(a.ARRAY_BUFFER,M.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,M.mouthTriangleIndexBuffer),a.stencilFunc(a.ALWAYS,1<<t.length-1-y,1<<t.length-1-y),a.drawElements(a.TRIANGLES,M.mouthTriangleIndexCount,a.UNSIGNED_SHORT,0))}a.depthMask(!0),a.stencilOp(a.KEEP,a.KEEP,a.KEEP),a.useProgram(this.throatProgram.program),a.uniformMatrix4fv(this.throatProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.throatProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.enableVertexAttribArray(0),a.bindBuffer(a.ARRAY_BUFFER,this.mouthInsideGeometry.vertexBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.mouthInsideGeometry.indexBuffer),a.disable(a.DEPTH_TEST);for(y=0;y<t.length;++y){(M=t[y]).state!==P.Offscreen&&(a.uniformMatrix4fv(this.throatProgram.uniformLocations.u_modelMatrix,!1,M.modelMatrix),a.uniform1i(this.throatProgram.uniformLocations.u_blobIndex,y),a.uniform1i(this.throatProgram.uniformLocations.u_vertexCount,M.mouthPositionCount),a.uniform3fv(this.throatProgram.uniformLocations["u_positions[0]"],M.getMouthPositions()),a.uniform3fv(this.throatProgram.uniformLocations.u_color,M.assets.lidColor),a.stencilFunc(a.EQUAL,1<<t.length-1-y,4294967295),a.drawElements(a.TRIANGLES,this.mouthInsideGeometry.indexCount,a.UNSIGNED_SHORT,0))}a.useProgram(this.tongueProgram.program),a.uniform3fv(this.tongueProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.tongueProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.tongueProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.bindBuffer(a.ARRAY_BUFFER,this.tongueGeometry.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.tongueGeometry.normalsBuffer),a.vertexAttribPointer(1,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.tongueGeometry.indexBuffer);for(y=0;y<t.length;++y){(M=t[y]).state!==P.Offscreen&&(a.uniformMatrix4fv(this.tongueProgram.uniformLocations.u_modelMatrix,!1,M.modelMatrix),a.uniform2fv(this.tongueProgram.uniformLocations.u_scale,M.tongueScale),a.uniform3fv(this.tongueProgram.uniformLocations["u_splinePositions[0]"],M.getTonguePositions()),a.uniform3fv(this.tongueProgram.uniformLocations["u_splineTangents[0]"],M.getTongueTangents()),a.uniform3fv(this.tongueProgram.uniformLocations["u_splineNormals[0]"],M.getTongueNormals()),a.stencilFunc(a.EQUAL,1<<t.length-1-y,4294967295),a.drawElements(a.TRIANGLES,this.tongueGeometry.indexCount,a.UNSIGNED_SHORT,0))}a.disableVertexAttribArray(1),a.disable(a.STENCIL_TEST),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTextureTemp,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null),a.clear(a.COLOR_BUFFER_BIT),a.viewport(0,0,this.canvas.width,this.canvas.height),a.enableVertexAttribArray(0),a.bindBuffer(a.ARRAY_BUFFER,this.triangleVertexBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.useProgram(this.sssBlurProgram.program),a.uniform1i(this.sssBlurProgram.uniformLocations.u_colorTexture,0),a.uniform2f(this.sssBlurProgram.uniformLocations.u_resolution,this.canvas.width,this.canvas.height),a.uniformMatrix4fv(this.sssBlurProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTextureTemp,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.colorTexture),a.uniform2f(this.sssBlurProgram.uniformLocations.u_direction,1,0),a.drawArrays(a.TRIANGLES,0,3),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTexture,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.colorTextureTemp),a.uniform2f(this.sssBlurProgram.uniformLocations.u_direction,0,1),a.drawArrays(a.TRIANGLES,0,3),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTextureTemp,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null),a.disable(a.DEPTH_TEST),a.clear(a.COLOR_BUFFER_BIT),a.viewport(0,0,this.canvas.width,this.canvas.height),a.enableVertexAttribArray(0),a.bindBuffer(a.ARRAY_BUFFER,this.triangleVertexBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.useProgram(this.colorCorrectProgram.program),a.uniform1i(this.colorCorrectProgram.uniformLocations.u_input,0),a.uniform1f(this.colorCorrectProgram.uniformLocations.u_gamma,2.2),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.colorTexture),a.drawArrays(a.TRIANGLES,0,3);var w=this.colorTexture;this.colorTexture=this.colorTextureTemp,this.colorTextureTemp=w,a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTexture,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderbuffer),a.viewport(0,0,this.canvas.width,this.canvas.height),a.enable(a.SCISSOR_TEST),a.scissor(0,this.paddingHeight,this.canvas.width,this.canvas.height-2*this.paddingHeight),a.enable(a.DEPTH_TEST),a.depthMask(!1);var S=c.premultiply(new Float32Array(16),this.backgroundOriginalViewMatrix,this.projectionMatrix);i?this.backgroundIntensity.change(1,2.5):this.backgroundIntensity.change(0,1);var A=this.backgroundTransitionT.evaluate()<1?this.backgroundBlurProgram:this.backgroundProgram;a.useProgram(A.program),a.uniformMatrix4fv(A.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(A.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.uniformMatrix4fv(A.uniformLocations.u_referenceProjectionViewMatrix,!1,S),a.uniform1f(A.uniformLocations.u_time,e),a.uniform1f(A.uniformLocations.u_intensity,this.backgroundIntensity.evaluate()),a.uniform1f(A.uniformLocations.u_zoom,1),a.uniform2f(A.uniformLocations.u_fov,this.currentVerticalFOV*this.canvas.width/this.canvas.height,this.currentVerticalFOV),a.uniform1f(A.uniformLocations.u_transitionT,this.backgroundTransitionT.evaluate()),a.uniform1f(A.uniformLocations.u_yScale,this.canvas.height/(this.canvas.height-2*this.paddingHeight)),a.uniform2f(A.uniformLocations.u_screenResolution,this.canvas.width,this.canvas.height),a.uniform2f(A.uniformLocations.u_imageResolution,this.backgroundTextureResolution[0],this.backgroundTextureResolution[1]),a.uniform1i(A.uniformLocations.u_texture,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.backgroundTexture),a.uniform1i(A.uniformLocations.u_newTexture,1),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this.newBackgroundTexture),a.enableVertexAttribArray(0),a.bindBuffer(a.ARRAY_BUFFER,this.quadVertexBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),a.disable(a.DEPTH_TEST),a.depthMask(!0),a.disable(a.SCISSOR_TEST),a.viewport(0,this.paddingHeight,this.canvas.width,this.canvas.height-2*this.paddingHeight),a.useProgram(this.floorProgram.program),a.uniform3fv(this.floorProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.floorProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.floorProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.uniform1f(this.floorProgram.uniformLocations.u_scale,Object(f.n)(1,.5,this.backgroundIntensity.evaluate())),a.uniform1f(this.floorProgram.uniformLocations.u_gamma,2.2),a.uniform1f(this.floorProgram.uniformLocations.u_yOffset,this.floorYOffset.evaluate()),a.uniform1i(this.floorProgram.uniformLocations.u_texture,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.floorTexture),a.enable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.bindBuffer(a.ARRAY_BUFFER,this.quadVertexBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),a.disable(a.BLEND),a.disable(a.SCISSOR_TEST),a.enable(a.DEPTH_TEST),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTexture,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderbuffer),a.depthMask(!1),this.snowSpawnRate>0?this.dustScale.change(0,5):this.dustScale.change(1,2);var T=c.premultiply(new Float32Array(16),this.viewMatrix,this.projectionMatrix);this.dust.update(e,n,10,T),a.useProgram(this.dustProgram.program),a.uniform3fv(this.dustProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.dustProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.dustProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.uniform1f(this.dustProgram.uniformLocations.u_scale,this.dustScale.evaluate()),a.uniform1f(this.dustProgram.uniformLocations.u_time,e),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.enableVertexAttribArray(2),a.enableVertexAttribArray(3),a.enableVertexAttribArray(4),a.enable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.bindBuffer(a.ARRAY_BUFFER,this.dust.offsetBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.dust.randomBuffer),a.vertexAttribPointer(1,4,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.dust.spawnTimeBuffer),a.vertexAttribPointer(2,1,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.dust.spawnPositionBuffer),a.vertexAttribPointer(3,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.dust.spawnVelocityBuffer),a.vertexAttribPointer(4,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.dust.indexBuffer),a.drawElements(a.TRIANGLES,6*this.dust.particleCount,a.UNSIGNED_SHORT,0),a.disableVertexAttribArray(1),a.disableVertexAttribArray(2),a.disableVertexAttribArray(3),a.disableVertexAttribArray(4),a.disable(a.DEPTH_TEST),a.depthMask(!0),a.disable(a.BLEND),a.depthMask(!1),this.snow.update(e,n,this.snowSpawnRate,T),a.useProgram(this.snowProgram.program),a.uniform3fv(this.snowProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.snowProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.snowProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.uniform1f(this.snowProgram.uniformLocations.u_time,e),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.enableVertexAttribArray(2),a.enableVertexAttribArray(3),a.enable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.bindBuffer(a.ARRAY_BUFFER,this.snow.offsetBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.snow.randomBuffer),a.vertexAttribPointer(1,4,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.snow.spawnTimeBuffer),a.vertexAttribPointer(2,1,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.snow.spawnPositionBuffer),a.vertexAttribPointer(3,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.snow.indexBuffer),a.drawElements(a.TRIANGLES,6*this.snow.particleCount,a.UNSIGNED_SHORT,0),a.disableVertexAttribArray(1),a.disableVertexAttribArray(2),a.disableVertexAttribArray(3),a.disable(a.DEPTH_TEST),a.depthMask(!0),a.disable(a.BLEND),a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.canvas.width,this.canvas.height),a.useProgram(this.fxaaProgram.program),a.enableVertexAttribArray(0),a.bindBuffer(a.ARRAY_BUFFER,this.triangleVertexBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.uniform1i(this.fxaaProgram.uniformLocations.u_input,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.colorTexture),a.uniform2f(this.fxaaProgram.uniformLocations.u_resolution,this.canvas.width,this.canvas.height),a.uniform1f(this.fxaaProgram.uniformLocations.u_time,e),a.drawArrays(a.TRIANGLES,0,3),a.useProgram(this.uiProgram.program),a.uniformMatrix4fv(this.uiProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.uiProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.disable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);for(var E=0,R=t;E<R.length;E++){var M;if((M=R[E]).state!==P.Offscreen)for(var F=0,k=[M.pitchUI,M.vowelUI];F<k.length;F++){var I=k[F];0!==I.alpha.evaluate()&&(a.uniform1f(this.uiProgram.uniformLocations.u_alpha,I.alpha.evaluate()*I.overrideAlpha.evaluate()),a.uniformMatrix4fv(this.uiProgram.uniformLocations.u_modelMatrix,!1,I.getModelMatrix()),a.bindBuffer(a.ARRAY_BUFFER,I.lines.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,I.lines.colorsBuffer),a.vertexAttribPointer(1,4,a.FLOAT,!1,0,0),a.drawArrays(a.LINES,0,I.lines.vertexCount),a.bindBuffer(a.ARRAY_BUFFER,I.triangles.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,I.triangles.colorsBuffer),a.vertexAttribPointer(1,4,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,I.triangles.indexBuffer),a.drawArrays(a.TRIANGLES,0,I.triangles.vertexCount))}}a.disableVertexAttribArray(1),a.disable(a.BLEND);var C=Object(f.r)(this.startTime,this.startTime+1,Date.now()/1e3);C<1&&(a.disable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.useProgram(this.colorProgram.program),a.uniform4f(this.colorProgram.uniformLocations.u_color,0,0,0,1-C),a.enableVertexAttribArray(0),a.bindBuffer(a.ARRAY_BUFFER,this.triangleVertexBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.disable(a.BLEND))},t.prototype.getGl=function(){return this.gl},t}(),ot=n(11),rt=n(9),at=n(35);var st,lt=function(){function t(t){this.chunks=[],this.currentChunkIndex=0;var e=at.RecordedLibrettos.decode(t);!function(t){var e,n,i;for(i=t.length-1;i>0;i--)e=Math.floor(Math.random()*(i+1)),n=t[i],t[i]=t[e],t[e]=n}(e.librettos);for(var n=[],i=0,o=e.librettos;i<o.length;i++)for(var r=0,a=o[i].notes;r<a.length;r++){var s=a[r];if(s.name!==at.RecordedLibrettos.Phoneme.sil){var l=s.endTimeSeconds-s.startTimeSeconds;n.push({name:s.name,duration:l})}}for(var u=0;u<n.length-1;++u)Object(f.k)(n[u].name)&&!Object(f.k)(n[u+1].name)&&(n[u].duration=.2),Object(f.k)(n[u].name)&&Object(f.k)(n[u+1].name)&&(n[u].duration=.05);for(var c=0;!Object(f.k)(n[c].name)||Object(f.k)(n[c+1].name);)c++;var h=n[c],d=[];do{c+=1,Object(f.k)(n[c].name)&&!Object(f.k)(n[c+1].name)?(this.chunks.push({vowel:h,suffix:d}),h=n[c],d=[]):Object(f.k)(n[c].name)||d.push(n[c])}while(c<n.length-2)}return t.prototype.getNextChunk=function(t){this.currentChunkIndex+=1;var e=this.chunks[this.currentChunkIndex];return e.vowel.name=t,e},t}(),ut=function(){function t(t,e,n){this.frames=[],this.secondsInCurrentFrame=0,this.onFrameUsed=null,this.clock=t,this.timestepSeconds=e,this.delaySeconds=n}return t.prototype.update=function(){if(this.frames.length>=2)for(this.secondsInCurrentFrame+=this.clock.getDeltaTimeS();this.secondsInCurrentFrame>=this.timestepSeconds&&this.frames.length>=2;)this.onFrameUsed&&this.onFrameUsed(this.frames[0].buffer),this.frames.splice(0,1),this.secondsInCurrentFrame-=this.timestepSeconds;else this.secondsInCurrentFrame=this.timestepSeconds-this.delaySeconds},t.prototype.addFrame=function(t){this.frames.push(t)},t.prototype.getCurrentFrame=function(){return this.frames.length>0?this.frames[0]:null},t}(),ct=function(){function t(t){this.fromValue=[],this.targetValue=[];for(var e=0;e<t.length;++e)this.fromValue[e]=t[e],this.targetValue[e]=t[e];this.tweenDuration=1,this.tweenStartTime=-99999}return t.prototype.change=function(t,e){if(!Object(f.a)(this.targetValue,t)){this.evaluate(this.fromValue);for(var n=0;n<this.targetValue.length;++n)this.targetValue[n]=t[n];this.tweenDuration=1e3*e,this.tweenStartTime=Date.now()}},t.prototype.evaluate=function(t){if(0===this.tweenDuration)return this.targetValue;for(var e=Object(f.r)(this.tweenStartTime,this.tweenStartTime+this.tweenDuration,Date.now()),n=0;n<this.fromValue.length;++n)t[n]=Object(f.n)(this.fromValue[n],this.targetValue[n],e);return t},t}();function ht(t){return t===st.BlobperaHouse?"default":t===st.London?"london":t===st.NewYork?"new_york":t===st.Hackney?"hackney":t===st.Paris?"paris":t===st.CapeTown?"cape_town":t===st.MexicoCity?"mexico_city":t===st.Seoul?"seoul":"default"}!function(t){t[t.BlobperaHouse=0]="BlobperaHouse",t[t.London=1]="London",t[t.NewYork=2]="NewYork",t[t.Hackney=3]="Hackney",t[t.Paris=4]="Paris",t[t.CapeTown=5]="CapeTown",t[t.MexicoCity=6]="MexicoCity",t[t.Seoul=7]="Seoul"}(st||(st={}));var ft=function(){function t(){this.timeMs=0,this.deltaTimeMs=0}return t.prototype.tick=function(t){this.deltaTimeMs=t,this.timeMs+=t},t.prototype.getTimeMs=function(){return this.timeMs},t.prototype.getTimeS=function(){return this.timeMs/1e3},t.prototype.getDeltaTimeMs=function(){return this.deltaTimeMs},t.prototype.getDeltaTimeS=function(){return this.deltaTimeMs/1e3},t}(),dt='<svg width="100%" height="100%" viewBox="-10 -10 70 70" xmlns="http://www.w3.org/2000/svg"> <mask id="silence-line-$MASK" width="200%"> <rect x="-10" y="-10" width="160" height="100" fill="white"></rect> <use class="silence-line" xlink:href="#silence-line" stroke="black" stroke-width="6"></use> </mask> <use class="silence-line" xlink:href="#silence-line" stroke="white" stroke-width="4"></use> <use mask="url(#silence-line-$MASK)" xlink:href="#silence-icon"></use> </svg>',pt=Math.floor(20),mt=-3;function gt(t,e,n){var i=n.getBoundingClientRect();t.x=e.clientX-i.left,t.y=e.clientY-i.top}function bt(t,e){return Math.ceil(t.duration/e)}var vt=function(){function t(){this.buffersBySize={},this.buffersCreated=0}return t.prototype.getBuffersOfSize=function(t){var e=t.toFixed(0);return e in this.buffersBySize||(this.buffersBySize[e]=[]),this.buffersBySize[e]},t.prototype.allocateBuffers=function(t,e){for(var n=this.getBuffersOfSize(t),i=0;i<e;++i)this.buffersCreated+=1,n.push(new ArrayBuffer(t))},t.prototype.getBuffer=function(t){var e=this.getBuffersOfSize(t),n=null;return e.length>0?n=e.pop():(this.buffersCreated+=1,n=new ArrayBuffer(t)),n},t.prototype.returnBuffer=function(t){this.getBuffersOfSize(t.byteLength).push(t)},t.prototype.returnBuffers=function(t){for(var e=0,n=t;e<n.length;e++){var i=n[e];this.returnBuffer(i)}},t}(),yt=function(){function t(t){this.sampleCount=t,this.samples=[]}return t.prototype.add=function(t){this.samples.length===this.sampleCount&&this.samples.splice(0,1),this.samples.push(t)},t.prototype.get=function(){if(0===this.samples.length)return 0;for(var t=0,e=0;e<this.samples.length;++e)t+=this.samples[e];return t/this.samples.length},t.prototype.enoughSamples=function(){return this.samples.length===this.sampleCount},t.prototype.reset=function(){this.samples.length=0},t}(),_t=function(){function t(t,e,n,i,o,r,a){this.previousChunk={vowel:{name:y.b.a,duration:.2},suffix:[{name:y.b.m,duration:.05}]},this.currentChunk={vowel:{name:y.b.a,duration:.2},suffix:[{name:y.b.m,duration:.05}]},this.frameInCurrentPhoneme=0,this.streamIndex=t,this.singerIndex=a,this.audioParameters=n,this.currentMidiNote=o,this.currentMuted=!0,this.voiceNet=e,this.bufferPool=i,this.epoch=r,this.frameInCurrentPhoneme=bt(this.currentChunk.vowel,this.audioParameters.frameHopSeconds)}return t.prototype.singNote=function(t,e,n,i,o,r,a){var s=this;void 0===r&&(r=.2),void 0===a&&(a=!1);var l=this.audioParameters.frameHopSeconds*o,u=0,c=Math.round(r/l),h=bt(this.currentChunk.vowel,l)-this.frameInCurrentPhoneme-Math.ceil(c/2),d=function(r,a,d,p,m,g,b){for(var v=bt(m,l),y=r;y<a;++y){var _=Object(f.n)(s.currentMidiNote,e,Object(f.l)(h,h+c,u)),x=new ot.a(s.bufferPool.getBuffer(ot.a.getSizeBytes()));x.setPhoneme(m.name),x.setPreviousPhoneme(p.name),x.setNextPhoneme(g.name),x.setPhonemePosition(y/(v-1)),x.setF0(Object(f.m)(_)),x.setSingerIndex(s.singerIndex),x.setMidiNote(e),x.setMuted(d?s.currentMuted:n),x.setVowel(d?s.currentChunk.vowel.name:t.vowel.name),x.setControlled(i),x.setSubsteps(o),x.setSendTime(Date.now()-s.epoch+u*l*1e3),x.setSkip(b?1:0);for(var w=o,P=[],S=0;S<w;++S){var A=Object(f.n)(s.currentMidiNote,e,Object(f.l)(h*w,(h+c)*w,u*w+S)),T=new rt.a(s.bufferPool.getBuffer(rt.a.getSizeBytes()));T.setPhoneme(m.name),T.setPreviousPhoneme(p.name),T.setNextPhoneme(g.name);var E=(y*w+S)/(v*w-1);T.setPhonemePosition(E),T.setF0(Object(f.m)(A)),T.setSingerIndex(s.singerIndex),T.setMidiNote(e),T.setMuted(d?s.currentMuted:n),T.setVowel(d?s.currentChunk.vowel.name:t.vowel.name),T.setControlled(i),T.setSkip(b?1:0),P.push(T)}s.voiceNet.generate(s.streamIndex,x,P),u+=1}};d(this.frameInCurrentPhoneme,bt(this.currentChunk.vowel,l),!0,this.previousChunk.suffix[this.previousChunk.suffix.length-1],this.currentChunk.vowel,this.currentChunk.suffix[0],!0);for(var p=0;p<this.currentChunk.suffix.length;++p){var m=this.currentChunk.suffix[p];d(0,bt(m,l),!1,0===p?this.currentChunk.vowel:this.currentChunk.suffix[p-1],m,p===this.currentChunk.suffix.length-1?t.vowel:this.currentChunk.suffix[p+1],!1)}var g=bt(t.vowel,l),b=Math.floor(g*(t.vowel.name===y.b.sil?.9:.3));d(0,b,!1,this.currentChunk.suffix[this.currentChunk.suffix.length-1],t.vowel,t.suffix[0],!1),this.frameInCurrentPhoneme=b,this.previousChunk=this.currentChunk,this.currentChunk=t,this.currentMidiNote=e,this.currentMuted=n},t}(),xt=[[60,88],[60,83],[45,72],[36,66]];function wt(t,e){for(var n=0;n<4;++n)if(!(e<xt[n][0]||e>xt[n][1])&&e>t[n])return n;return e>=xt[3][0]&&e<=xt[3][1]?3:-1}var Pt=[y.b.n,y.b.r,y.b.l,y.b.t,y.b.s,y.b.d,y.b.m,y.b.p,y.b.v,y.b.c,y.b.ch,y.b.f,y.b.j,y.b.b,y.b.qu,y.b.h,y.b.g];function St(){return Pt[Math.floor(Math.random()*Pt.length)]}var At=[y.b.u,y.b.o,y.b.i,y.b.e,y.b.a];function Tt(t){var e=Math.floor(t/20);return At[Object(f.b)(e,0,At.length-1)]}var Et=function(){function t(t,e){this.lastActiveNotes=[],this.activeNotes=[],this.singingNotes=[{pitch:0,vowel:y.b.a},{pitch:0,vowel:y.b.a},{pitch:0,vowel:y.b.a},{pitch:0,vowel:y.b.a}],this.singers=t,this.opera=e}return t.prototype.onNote=function(t){var e=this,n=t.pitch,i=t.velocity;i>0?this.activeNotes.push({pitch:n,vowel:Tt(i)}):0===i&&(this.activeNotes=this.activeNotes.filter((function(t){return t.pitch!==n}))),this.activeNotes=this.activeNotes.sort((function(t,e){return e.pitch-t.pitch})),window.clearTimeout(this.timeout),this.timeout=window.setTimeout((function(){for(var t=[],n=[],i=function(n){e.activeNotes.find((function(t){return t.pitch===e.lastActiveNotes[n].pitch}))||t.push(e.lastActiveNotes[n])},o=0;o<e.lastActiveNotes.length;++o)i(o);var r=function(t){e.lastActiveNotes.find((function(n){return n.pitch===e.activeNotes[t].pitch}))||n.push(e.activeNotes[t])};for(o=0;o<e.activeNotes.length;++o)r(o);for(var a=e.singingNotes.map((function(t){return{pitch:t.pitch,vowel:t.vowel}})),s=0,l=t;s<l.length;s++){var u=l[s];for(o=0;o<4;++o)if(a[o].pitch===u.pitch){a[o].pitch=0;break}}for(var c=0,h=n;c<h.length;c++){u=h[c];var f=wt(a.map((function(t){return t.pitch})),u.pitch);f>-1&&(a[f]=u)}var d=e.opera.clock.getTimeMs();for(o=0;o<4;++o)if(a[o].pitch!==e.singingNotes[o].pitch)if(0===a[o].pitch){var p={vowel:{name:y.b.sil,duration:0},suffix:[{name:St(),duration:.05}]};e.singers[o].singNote(p,e.singingNotes[o].pitch,!0,!1,1,.1,!0),e.opera.addNoteToRecording(o,d,e.singingNotes[o].pitch,p,!1)}else{p={vowel:{name:a[o].vowel,duration:.1},suffix:[{name:St(),duration:.05}]};e.singers[o].singNote(p,a[o].pitch,!1,!1,1,.1,!0),e.opera.addNoteToRecording(o,d,a[o].pitch,p,!1)}e.singingNotes=a,e.lastActiveNotes=e.activeNotes.slice(0)}),50)},t}(),Rt=function(){function t(t){this.desiredNote=null,this.singingNote={pitch:0,vowel:y.b.a},this.singer=t}return t.prototype.onNote=function(t){var e=t.pitch,n=t.velocity;if(n>0?this.desiredNote={pitch:e,vowel:Tt(n)}:0===n&&this.desiredNote&&this.desiredNote.pitch===e&&(this.desiredNote={pitch:0,vowel:y.b.a}),this.desiredNote.pitch!==this.singingNote.pitch)if(0===this.desiredNote.pitch){var i={vowel:{name:y.b.sil,duration:0},suffix:[{name:St(),duration:.05}]};this.singer.singNote(i,this.singingNote.pitch,!0,!1,1,.1,!0)}else{i={vowel:{name:this.desiredNote.vowel,duration:.1},suffix:[{name:St(),duration:.05}]};this.singer.singNote(i,this.desiredNote.pitch,!1,!1,1,.1,!0)}this.singingNote=this.desiredNote},t}();!function(){function t(t){this.channelControllers=[];for(var e=0;e<t.length;++e)this.channelControllers.push(new Rt(t[e]))}t.prototype.onNote=function(t){t.channel<this.channelControllers.length&&this.channelControllers[t.channel].onNote(t)}}();!function(){function t(t){this.channelControllers=[];for(var e=0;e<t.length;++e)this.channelControllers.push(new Rt(t[e]))}t.prototype.onNote=function(t){if(0===t.velocity)for(var e=0,n=this.channelControllers;e<n.length;e++){var i=n[e];i.singingNote.pitch===t.pitch&&i.onNote(t)}else{for(var o=(c=t.pitch)>=72?0:c>=60?1:c>=48?2:3,r=this.channelControllers.filter((function(t){return o===t.singer.audioParameters.singers[t.singer.singerIndex].voiceType})),a=!1,s=0,l=r;s<l.length;s++){var u=l[s];if(0===u.singingNote.pitch){u.onNote(t),a=!0;break}}a||r[0].onNote(t)}var c}}();var Mt,Ft,kt=function(){function t(t){var e=this;this.mapper=t;try{navigator.requestMIDIAccess&&navigator.requestMIDIAccess().then((function(t){t.inputs.forEach((function(t){t.onmidimessage=e.onMidiMessage.bind(e)}))})).catch((function(t){}))}catch(t){}}return t.prototype.onMidiMessage=function(t){if(!(t.data[0]>=240)){var e=t.data[0]>>4,n=15&t.data[0],i=0,o=0;if(9===e)i=t.data[1],o=t.data[2];else{if(8!==e)return;i=t.data[1],o=0}this.mapper.onNote({pitch:i,velocity:o,channel:n})}},t}();function It(t){for(var e=[0,0,0],n=0,i=t;n<i.length;n++){var o=i[n];h.a.add(e,e,o)}return h.a.multiplyByScalar(e,e,1/t.length),e}function Ct(t){for(var e=0;e<t.length;++e)t[e]*=.85;for(var n=0,i=0,o=t;i<o.length;i++){n+=o[i]}var r=[],a=-n/2;for(e=0;e<4;++e){var s=a+t[e]/2,l=[s*Math.cos(Nt),0,s*Math.sin(Nt)];a+=t[e],r.push(l)}return r}function Bt(t){for(var e=[],n=0;n<4;++n){var i=It(t.slice(n)),o=Object(f.l)(0,3,n),r=.8*Object(f.n)(19.5,15,o),a=Object(f.n)(4.25,3.25,o)-.5;e.push(h.a.add([],i,[0,a,r]))}return e}!function(t){t[t.Main=0]="Main",t[t.Playing=1]="Playing"}(Mt||(Mt={})),function(t){t[t.Normal=0]="Normal",t[t.Festive=1]="Festive"}(Ft||(Ft={}));var Dt,Lt=["c","c#","d","d#","e","f","f#","g","g#","a","a#","b"],Nt=Object(f.e)(-30),Ot=[0,0,3],jt=Nt+Math.PI/2,Ut=[Math.cos(jt),0,Math.sin(jt)],zt=[0,.7,0],Gt=[[1,1,1,1],[1,1,2,3],[2,2,3,4],[2,3,6,5]],Vt=function(){function t(t,e,n,i,o,r,a,s,l,u,p,m,g,b,v,y){var _=this;this.stateChangeListeners=[],this.singers=[],this.blobs=[],this.state=Mt.Main,this.isRecording=!1,this.currentRecording=null,this.recordingStartTime=0,this.playing=!1,this.playingRecording=null,this.playbackStartTime=0,this.mouseX=.5,this.mouseY=.5,this.firstNoteTime=0,this.cameraPositionCache=[0,0,0],this.rendererPadding=new d.a(0,(function(t){return Object(f.q)(0,1,t)})),this.prompts=[],this.lastSungNote={midiPitch:0,vowel:null},this.blobController=null,this.lastControlledIndex=-1,this.tutorialState={kind:"Pitch",pitchesChanged:0,notesSung:0},this.personIndicators=[],this.suspended=!0,this.requestedFrame=-1,this.showingPrompts=!0,this.viewMatrix=new Float32Array(16),this.onTutorialFinished=null,this.onBlobInteraction=null,this.pitchPrompt={element:document.getElementById("pitch-prompt"),text:"",visible:!1,sounding:!1},this.vowelPrompt={element:document.getElementById("vowel-prompt"),text:"",visible:!1,sounding:!1},this.epoch=Date.now(),this.averageGenerationTime=new yt(200),this.worldRayDirection=[0,0,0,0],this.pos={x:0,y:0},this.overrideLookPositions={},this.lookPosition=[0,0,0],this.tempScreenPosition=[0,0,0,0],this.config=t,this.blobModule=i,this.qualitySettings=m,this.eyeBuffer=v,this.eyeBufferIsJSON=y,this.substepLevel=g,this.substeps=Gt[this.substepLevel],this.disableUI=t.disableUI,this.clock=new ft,this.frameHopSeconds=p,this.theme=Ft.Normal,this.snowSpawnRate=new d.a(0),this.canvas=e,this.harmonizer=o,this.voiceNet=r,this.voiceNet.setParameters(a.synthRunner.audioParameters),this.audio=a,this.audio.synthRunner.onFrameUsed=function(t){_.bufferPool.returnBuffer(t)},"Recording"===u.kind&&this.audio.synthRunner.setPans(this.audio.synthRunner.audioParameters.pans[0]),this.libretto=new lt(s),this.bufferPool=new vt,this.bufferPool.allocateBuffers(rt.a.getSizeBytes(),1e3),this.bufferPool.allocateBuffers(ot.a.getSizeBytes(),1e3);var x=Ct(b.blobs.map((function(t){return t.width})));if("relative"===t.positioningMode)this.cameraPositions=Bt(x);else{this.cameraPositions=[];for(var w=0;w<4;++w)this.cameraPositions.push(h.a.mix([],b.endCameraPosition,b.startCameraPosition,w/3))}var P=c.makeTranslation(new Float32Array(16),-this.cameraPositions[0][0],-this.cameraPositions[0][1],-this.cameraPositions[0][2]);this.renderer=new it(this.canvas,n,l.environmentAssets.backgroundImage,l.environmentAssets.floorImage,b.startCameraPosition,P,t.cameraFOVDegrees,b.blobs.map((function(t){return Object(f.h)(t.subsurfaceColor)})));var S=function(e){var n=b.blobs[e],o="relative"===t.positioningMode,r=new D(A.renderer.gl,i,v,A.eyeBufferIsJSON,l.blobAssets[e],a.synthRunner.audioParameters.voiceTypes[a.synthRunner.audioParameters.singers[n.singerIndex].voiceType].scale,m.blobSubdivisions,b.blobs[e],x[e],o),s=new ut(A.clock,a.synthRunner.audioParameters.frameHopSeconds,a.synthRunner.audioParameters.scriptProcessorBufferSize/a.sampleRate);s.onFrameUsed=function(t){_.bufferPool.returnBuffer(t)};var u=document.createElement("div");u.classList.add("silence-button"),u.classList.add("hideable-clickable"),u.innerHTML=dt.replace(/\$MASK/g,"mask-"+e.toFixed(0)),document.body.appendChild(u);var c=function(t){t.preventDefault(),_.blobs[e].silenced?_.blobs[e].silenced=!1:(_.sendSilence(e),_.blobs[e].silenced=!0)};u.addEventListener("click",c),u.addEventListener("touchstart",c);var h={element:u,visible:!0,silenced:!1,hideTime:0};A.blobs.push({blob:r,frameTracker:s,silenceButton:h,silenceWorldPosition:[0,0,0],silenced:!1,lastSentF0:440,harmonizationTimeout:"Empty",playbackIndex:0,oldBlob:null})},A=this;for(w=0;w<b.blobs.length;++w)S(w);e.addEventListener("mousedown",this.onMouseDown.bind(this)),e.addEventListener("mousemove",this.onMouseMove.bind(this)),window.addEventListener("mouseup",this.onMouseUp.bind(this)),e.addEventListener("touchstart",this.onTouchStart.bind(this)),e.addEventListener("touchmove",this.onTouchMove.bind(this)),e.addEventListener("touchend",this.onTouchEnd.bind(this)),e.addEventListener("touchcancel",this.onTouchCancel.bind(this));var T=function(t){r.addListener(t,(function(e,n){var i=Date.now()-_.epoch-e.getSendTime();i/=e.getSubsteps(),_.averageGenerationTime.add(i),_.averageGenerationTime.enoughSamples()&&(_.averageGenerationTime.get()>30?(_.substepLevel+=1,_.substepLevel=Math.min(_.substepLevel,3),_.substeps=Gt[_.substepLevel],_.averageGenerationTime.reset()):_.averageGenerationTime.get()<0&&(_.substepLevel-=1,_.substepLevel=Math.max(_.substepLevel,0),_.substeps=Gt[_.substepLevel],_.averageGenerationTime.reset())),_.onGeneratedFrame(t,e,n)}))};for(w=0;w<this.blobs.length;++w)T(w);for(w=0;w<this.blobs.length;++w){var E=this.audio.synthRunner.audioParameters,R=E.voiceTypes[E.singers[this.blobs[w].blob.config.singerIndex].voiceType].scale[3];this.singers.push(new _t(w,r,this.audio.synthRunner.audioParameters,this.bufferPool,R,this.epoch,this.blobs[w].blob.config.singerIndex))}this.audio.start(),this.prompts=[document.getElementById("soprano-prompt"),document.getElementById("alto-prompt"),document.getElementById("tenor-prompt"),document.getElementById("bass-prompt")];if("Default"===u.kind)this.rendererPadding=new d.a(0,(function(t){return Object(f.r)(0,1,t)})),this.cameraPosition=new ct(this.cameraPositions[0]),t.disableDrop||this.blobs[3].blob.startFalling(0),this.state=Mt.Main;else if("Recording"===u.kind){this.state=Mt.Playing,this.cameraPosition=new ct(this.cameraPositions[0]),this.rendererPadding=new d.a(0,(function(t){return Object(f.r)(0,1,t)})),this.playingRecording=u.recording,this.currentRecording=null,this.playing=!1;for(w=0;w<this.blobs.length;++w)this.blobs[w].blob.startFalling(10*w);this.startPlayback(2)}document.addEventListener("keypress",(function(t){"u"!==t.key&&"U"!==t.key||(_.disableUI=!_.disableUI);for(var e=0;e<4;++e)t.key===(e+1).toFixed(0)&&(_.blobs[e].silenced?_.blobs[e].silenced=!1:(_.sendSilence(e),_.blobs[e].silenced=!0))}));var M=new Et(this.singers,this);this.midiController=new kt(M),this.resume(),t.skipTutorial&&this.skipTutorial(10)}return t.prototype.onMouseDown=function(t){gt(this.pos,t,this.canvas),this.mouseX=this.pos.x/this.canvas.width,this.mouseY=1-this.pos.y/this.canvas.height;var e=this.renderer.cameraPosition,n=this.renderer.getWorldRayDirection(this.worldRayDirection,2*this.mouseX-1,2*this.mouseY-1);if(!this.blobController)for(var i=0;i<this.blobs.length;++i){var o=I(this.blobs[i].blob,e,n);if(o){"Finished"===this.tutorialState.kind&&(this.tutorialState.hasInteracted=!0),o.draggingRestPosition[1]-=.2,this.blobController=new B(this.blobs[i].blob,o.draggingRestPosition),this.onBlobInteraction&&this.onBlobInteraction(i);break}}this.audio.tryUnlock()},t.prototype.onMouseMove=function(t){gt(this.pos,t,this.canvas),this.mouseX=this.pos.x/this.canvas.width,this.mouseY=1-this.pos.y/this.canvas.height},t.prototype.onMouseUp=function(){this.blobController&&(this.blobController=null)},t.prototype.onTouchStart=function(t){t.preventDefault(),1===t.touches.length&&this.onMouseDown(t.targetTouches[0])},t.prototype.onTouchMove=function(t){t.preventDefault(),this.onMouseMove(t.targetTouches[0])},t.prototype.onTouchEnd=function(t){t.preventDefault(),t.touches.length>0||this.onMouseUp()},t.prototype.onTouchCancel=function(t){t.preventDefault(),t.touches.length>0||this.onMouseUp()},t.prototype.positionElementWorld=function(t,e,n,i){var o=this.renderer.getScreenPosition(this.tempScreenPosition,e),r=this.canvas.width*(.5*o[0]+.5),a=this.canvas.height*(1-(.5*o[1]+.5)),s="translate("+r.toFixed(0)+"px, "+a.toFixed(0)+"px) ";"left"===n?s+="translate(0, ":"right"===n?s+="translate(-100%, ":"center"===n&&(s+="translate(-50%, "),"bottom"===i?s+="-100%)":"center"===i?s+="-50%)":"top"===i&&(s+="0)"),t.style.transform=s},t.prototype.update=function(t){var e=this;this.clock.tick(t);for(var n=0,i=this.blobs;n<i.length;n++){(O=i[n]).frameTracker.update()}var o=this.renderer.cameraPosition,r=this.renderer.getWorldRayDirection(this.worldRayDirection,2*this.mouseX-1,2*this.mouseY-1);this.blobController&&this.blobController.step(o,r),Object(f.j)(this.lookPosition,Ot,Ut,o,r);for(var a=0;a<this.blobs.length;++a)a.toFixed(0)in this.overrideLookPositions?this.blobs[a].blob.lookPosition=this.overrideLookPositions[a.toFixed(0)]:this.blobs[a].blob.lookPosition=this.lookPosition;for(a=0;a<this.blobs.length;++a){this.blobs[a].silenced?(this.blobs[a].blob.eyeTopOpenness.change(0,.3),this.blobs[a].blob.eyeBottomOpenness.change(0,.3)):(this.blobs[a].blob.eyeTopOpenness.change(1,.3),this.blobs[a].blob.eyeBottomOpenness.change(0,.3))}for(a=0;a<this.blobs.length;++a){var s=this.blobs[a].frameTracker.getCurrentFrame(),l=[];if(this.blobController&&this.blobs[a].blob===this.blobController.blob&&l.push({yScale:this.blobController.yScale,zOffset:this.blobController.zOffset,isSelf:!0}),this.blobs[a].blob.step(l,s||null),null!==this.blobs[a].oldBlob){var u=this.blobs[a].oldBlob;u.canDestroy()?(u.destroy(),this.blobs[a].oldBlob=null):this.blobs[a].oldBlob.step(l,s||null)}}for(a=0;a<this.blobs.length;++a)this.blobs[a].blob.isDragging?(this.blobs[a].silenced=!1,this.audio.synthRunner.setOverrideFrequency(a,!0),this.audio.synthRunner.addOverrideF0(a,Object(f.m)(this.blobs[a].blob.liveMidiNote.evaluate()+mt))):this.audio.synthRunner.setOverrideFrequency(a,!1);if(null!==this.blobController){var d=this.blobController.blob,p=this.blobs.findIndex((function(t){return t.blob===d}));this.lastControlledIndex=p;var m=0===this.lastSungNote.midiPitch,g=m?.05:.2;if(!A(this.lastSungNote,d.currentPitchVowel)&&d.getTimeOnCurrentNote()>g&&this.voiceNet.framesBeingGenerated<pt){var b=this.clock.getTimeMs();if(this.state===Mt.Main)if("Pitch"===this.tutorialState.kind)this.tutorialState.notesSung+=1,d.currentPitchVowel.midiPitch!==this.lastSungNote.midiPitch&&(this.tutorialState.pitchesChanged+=1,4===this.tutorialState.pitchesChanged&&this.blobs[2].blob.startFalling(0));else if("Vowel"===this.tutorialState.kind&&2===p){this.tutorialState.notesSung+=1,d.currentPitchVowel.vowel!==this.lastSungNote.vowel&&(this.tutorialState.vowelsChanged+=1,3===this.tutorialState.vowelsChanged&&this.blobs[1].blob.startFalling(0))}else if("Harmonization"===this.tutorialState.kind&&1===p){if(this.tutorialState.notesSung+=1,2===this.tutorialState.notesSung){var v=0;for(a=this.getUnlockedVoiceIndex()-1;a>=0;a-=1)this.blobs[a].blob.startFalling(v),v+=10;for(a=4;a<this.blobs.length;++a)this.blobs[a].blob.startFalling(v),v+=10}}else"Mute"===this.tutorialState.kind&&0===p&&(this.tutorialState.notesSung+=1);m&&(this.firstNoteTime=b),p<4&&this.audio.synthRunner.setPans(this.audio.synthRunner.audioParameters.pans[p]);var _=this.audio.synthRunner.audioParameters.singers[this.blobs[p].blob.config.singerIndex].voiceType,x=d.currentPitchVowel;this.lastSungNote=x;var w=this.libretto.getNextChunk(x.vowel);if(this.singers[p].singNote(w,x.midiPitch+mt,!1,!1,this.substeps[p]),this.addNoteToRecording(p,b,x.midiPitch+mt,w,!0),this.state===Mt.Main){var S=x.midiPitch;2!==_&&3!==_||(S+=12),this.harmonizer.harmonize(S).then((function(t){t[_].midiNote=x.midiPitch;for(var n=function(n){for(var i=200*(n-_),o=e.firstNoteTime+i,r=function(r){var a=e.blobs[r];e.audio.synthRunner.audioParameters.singers[a.blob.config.singerIndex].voiceType===n&&r!==p&&("Fired"!==a.harmonizationTimeout?("Empty"!==a.harmonizationTimeout&&window.clearTimeout(e.blobs[n].harmonizationTimeout),a.harmonizationTimeout=window.setTimeout((function(){var o=e.singers[p].previousChunk;if(!Object(f.a)(o.suffix.map((function(t){return t.name})),e.singers[r].currentChunk.suffix.map((function(t){return t.name})))){var s={vowel:{name:y.b.sil,duration:o.vowel.duration},suffix:o.suffix};e.singers[r].singNote(s,e.singers[r].currentMidiNote,!0,!1,1)}e.singers[r].singNote(e.singers[p].currentChunk,t[n].midiNote+mt,!1,!1,e.substeps[n]),e.addNoteToRecording(r,b+i,t[n].midiNote+mt,e.singers[r].currentChunk,!1),a.harmonizationTimeout="Fired"}),o-e.clock.getTimeMs())):"Fired"===e.blobs[r].harmonizationTimeout&&(e.singers[r].singNote(w,t[n].midiNote+mt,!1,!1,e.substeps[n]),e.addNoteToRecording(r,b,t[n].midiNote+mt,w,!1)))},a=0;a<e.blobs.length;++a)r(a)},i=_;i<4;++i)n(i)}))}}}if(null===this.blobController&&0!==this.lastSungNote.midiPitch){var T=this.libretto.getNextChunk(y.b.sil),E=this.clock.getTimeMs();if(this.state===Mt.Main)for(a=0;a<this.blobs.length;++a)this.singers[a].currentMuted||(this.singers[a].singNote(T,this.singers[a].currentMidiNote,!0,!1,this.substeps[a]),this.addNoteToRecording(a,E,this.singers[a].currentMidiNote,T,!1));else if(this.state===Mt.Playing){var R=this.lastControlledIndex;-1!==R&&(this.singers[R].currentMuted||this.singers[R].singNote(T,this.singers[R].currentMidiNote,!0,!1,this.substeps[R]))}for(a=0;a<this.blobs.length;++a)"Empty"!==this.blobs[a].harmonizationTimeout&&"Fired"!==this.blobs[a].harmonizationTimeout&&window.clearTimeout(this.blobs[a].harmonizationTimeout),this.blobs[a].harmonizationTimeout="Empty";this.lastSungNote={midiPitch:0,vowel:null},this.lastControlledIndex=-1}if(this.state===Mt.Playing&&this.playing){var M=Math.max(0,(this.clock.getTimeMs()-this.playbackStartTime)/1e3);for(a=0;a<this.blobs.length;++a)for(var F=this.playingRecording.parts[a].notes;this.blobs[a].playbackIndex<F.length&&F[this.blobs[a].playbackIndex].timeSeconds<M;){var k=F[this.blobs[a].playbackIndex],I=k.librettoChunk.vowel.duration<=.11;this.blobs[a].blob.isDragging||this.singers[a].singNote(k.librettoChunk,k.midiPitch,k.librettoChunk.vowel.name===y.b.sil,k.controlled,this.substeps[a],I?.1:.2),this.blobs[a].playbackIndex+=1}(function(t,e){for(var n=0;n<e.length;++n)if(e[n]<t.parts[n].notes.length)return!1;return!0})(this.playingRecording,this.blobs.map((function(t){return t.playbackIndex})))&&this.startPlayback(1)}for(var C=!1,B=0,D=this.blobs;B<D.length;B++){(O=D[B]).blob.isDragging&&(C=!0)}for(var L=0,N=this.blobs;L<N.length;L++){(O=N[L]).blob.overrideHipnotized=!this.playing&&!O.blob.isDragging&&O.blob.isSinging&&C,O.oldBlob&&(O.oldBlob.overrideHipnotized=!1)}if("Finished"===this.tutorialState.kind)for(a=0;a<4;++a)this.prompts[a].classList.remove("visible");else for(a=0;a<4;++a){var O=this.blobs[a].blob,j=c.transformPosition([],h.a.add([],O.getMouthCentroid(),[-.3,0,0]),O.modelMatrix);if(this.positionElementWorld(this.prompts[a],j,"right","center"),this.blobs[a].blob.state!==P.Falling){var U=!1;3===a?U="Pitch"===this.tutorialState.kind:2===a?U="Vowel"===this.tutorialState.kind:1===a?U="Harmonization"===this.tutorialState.kind:0===a&&(U="Mute"===this.tutorialState.kind),U&&this.state===Mt.Main&&this.showingPrompts&&!this.disableUI?this.prompts[a].classList.add("visible"):this.prompts[a].classList.remove("visible")}}for(a=0;a<this.blobs.length;++a){var z=this.state===Mt.Main&&"Mute"===this.tutorialState.kind&&this.tutorialState.notesSung>0||"Finished"===this.tutorialState.kind||this.state===Mt.Playing,G=this.blobs[a].silenceButton;!z||this.isDraggingBlob()&&"Mute"!==this.tutorialState.kind||!this.showingPrompts||this.disableUI?G.visible&&(G.element.classList.remove("visible"),G.visible=!1):G.visible||(G.element.classList.add("visible"),G.visible=!0),this.blobs[a].silenced?G.silenced||(G.element.classList.add("silenced"),G.silenced=!0):G.silenced&&(G.element.classList.remove("silenced"),G.silenced=!1,G.hideTime=Date.now()),G.visible&&(h.a.add(this.blobs[a].silenceWorldPosition,this.blobs[a].blob.getTopPosition(),zt),c.transformPosition(this.blobs[a].silenceWorldPosition,this.blobs[a].silenceWorldPosition,this.blobs[a].blob.modelMatrix),this.positionElementWorld(this.blobs[a].silenceButton.element,this.blobs[a].silenceWorldPosition,"left","bottom"))}if(this.rendererPadding.change(this.state===Mt.Playing?60:0,1),this.renderer.paddingHeight=Math.round(this.rendererPadding.evaluate()),"Pitch"===this.tutorialState.kind&&this.state===Mt.Main&&null!==this.blobController&&this.showingPrompts){this.pitchPrompt.visible||(this.pitchPrompt.element.classList.add("visible"),this.pitchPrompt.visible=!0);O=this.blobController.blob;var V=c.transformPosition([],[.3,O.pitchUI.indicatorY.evaluate(),0],O.pitchUI.getModelMatrix()),H=Lt[(O.pitchUI.currentDraggedValue+mt)%12].toUpperCase();this.pitchPrompt.text!==H&&(document.getElementById("pitch-prompt-pitch").innerText=H,this.pitchPrompt.text=H),this.positionElementWorld(this.pitchPrompt.element,V,"left","center"),O.pitchUI.currentSoundedValue===O.pitchUI.currentDraggedValue?this.pitchPrompt.sounding||(document.getElementById("pitch-prompt-pitch").classList.add("sounding"),this.pitchPrompt.sounding=!0):this.pitchPrompt.sounding&&(document.getElementById("pitch-prompt-pitch").classList.remove("sounding"),this.pitchPrompt.sounding=!1)}else this.pitchPrompt.visible&&(this.pitchPrompt.element.classList.remove("visible"),this.pitchPrompt.visible=!1);if("Vowel"===this.tutorialState.kind&&this.state===Mt.Main&&null!==this.blobController&&2===this.blobs.findIndex((function(t){return t.blob===e.blobController.blob}))&&this.showingPrompts){this.vowelPrompt.visible||(this.vowelPrompt.element.classList.add("visible"),this.vowelPrompt.visible=!0);O=this.blobController.blob,V=c.transformPosition([],[-.2,O.vowelUI.indicatorY.evaluate(),0],O.vowelUI.getModelMatrix());var Y=Object(y.c)(O.vowelUI.currentDraggedValue);this.vowelPrompt.text!==Y&&(document.getElementById("vowel-prompt-vowel").innerText=Object(y.c)(O.vowelUI.currentDraggedValue),this.vowelPrompt.text=Y),this.positionElementWorld(this.vowelPrompt.element,V,"center","bottom"),O.vowelUI.currentSoundedValue===O.vowelUI.currentDraggedValue?this.vowelPrompt.sounding||(document.getElementById("vowel-prompt-vowel").classList.add("sounding"),this.vowelPrompt.sounding=!0):this.vowelPrompt.sounding&&(document.getElementById("vowel-prompt-vowel").classList.remove("sounding"),this.vowelPrompt.sounding=!1)}else this.vowelPrompt.visible&&(this.vowelPrompt.element.classList.remove("visible"),this.vowelPrompt.visible=!1);this.state!==Mt.Main||this.isDraggingBlob()||(this.cameraPosition.change(this.cameraPositions[this.getUnlockedVoiceIndex()],1.5),"Finished"!==this.tutorialState.kind&&("Pitch"===this.tutorialState.kind&&this.tutorialState.pitchesChanged>=4?this.tutorialState={kind:"Vowel",vowelsChanged:0,notesSung:0}:"Vowel"===this.tutorialState.kind&&this.tutorialState.vowelsChanged>=3?this.tutorialState={kind:"Harmonization",notesHarmonized:0,notesSung:0}:"Harmonization"===this.tutorialState.kind&&this.tutorialState.notesSung>=2?this.tutorialState={kind:"Mute",notesSung:0}:"Mute"===this.tutorialState.kind&&this.tutorialState.notesSung>0&&(this.tutorialState={kind:"Finished",hasInteracted:!1},this.audio.samplePlayer.play("applause"),this.onTutorialFinished&&this.onTutorialFinished())));for(a=0;a<this.blobs.length;++a)this.state===Mt.Main&&("Pitch"===this.tutorialState.kind||"Vowel"===this.tutorialState.kind&&a===this.blobs.length-1)?this.blobs[a].blob.vowelUI.overrideAlpha.change(0,.5,.5):this.blobs[a].blob.vowelUI.overrideAlpha.change(1,.5,.5),this.state===Mt.Main&&"Vowel"===this.tutorialState.kind&&a!==this.blobs.length-1?(2===a&&this.blobs[a].blob.vowelUI.yOffset.change(2.7,0),this.blobs[a].blob.pitchUI.overrideAlpha.change(0,.5)):(a>=2&&this.blobs[a].blob.vowelUI.yOffset.change(0,1,0),this.blobs[a].blob.pitchUI.overrideAlpha.change(1,.5)),this.disableUI&&(this.blobs[a].blob.vowelUI.overrideAlpha.change(0,0),this.blobs[a].blob.pitchUI.overrideAlpha.change(0,0));this.cameraPosition.evaluate(this.cameraPositionCache),this.renderer.setViewMatrix(c.makeTranslation(this.viewMatrix,-this.cameraPositionCache[0],-this.cameraPositionCache[1],-this.cameraPositionCache[2])),this.theme===Ft.Festive?this.snowSpawnRate.change(600,1):this.snowSpawnRate.change(0,1),this.renderer.snowSpawnRate=this.snowSpawnRate.evaluate();var W=[];for(a=0;a<this.blobs.length;++a)W.push(this.blobs[a].blob),null!==this.blobs[a].oldBlob&&W.push(this.blobs[a].oldBlob);this.renderer.render(W)},t.prototype.addNoteToRecording=function(t,e,n,i,o){this.isRecording&&this.currentRecording.parts[t].notes.push({timeSeconds:(e-this.recordingStartTime)/1e3,librettoChunk:i,midiPitch:n,controlled:o})},t.prototype.onGeneratedFrame=function(t,e,n){if(this.blobs[t].lastSentF0=e.getF0(),1!==e.getSkip()){if(!this.blobs[t].silenced)for(o=0;o<n.length;++o){var i=this.bufferPool.getBuffer(rt.a.getSizeBytes());Object(f.d)(n[o].buffer,i),this.blobs[t].frameTracker.addFrame(new rt.a(i))}if(!this.blobs[t].silenced&&!this.audio.isMuted()){this.audio.synthRunner.addSpectralFrame(t,e);for(o=0;o<n.length;++o)this.audio.synthRunner.addExcitationFrame(t,n[o])}}else{this.bufferPool.returnBuffer(e.buffer);for(var o=0;o<n.length;++o)this.bufferPool.returnBuffer(n[o].buffer)}},t.prototype.sendSilence=function(t){for(var e=this,n=new ot.a(this.bufferPool.getBuffer(ot.a.getSizeBytes())),i=n.getSpectral(),o=0;o<60;++o)i[o]=-120;var r=function(n){n.setMuted(!0),n.setF0(e.blobs[t].lastSentF0),n.setMidiNote(Object(f.g)(e.blobs[t].lastSentF0)),n.setPhoneme(y.b.sil),n.setNextPhoneme(y.b.sil),n.setVowel(y.b.sil),n.setSingerIndex(e.blobs[t].blob.config.singerIndex),n.setPreviousPhoneme(y.b.sil),n.setPhonemePosition(0),n.setSkip(0)};r(n),n.setSubsteps(this.substeps[t]),n.setSendTime(Date.now()-this.epoch);var a=[];for(o=0;o<1;++o){var s=new rt.a(this.bufferPool.getBuffer(rt.a.getSizeBytes()));r(s);for(var l=s.getAperiodic(),u=0;u<4;++u)l[u]=-120;a.push(s)}this.onGeneratedFrame(t,n,a)},t.prototype.addStateChangeListener=function(t){this.stateChangeListeners.push(t)},t.prototype.fireStateChangeListeners=function(){for(var t=0,e=this.stateChangeListeners;t<e.length;t++){(0,e[t])(this.state)}},t.prototype.getUnlockedVoiceIndex=function(){return"Pitch"===this.tutorialState.kind?3:"Vowel"===this.tutorialState.kind?2:"Harmonization"===this.tutorialState.kind?1:"Finished"===this.tutorialState.kind||"Mute"===this.tutorialState.kind?0:void 0},t.prototype.setAudioParameters=function(t){this.audio.synthRunner.setAudioParameters(t),this.voiceNet.setParameters(t)},t.prototype.freeze=function(){this.suspended||(this.audio.suspend(),cancelAnimationFrame(this.requestedFrame),this.suspended=!0)},t.prototype.resume=function(){var t=this;if(this.suspended){this.audio.resume();var e=!0,n=0,i=function(o){var r=e?1e3/60:o-n;t.update(r),t.requestedFrame=requestAnimationFrame(i),n=o,e&&(e=!1)};this.requestedFrame=requestAnimationFrame(i),this.suspended=!1}},t.prototype.completedTutorial=function(){return"Finished"===this.tutorialState.kind},t.prototype.isDraggingBlob=function(){return null!==this.blobController},t.prototype.exitPlaying=function(){this.stopPlayback()},t.prototype.enterMain=function(){if(this.state!==Mt.Main){this.state===Mt.Playing&&this.exitPlaying();for(var t=0;t<this.getUnlockedVoiceIndex();++t)this.blobs[t].blob.startRising(10*t);this.state=Mt.Main,this.fireStateChangeListeners()}},t.prototype.enterPlaying=function(t){if(this.state===Mt.Main){for(var e=0;e<this.getUnlockedVoiceIndex();++e)this.blobs[e].blob.state!==P.Idle&&this.blobs[e].blob.startFalling(10*e);this.cameraPosition.change(this.cameraPositions[0],1)}else this.state,Mt.Playing;this.state=Mt.Playing,this.setTheme(t.theme),this.playingRecording=t,this.playing=!1,this.startPlayback(0),this.fireStateChangeListeners()},t.prototype.startNewRecording=function(t){this.isRecording=!0,this.currentRecording=function(t,e){for(var n=[],i=0;i<t;++i)n.push({notes:[],startSuffix:[]});return{theme:Ft.Normal,location:e,parts:n}}(this.blobs.length,t),this.recordingStartTime=this.clock.getTimeMs(),"Finished"===this.tutorialState.kind&&(this.tutorialState.hasInteracted=!0)},t.prototype.finishRecording=function(){if(!this.isRecording)return null;var t=this.currentRecording;return function(t,e){for(var n=1/0,i=0,o=t.parts;i<o.length;i++){(l=o[i]).notes.length>0&&(n=Math.min(n,l.notes[0].timeSeconds))}for(var r=e-n,a=0,s=t.parts;a<s.length;a++)for(var l,u=0,c=(l=s[a]).notes;u<c.length;u++){c[u].timeSeconds+=r}}(t,.2),this.isRecording=!1,this.currentRecording=null,t},t.prototype.togglePlayback=function(){this.state===Mt.Playing&&(this.playing?this.stopPlayback():this.startPlayback(0))},t.prototype.startPlayback=function(t){if(this.state===Mt.Playing){this.playing=!0,this.playbackStartTime=this.clock.getTimeMs()+1e3*t;for(var e=0,n=this.blobs;e<n.length;e++){n[e].playbackIndex=0}}},t.prototype.stopPlayback=function(){if(this.state===Mt.Playing&&this.playing){this.playing=!1;for(var t=this.libretto.getNextChunk(y.b.sil),e=0;e<this.blobs.length;++e)this.singers[e].currentMuted||this.singers[e].singNote(t,this.singers[e].currentMidiNote,!0,!1,1)}},t.prototype.skipTutorial=function(t){if(void 0===t&&(t=0),this.state===Mt.Main){if(!this.config.disableDrop){for(var e=t,n=this.getUnlockedVoiceIndex()-1;n>=0;n-=1)this.blobs[n].blob.startFalling(e),e+=10;for(n=4;n<this.blobs.length;++n)this.blobs[n].blob.startFalling(e),e+=10}this.tutorialState={kind:"Finished",hasInteracted:!0}}},t.prototype.setTheme=function(t){},t.prototype.setScene=function(t,e){for(var n=Ct(t.blobs.map((function(t){return t.width}))),i=0;i<4;++i){this.blobs[i].oldBlob&&(this.blobs[i].oldBlob.destroy(),this.blobs[i].oldBlob=null);var o=t.blobs[i],r=new D(this.renderer.gl,this.blobModule,this.eyeBuffer,this.eyeBufferIsJSON,e.blobAssets[i],this.audio.synthRunner.audioParameters.voiceTypes[this.audio.synthRunner.audioParameters.singers[o.singerIndex].voiceType].scale,this.qualitySettings.blobSubdivisions,t.blobs[i],n[i],!0);this.blobs[i].oldBlob=this.blobs[i].blob,this.blobs[i].blob=r,r.startFalling(10*i),this.blobs[i].oldBlob.exitStageLeft()}this.cameraPositions=Bt(n),this.renderer.changeScene(e.environmentAssets.backgroundImage,e.environmentAssets.floorImage,.2)},t.prototype.getAudioRTF=function(){return this.audio.synthRunner.getAverageTime()},t.prototype.getAudioRTFEnoughSamples=function(){return this.audio.synthRunner.getEnoughSamples()},t.prototype.getGl=function(){return this.renderer.getGl()},t}(),Ht=(Dt="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(t){var e,n,i=void 0!==(t=t||{})?t:{};i.ready=new Promise((function(t,i){e=t,n=i}));var o,r={};for(o in i)i.hasOwnProperty(o)&&(r[o]=i[o]);var a,s=[],l="";"undefined"!=typeof document&&document.currentScript&&(l=document.currentScript.src),Dt&&(l=Dt),l=0!==l.indexOf("blob:")?l.substr(0,l.lastIndexOf("/")+1):"";var u,c,h=i.print||console.log.bind(console),f=i.printErr||console.warn.bind(console);for(o in r)r.hasOwnProperty(o)&&(i[o]=r[o]);r=null,i.arguments&&(s=i.arguments),i.thisProgram&&i.thisProgram,i.quit&&i.quit,i.wasmBinary&&(u=i.wasmBinary),i.noExitRuntime&&i.noExitRuntime,"object"!=typeof WebAssembly&&I("no native wasm support detected");var d=!1;function p(t){var e,n=i["_"+t];return e="Cannot call unknown function "+t+", make sure it is exported",n||I("Assertion failed: "+e),n}function m(t,e,n,i,o){var r={string:function(t){var e=0;if(null!=t&&0!==t){var n=1+(t.length<<2);!function(t,e,n){!function(t,e,n,i){if(!(i>0))return 0;for(var o=n+i-1,r=0;r<t.length;++r){var a=t.charCodeAt(r);if(a>=55296&&a<=57343){var s=t.charCodeAt(++r);a=65536+((1023&a)<<10)|1023&s}if(a<=127){if(n>=o)break;e[n++]=a}else if(a<=2047){if(n+1>=o)break;e[n++]=192|a>>6,e[n++]=128|63&a}else if(a<=65535){if(n+2>=o)break;e[n++]=224|a>>12,e[n++]=128|a>>6&63,e[n++]=128|63&a}else{if(n+3>=o)break;e[n++]=240|a>>18,e[n++]=128|a>>12&63,e[n++]=128|a>>6&63,e[n++]=128|63&a}}e[n]=0}(t,v,e,n)}(t,e=$(n),n)}return e},array:function(t){var e=$(t.length);return function(t,e){b.set(t,e)}(t,e),e}},a=p(t),s=[],l=0;if(i)for(var u=0;u<i.length;u++){var c=r[n[u]];c?(0===l&&(l=K()),s[u]=c(i[u])):s[u]=i[u]}var h=a.apply(null,s);return h=function(t){return"string"===e?w(t):"boolean"===e?Boolean(t):t}(h),0!==l&&Q(l),h}var g,b,v,y,_="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function x(t,e,n){for(var i=e+n,o=e;t[o]&&!(o>=i);)++o;if(o-e>16&&t.subarray&&_)return _.decode(t.subarray(e,o));for(var r="";e<o;){var a=t[e++];if(128&a){var s=63&t[e++];if(192!=(224&a)){var l=63&t[e++];if((a=224==(240&a)?(15&a)<<12|s<<6|l:(7&a)<<18|s<<12|l<<6|63&t[e++])<65536)r+=String.fromCharCode(a);else{var u=a-65536;r+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else r+=String.fromCharCode((31&a)<<6|s)}else r+=String.fromCharCode(a)}return r}function w(t,e){return t?x(v,t,e):""}function P(t){g=t,i.HEAP8=b=new Int8Array(t),i.HEAP16=new Int16Array(t),i.HEAP32=y=new Int32Array(t),i.HEAPU8=v=new Uint8Array(t),i.HEAPU16=new Uint16Array(t),i.HEAPU32=new Uint32Array(t),i.HEAPF32=new Float32Array(t),i.HEAPF64=new Float64Array(t)}i.INITIAL_MEMORY;var S,A=[],T=[],E=[],R=[];T.push({func:function(){Z()}});var M=0,F=null,k=null;function I(t){i.onAbort&&i.onAbort(t),f(t+=""),d=!0,t="abort("+t+"). Build with -s ASSERTIONS=1 for more info.";var e=new WebAssembly.RuntimeError(t);throw n(e),e}function C(t){return e=t,n="data:application/octet-stream;base64,",String.prototype.startsWith?e.startsWith(n):0===e.indexOf(n);var e,n}i.preloadedImages={},i.preloadedAudios={};var B,D="blobmodule.wasm";function L(t){try{if(t==D&&u)return new Uint8Array(u);if(a)return a(t);throw"both async and sync fetching of the wasm failed"}catch(t){I(t)}}function N(t){for(;t.length>0;){var e=t.shift();if("function"!=typeof e){var n=e.func;"number"==typeof n?void 0===e.arg?S.get(n)():S.get(n)(e.arg):n(void 0===e.arg?null:e.arg)}else e(i)}}C(D)||(B=D,D=i.locateFile?i.locateFile(B,l):l+B);var O=0,j=4,U=8,z=12,G=13,V=16;function H(t){this.excPtr=t,this.ptr=t-V,this.set_type=function(t){y[this.ptr+U>>2]=t},this.get_type=function(){return y[this.ptr+U>>2]},this.set_destructor=function(t){y[this.ptr+O>>2]=t},this.get_destructor=function(){return y[this.ptr+O>>2]},this.set_refcount=function(t){y[this.ptr+j>>2]=t},this.set_caught=function(t){t=t?1:0,b[this.ptr+z>>0]=t},this.get_caught=function(){return 0!=b[this.ptr+z>>0]},this.set_rethrown=function(t){t=t?1:0,b[this.ptr+G>>0]=t},this.get_rethrown=function(){return 0!=b[this.ptr+G>>0]},this.init=function(t,e){this.set_type(t),this.set_destructor(e),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var t=y[this.ptr+j>>2];y[this.ptr+j>>2]=t+1},this.release_ref=function(){var t=y[this.ptr+j>>2];return y[this.ptr+j>>2]=t-1,1===t}}function Y(t){try{return c.grow(t-g.byteLength+65535>>>16),P(c.buffer),1}catch(t){}}var W,q={mappings:{},buffers:[null,[],[]],printChar:function(t,e){var n=q.buffers[t];0===e||10===e?((1===t?h:f)(x(n,0)),n.length=0):n.push(e)},varargs:void 0,get:function(){return q.varargs+=4,y[q.varargs-4>>2]},getStr:function(t){return w(t)},get64:function(t,e){return t}},X={b:function(t){return J(t+V)+V},a:function(t,e,n){throw new H(t).init(e,n),t},d:function(){I()},e:function(t,e,n){v.copyWithin(t,e,e+n)},f:function(t){t>>>=0;var e=v.length;if(t>2147483648)return!1;for(var n,i,o=1;o<=4;o*=2){var r=e*(1+.2/o);if(r=Math.min(r,t+100663296),Y(Math.min(2147483648,((n=Math.max(16777216,t,r))%(i=65536)>0&&(n+=i-n%i),n))))return!0}return!1},c:function(t,e,n,i){for(var o=0,r=0;r<n;r++){for(var a=y[e+8*r>>2],s=y[e+(8*r+4)>>2],l=0;l<s;l++)q.printChar(t,v[a+l]);o+=s}return y[i>>2]=o,0}},Z=(function(){var t={a:X};function e(t,e){var n=t.exports;i.asm=n,P((c=i.asm.g).buffer),S=i.asm.wa,function(t){if(M--,i.monitorRunDependencies&&i.monitorRunDependencies(M),0==M&&(null!==F&&(clearInterval(F),F=null),k)){var e=k;k=null,e()}}()}function o(t){e(t.instance)}function r(e){return(u||"function"!=typeof fetch?Promise.resolve().then((function(){return L(D)})):fetch(D,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+D+"'";return t.arrayBuffer()})).catch((function(){return L(D)}))).then((function(e){return WebAssembly.instantiate(e,t)})).then(e,(function(t){f("failed to asynchronously prepare wasm: "+t),I(t)}))}if(M++,i.monitorRunDependencies&&i.monitorRunDependencies(M),i.instantiateWasm)try{return i.instantiateWasm(t,e)}catch(t){return f("Module.instantiateWasm callback failed with error: "+t),!1}(u||"function"!=typeof WebAssembly.instantiateStreaming||C(D)||"function"!=typeof fetch?r(o):fetch(D,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,t).then(o,(function(t){return f("wasm streaming compile failed: "+t),f("falling back to ArrayBuffer instantiation"),r(o)}))}))).catch(n)}(),i.___wasm_call_ctors=function(){return(Z=i.___wasm_call_ctors=i.asm.h).apply(null,arguments)}),J=(i._createBlob=function(){return(i._createBlob=i.asm.i).apply(null,arguments)},i._deleteBlob=function(){return(i._deleteBlob=i.asm.j).apply(null,arguments)},i._blobStep=function(){return(i._blobStep=i.asm.k).apply(null,arguments)},i._blobReset=function(){return(i._blobReset=i.asm.l).apply(null,arguments)},i._blobAddImpulse=function(){return(i._blobAddImpulse=i.asm.m).apply(null,arguments)},i._blobGetRestMouthCentroid=function(){return(i._blobGetRestMouthCentroid=i.asm.n).apply(null,arguments)},i._blobGetMouthCentroid=function(){return(i._blobGetMouthCentroid=i.asm.o).apply(null,arguments)},i._blobGetTopIndex=function(){return(i._blobGetTopIndex=i.asm.p).apply(null,arguments)},i._blobGetVertexCount=function(){return(i._blobGetVertexCount=i.asm.q).apply(null,arguments)},i._blobGetPositions=function(){return(i._blobGetPositions=i.asm.r).apply(null,arguments)},i._blobGetRestPositions=function(){return(i._blobGetRestPositions=i.asm.s).apply(null,arguments)},i._blobGetNormals=function(){return(i._blobGetNormals=i.asm.t).apply(null,arguments)},i._blobGetUVs=function(){return(i._blobGetUVs=i.asm.u).apply(null,arguments)},i._blobGetIndices=function(){return(i._blobGetIndices=i.asm.v).apply(null,arguments)},i._blobGetIndexCount=function(){return(i._blobGetIndexCount=i.asm.w).apply(null,arguments)},i._blobGetRenderingVertexCount=function(){return(i._blobGetRenderingVertexCount=i.asm.x).apply(null,arguments)},i._blobGetRenderingPositions=function(){return(i._blobGetRenderingPositions=i.asm.y).apply(null,arguments)},i._blobGetRenderingNormals=function(){return(i._blobGetRenderingNormals=i.asm.z).apply(null,arguments)},i._blobGetRenderingUVs=function(){return(i._blobGetRenderingUVs=i.asm.A).apply(null,arguments)},i._blobGetRenderingSpeeds=function(){return(i._blobGetRenderingSpeeds=i.asm.B).apply(null,arguments)},i._blobGetRenderingIndices=function(){return(i._blobGetRenderingIndices=i.asm.C).apply(null,arguments)},i._blobGetRenderingIndexCount=function(){return(i._blobGetRenderingIndexCount=i.asm.D).apply(null,arguments)},i._blobGetMouthTriangleIndexCount=function(){return(i._blobGetMouthTriangleIndexCount=i.asm.E).apply(null,arguments)},i._blobGetMouthTriangleIndices=function(){return(i._blobGetMouthTriangleIndices=i.asm.F).apply(null,arguments)},i._blobGetMouthPositionCount=function(){return(i._blobGetMouthPositionCount=i.asm.G).apply(null,arguments)},i._blobGetMouthPositions=function(){return(i._blobGetMouthPositions=i.asm.H).apply(null,arguments)},i._blobRayIntersect=function(){return(i._blobRayIntersect=i.asm.I).apply(null,arguments)},i._blobSetDamping=function(){return(i._blobSetDamping=i.asm.J).apply(null,arguments)},i._blobSetMouthDamping=function(){return(i._blobSetMouthDamping=i.asm.K).apply(null,arguments)},i._blobSetMouthScale=function(){return(i._blobSetMouthScale=i.asm.L).apply(null,arguments)},i._blobSetMouthBend=function(){return(i._blobSetMouthBend=i.asm.M).apply(null,arguments)},i._blobSetMouthRotation=function(){return(i._blobSetMouthRotation=i.asm.N).apply(null,arguments)},i._blobSetMouthNoiseScale=function(){return(i._blobSetMouthNoiseScale=i.asm.O).apply(null,arguments)},i._blobSetMouthNoiseOffset=function(){return(i._blobSetMouthNoiseOffset=i.asm.P).apply(null,arguments)},i._blobSetMouthNoiseFrequency=function(){return(i._blobSetMouthNoiseFrequency=i.asm.Q).apply(null,arguments)},i._blobSetIsDragging=function(){return(i._blobSetIsDragging=i.asm.R).apply(null,arguments)},i._blobSetNoiseParameters=function(){return(i._blobSetNoiseParameters=i.asm.S).apply(null,arguments)},i._blobSetBreathVolumeScale=function(){return(i._blobSetBreathVolumeScale=i.asm.T).apply(null,arguments)},i._blobGetIntersectedRestPosition=function(){return(i._blobGetIntersectedRestPosition=i.asm.U).apply(null,arguments)},i._blobGetEye=function(){return(i._blobGetEye=i.asm.V).apply(null,arguments)},i._blobGetBrimPositions=function(){return(i._blobGetBrimPositions=i.asm.W).apply(null,arguments)},i._blobGetTongue=function(){return(i._blobGetTongue=i.asm.X).apply(null,arguments)},i._blobGetMouthProfilePositions=function(){return(i._blobGetMouthProfilePositions=i.asm.Y).apply(null,arguments)},i._blobGetMouthProfileNormals=function(){return(i._blobGetMouthProfileNormals=i.asm.Z).apply(null,arguments)},i._blobGetMouthProfileUVs=function(){return(i._blobGetMouthProfileUVs=i.asm._).apply(null,arguments)},i._blobGetMouthProfileIndices=function(){return(i._blobGetMouthProfileIndices=i.asm.$).apply(null,arguments)},i._blobGetMouthProfileIndexCount=function(){return(i._blobGetMouthProfileIndexCount=i.asm.aa).apply(null,arguments)},i._blobGetMouthProfileVertexCount=function(){return(i._blobGetMouthProfileVertexCount=i.asm.ba).apply(null,arguments)},i._tongueGetPointCount=function(){return(i._tongueGetPointCount=i.asm.ca).apply(null,arguments)},i._tongueGetPositions=function(){return(i._tongueGetPositions=i.asm.da).apply(null,arguments)},i._tongueGetTangents=function(){return(i._tongueGetTangents=i.asm.ea).apply(null,arguments)},i._tongueGetNormals=function(){return(i._tongueGetNormals=i.asm.fa).apply(null,arguments)},i._tongueSetWindForce=function(){return(i._tongueSetWindForce=i.asm.ga).apply(null,arguments)},i._tongueSetOscillationScale=function(){return(i._tongueSetOscillationScale=i.asm.ha).apply(null,arguments)},i._eyeGetVertexCount=function(){return(i._eyeGetVertexCount=i.asm.ia).apply(null,arguments)},i._eyeGetPositions=function(){return(i._eyeGetPositions=i.asm.ja).apply(null,arguments)},i._eyeGetRestPositions=function(){return(i._eyeGetRestPositions=i.asm.ka).apply(null,arguments)},i._eyeGetNormals=function(){return(i._eyeGetNormals=i.asm.la).apply(null,arguments)},i._eyeGetCenterPosition=function(){return(i._eyeGetCenterPosition=i.asm.ma).apply(null,arguments)},i._eyeGetAttachPosition=function(){return(i._eyeGetAttachPosition=i.asm.na).apply(null,arguments)},i._eyeGetIndices=function(){return(i._eyeGetIndices=i.asm.oa).apply(null,arguments)},i._eyeGetIndexCount=function(){return(i._eyeGetIndexCount=i.asm.pa).apply(null,arguments)},i._blobGetHat=function(){return(i._blobGetHat=i.asm.qa).apply(null,arguments)},i._hatGetPointCount=function(){return(i._hatGetPointCount=i.asm.ra).apply(null,arguments)},i._hatGetPositions=function(){return(i._hatGetPositions=i.asm.sa).apply(null,arguments)},i._hatGetTangents=function(){return(i._hatGetTangents=i.asm.ta).apply(null,arguments)},i._hatGetNormals=function(){return(i._hatGetNormals=i.asm.ua).apply(null,arguments)},i._malloc=function(){return(J=i._malloc=i.asm.va).apply(null,arguments)}),K=i.stackSave=function(){return(K=i.stackSave=i.asm.xa).apply(null,arguments)},Q=i.stackRestore=function(){return(Q=i.stackRestore=i.asm.ya).apply(null,arguments)},$=i.stackAlloc=function(){return($=i.stackAlloc=i.asm.za).apply(null,arguments)};function tt(t){function n(){W||(W=!0,i.calledRun=!0,d||(N(T),N(E),e(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)t=i.postRun.shift(),R.unshift(t);var t;N(R)}()))}t=t||s,M>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)t=i.preRun.shift(),A.unshift(t);var t;N(A)}(),M>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),n()}),1)):n()))}if(i.ccall=m,i.cwrap=function(t,e,n,i){var o=(n=n||[]).every((function(t){return"number"===t}));return"string"!==e&&o&&!i?p(t):function(){return m(t,e,n,arguments)}},k=function t(){W||tt(),W||(k=t)},i.run=tt,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return tt(),t.ready}),Yt=n(18),Wt=n(7),qt=function(){var t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return function(e){var n,i,o=void 0!==(e=e||{})?e:{};o.ready=new Promise((function(t,e){n=t,i=e}));var r,a={};for(r in o)o.hasOwnProperty(r)&&(a[r]=o[r]);var s,l=[],u="";"undefined"!=typeof document&&document.currentScript&&(u=document.currentScript.src),t&&(u=t),u=0!==u.indexOf("blob:")?u.substr(0,u.lastIndexOf("/")+1):"";o.print||console.log.bind(console);var c,h,f=o.printErr||console.warn.bind(console);for(r in a)a.hasOwnProperty(r)&&(o[r]=a[r]);a=null,o.arguments&&(l=o.arguments),o.thisProgram&&o.thisProgram,o.quit&&o.quit,o.wasmBinary&&(c=o.wasmBinary),o.noExitRuntime&&o.noExitRuntime,"object"!=typeof WebAssembly&&F("no native wasm support detected");var d=!1;function p(t){var e,n=o["_"+t];return e="Cannot call unknown function "+t+", make sure it is exported",n||F("Assertion failed: "+e),n}function m(t,e,n,i,o){var r={string:function(t){var e=0;if(null!=t&&0!==t){var n=1+(t.length<<2);(function(t,e,n){(function(t,e,n,i){if(!(i>0))return 0;for(var o=n,r=n+i-1,a=0;a<t.length;++a){var s=t.charCodeAt(a);if(s>=55296&&s<=57343){var l=t.charCodeAt(++a);s=65536+((1023&s)<<10)|1023&l}if(s<=127){if(n>=r)break;e[n++]=s}else if(s<=2047){if(n+1>=r)break;e[n++]=192|s>>6,e[n++]=128|63&s}else if(s<=65535){if(n+2>=r)break;e[n++]=224|s>>12,e[n++]=128|s>>6&63,e[n++]=128|63&s}else{if(n+3>=r)break;e[n++]=240|s>>18,e[n++]=128|s>>12&63,e[n++]=128|s>>6&63,e[n++]=128|63&s}}e[n]=0})(t,v,e,n)})(t,e=J(n),n)}return e},array:function(t){var e=J(t.length);return function(t,e){b.set(t,e)}(t,e),e}};var a=p(t),s=[],l=0;if(i)for(var u=0;u<i.length;u++){var c=r[n[u]];c?(0===l&&(l=X()),s[u]=c(i[u])):s[u]=i[u]}var h=a.apply(null,s);return h=function(t){return"string"===e?(n=t)?function(t,e,n){for(var i=e+n,o=e;t[o]&&!(o>=i);)++o;if(o-e>16&&t.subarray&&_)return _.decode(t.subarray(e,o));for(var r="";e<o;){var a=t[e++];if(128&a){var s=63&t[e++];if(192!=(224&a)){var l=63&t[e++];if((a=224==(240&a)?(15&a)<<12|s<<6|l:(7&a)<<18|s<<12|l<<6|63&t[e++])<65536)r+=String.fromCharCode(a);else{var u=a-65536;r+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else r+=String.fromCharCode((31&a)<<6|s)}else r+=String.fromCharCode(a)}return r}(v,n,i):"":"boolean"===e?Boolean(t):t;var n,i}(h),0!==l&&Z(l),h}var g,b,v,y,_="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function x(t){g=t,o.HEAP8=b=new Int8Array(t),o.HEAP16=new Int16Array(t),o.HEAP32=y=new Int32Array(t),o.HEAPU8=v=new Uint8Array(t),o.HEAPU16=new Uint16Array(t),o.HEAPU32=new Uint32Array(t),o.HEAPF32=new Float32Array(t),o.HEAPF64=new Float64Array(t)}o.INITIAL_MEMORY;var w,P=[],S=[],A=[],T=[];S.push({func:function(){W()}});var E=0,R=null,M=null;function F(t){o.onAbort&&o.onAbort(t),f(t+=""),d=!0,1,t="abort("+t+"). Build with -s ASSERTIONS=1 for more info.";var e=new WebAssembly.RuntimeError(t);throw i(e),e}o.preloadedImages={},o.preloadedAudios={};function k(t){return e=t,n="data:application/octet-stream;base64,",String.prototype.startsWith?e.startsWith(n):0===e.indexOf(n);var e,n}var I,C="synthmodule.wasm";function B(t){try{if(t==C&&c)return new Uint8Array(c);if(s)return s(t);throw"both async and sync fetching of the wasm failed"}catch(t){F(t)}}function D(t){for(;t.length>0;){var e=t.shift();if("function"!=typeof e){var n=e.func;"number"==typeof n?void 0===e.arg?w.get(n)():w.get(n)(e.arg):n(void 0===e.arg?null:e.arg)}else e(o)}}k(C)||(I=C,C=o.locateFile?o.locateFile(I,u):u+I);var L=0,N=4,O=8,j=12,U=13,z=16;function G(t){this.excPtr=t,this.ptr=t-z,this.set_type=function(t){y[this.ptr+O>>2]=t},this.get_type=function(){return y[this.ptr+O>>2]},this.set_destructor=function(t){y[this.ptr+L>>2]=t},this.get_destructor=function(){return y[this.ptr+L>>2]},this.set_refcount=function(t){y[this.ptr+N>>2]=t},this.set_caught=function(t){t=t?1:0,b[this.ptr+j>>0]=t},this.get_caught=function(){return 0!=b[this.ptr+j>>0]},this.set_rethrown=function(t){t=t?1:0,b[this.ptr+U>>0]=t},this.get_rethrown=function(){return 0!=b[this.ptr+U>>0]},this.init=function(t,e){this.set_type(t),this.set_destructor(e),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var t=y[this.ptr+N>>2];y[this.ptr+N>>2]=t+1},this.release_ref=function(){var t=y[this.ptr+N>>2];return y[this.ptr+N>>2]=t-1,1===t}}function V(t){try{return h.grow(t-g.byteLength+65535>>>16),x(h.buffer),1}catch(t){}}var H,Y={e:function(t){return q(t+z)+z},d:function(t,e,n){throw new G(t).init(e,n),t,t},a:function(){F()},b:function(t,e,n){v.copyWithin(t,e,e+n)},c:function(t){t>>>=0;var e=v.length;if(t>2147483648)return!1;for(var n,i,o=1;o<=4;o*=2){var r=e*(1+.2/o);if(r=Math.min(r,t+100663296),V(Math.min(2147483648,((n=Math.max(16777216,t,r))%(i=65536)>0&&(n+=i-n%i),n))))return!0}return!1}},W=(function(){var t={a:Y};function e(t,e){var n=t.exports;o.asm=n,x((h=o.asm.f).buffer),w=o.asm.F,function(t){if(E--,o.monitorRunDependencies&&o.monitorRunDependencies(E),0==E&&(null!==R&&(clearInterval(R),R=null),M)){var e=M;M=null,e()}}()}function n(t){e(t.instance)}function r(e){return(c||"function"!=typeof fetch?Promise.resolve().then((function(){return B(C)})):fetch(C,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+C+"'";return t.arrayBuffer()})).catch((function(){return B(C)}))).then((function(e){return WebAssembly.instantiate(e,t)})).then(e,(function(t){f("failed to asynchronously prepare wasm: "+t),F(t)}))}if(E++,o.monitorRunDependencies&&o.monitorRunDependencies(E),o.instantiateWasm)try{return o.instantiateWasm(t,e)}catch(t){return f("Module.instantiateWasm callback failed with error: "+t),!1}(c||"function"!=typeof WebAssembly.instantiateStreaming||k(C)||"function"!=typeof fetch?r(n):fetch(C,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,t).then(n,(function(t){return f("wasm streaming compile failed: "+t),f("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(i)}(),o.___wasm_call_ctors=function(){return(W=o.___wasm_call_ctors=o.asm.g).apply(null,arguments)}),q=(o._createSynth=function(){return(o._createSynth=o.asm.h).apply(null,arguments)},o._synthGetBuffer=function(){return(o._synthGetBuffer=o.asm.i).apply(null,arguments)},o._synthStep=function(){return(o._synthStep=o.asm.j).apply(null,arguments)},o._synthHasEnoughExcitationFrames=function(){return(o._synthHasEnoughExcitationFrames=o.asm.k).apply(null,arguments)},o._synthHasEnoughSpectralFrames=function(){return(o._synthHasEnoughSpectralFrames=o.asm.l).apply(null,arguments)},o._synthSetOnlyNoise=function(){return(o._synthSetOnlyNoise=o.asm.m).apply(null,arguments)},o._synthGetVoice=function(){return(o._synthGetVoice=o.asm.n).apply(null,arguments)},o._voiceAddSpectralFrame=function(){return(o._voiceAddSpectralFrame=o.asm.o).apply(null,arguments)},o._voiceAddExcitationFrame=function(){return(o._voiceAddExcitationFrame=o.asm.p).apply(null,arguments)},o._voiceSetGain=function(){return(o._voiceSetGain=o.asm.q).apply(null,arguments)},o._createSpectralFrame=function(){return(o._createSpectralFrame=o.asm.r).apply(null,arguments)},o._spectralFrameReset=function(){return(o._spectralFrameReset=o.asm.s).apply(null,arguments)},o._spectralFrameGetSpectrogram=function(){return(o._spectralFrameGetSpectrogram=o.asm.t).apply(null,arguments)},o._createExcitationFrame=function(){return(o._createExcitationFrame=o.asm.u).apply(null,arguments)},o._excitationFrameReset=function(){return(o._excitationFrameReset=o.asm.v).apply(null,arguments)},o._excitationFrameGetAperiodic=function(){return(o._excitationFrameGetAperiodic=o.asm.w).apply(null,arguments)},o._excitationFrameGetPeriodic=function(){return(o._excitationFrameGetPeriodic=o.asm.x).apply(null,arguments)},o._clearBuffer=function(){return(o._clearBuffer=o.asm.y).apply(null,arguments)},o._copyBuffer=function(){return(o._copyBuffer=o.asm.z).apply(null,arguments)},o._createReverbContext=function(){return(o._createReverbContext=o.asm.A).apply(null,arguments)},o._createDCReverbContext=function(){return(o._createDCReverbContext=o.asm.B).apply(null,arguments)},o._reverbContextProcess=function(){return(o._reverbContextProcess=o.asm.C).apply(null,arguments)},o._heavySendMessage=function(){return(o._heavySendMessage=o.asm.D).apply(null,arguments)},o._synthBenchmarkSpectrumGeneration=function(){return(o._synthBenchmarkSpectrumGeneration=o.asm.E).apply(null,arguments)},o._malloc=function(){return(q=o._malloc=o.asm.G).apply(null,arguments)}),X=o.stackSave=function(){return(X=o.stackSave=o.asm.H).apply(null,arguments)},Z=o.stackRestore=function(){return(Z=o.stackRestore=o.asm.I).apply(null,arguments)},J=o.stackAlloc=function(){return(J=o.stackAlloc=o.asm.J).apply(null,arguments)};function K(t){function e(){H||(H=!0,o.calledRun=!0,d||(!0,D(S),D(A),n(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),function(){if(o.postRun)for("function"==typeof o.postRun&&(o.postRun=[o.postRun]);o.postRun.length;)t=o.postRun.shift(),T.unshift(t);var t;D(T)}()))}t=t||l,E>0||(!function(){if(o.preRun)for("function"==typeof o.preRun&&(o.preRun=[o.preRun]);o.preRun.length;)t=o.preRun.shift(),P.unshift(t);var t;D(P)}(),E>0||(o.setStatus?(o.setStatus("Running..."),setTimeout((function(){setTimeout((function(){o.setStatus("")}),1),e()}),1)):e()))}if(o.ccall=m,o.cwrap=function(t,e,n,i){var o=(n=n||[]).every((function(t){return"number"===t}));return"string"!==e&&o&&!i?p(t):function(){return m(t,e,n,arguments)}},M=function t(){H||K(),H||(M=t)},o.run=K,o.preInit)for("function"==typeof o.preInit&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return!0,K(),e.ready}}(),Xt=n(6);function Zt(){return null!==(null!==navigator.userAgent.match(/Android/i)||null!==navigator.userAgent.match(/webOS/i)||null!==navigator.userAgent.match(/iPhone/i)||null!==navigator.userAgent.match(/iPad/i)||null!==navigator.userAgent.match(/iPod/i)||null!==navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}function Jt(){return null!==navigator.userAgent.match(/Android/i)}function Kt(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var Qt=n(13);var $t=function(){function t(t){this.sampleCount=t,this.samples=[]}return t.prototype.add=function(t){this.samples.length===this.sampleCount&&this.samples.splice(0,1),this.samples.push(t)},t.prototype.get=function(){if(0===this.samples.length)return 0;for(var t=0,e=0;e<this.samples.length;++e)t+=this.samples[e];return t/this.samples.length},t.prototype.enoughSamples=function(){return this.samples.length===this.sampleCount},t}(),te=function(){function t(t,e,n,i,o,r,a,s,l,u){var c=this;this.timingEnabled=!0,this.onFrameUsed=null,this.audioContext=e,this.scriptNode=this.audioContext.createScriptProcessor(u,0,2),this.audioParameters=l,this.synth=new Yt.a(t,n,i,o,r,a,s,l,u),this.synth.onFrameUsed=function(t){c.onFrameUsed&&c.onFrameUsed(t)};var h=Math.floor(5*e.sampleRate/u);this.runningAverage=new $t(h),this.bufferSize=l.scriptProcessorBufferSize}return t.prototype.start=function(){var t=this,e=1e3*this.bufferSize/this.synth.sampleRate;this.scriptNode.onaudioprocess=function(n){var i=[n.outputBuffer.getChannelData(0),n.outputBuffer.getChannelData(1)],o=performance.now();t.synth.process(i,t.scriptNode.bufferSize);var r=performance.now()-o;t.timingEnabled&&t.runningAverage.add(e/Math.max(1,r))},this.scriptNode.connect(this.audioContext.destination)},t.prototype.setTimingEnabled=function(t){this.timingEnabled=t},t.prototype.getAverageTime=function(){return this.runningAverage.get()},t.prototype.getEnoughSamples=function(){return this.runningAverage.enoughSamples()},t.prototype.setPans=function(t){this.synth.setPans(t)},t.prototype.addSpectralFrame=function(t,e){this.synth.addSpectralFrame(t,e)},t.prototype.addExcitationFrame=function(t,e){this.synth.addExcitationFrame(t,e)},t.prototype.setOverrideFrequency=function(t,e){this.synth.setOverrideFrequency(t,e)},t.prototype.addOverrideF0=function(t,e){this.synth.addOverrideF0(t,e)},t.prototype.setAudioParameters=function(t){this.synth.setAudioParameters(t)},t}();var ee=[32e3,24e3,22050];function ne(t,e,i,o,r){var a=null;a=0!==o?new(window.AudioContext||window.webkitAudioContext)({sampleRate:o}):new(window.AudioContext||window.webkitAudioContext);for(var s=1;Math.floor(a.sampleRate/s)>r;)s*=2;for(var l=a.sampleRate/s,u=0,c=0;c<ee.length&&!((u=ee[c])<=l);++c);var h=Object(Xt.a)("seeds"+u.toFixed(0)+".flat"),f=null;return f=!function(t){return t.audioWorklet&&t.audioWorklet instanceof AudioWorklet&&"function"==typeof t.audioWorklet.addModule&&window.AudioWorkletNode}(a)||!navigator.userAgent.includes("Chrome/89")&&!navigator.userAgent.includes("Chrome/90")||Kt()?function(t,e,n,i,o,r,a){var s=Object(Qt.a)();return Promise.all([qt({locateFile:function(t,e){return s?Object(Xt.a)(t.replace(".wasm","-simd.wasm")):Object(Xt.a)(t)}}),Object(Wt.a)(n),Object(Wt.a)(i)]).then((function(n){return new te(t,e,n[0],new Uint8Array(n[1]),new Uint8Array(n[2]),e.sampleRate,r,a,o,o.scriptProcessorBufferSize)}))}(t,a,h,e,i,l,u):n.e(4).then(n.bind(null,47)).then((function(n){return n.createAudioWorkletSynthRunner(t,a,h,e,i,l,u)})),Promise.all([f,ie(a,"applause","/blob-opera/applause.mp3")]).then((function(t){var e=t[1];return new ae(a,t[0],new oe(a,{applause:e}),l)}))}function ie(t,e,n){return fetch(n).then((function(t){return t.arrayBuffer()})).then((function(n){return new Promise((function(i,o){t.decodeAudioData(n,(function(t){i({name:e,audioBuffer:t})}),(function(t){i(null)}))}))}))}var oe=function(){function t(t,e){this.samples={},this.audioContext=t,this.samples=e}return t.prototype.play=function(t){var e=this.samples[t];if(e){var n=this.audioContext.createBufferSource();n.buffer=e.audioBuffer,n.loop=!1;var i=this.audioContext.createGain();i.gain.value=.2,n.connect(i),i.connect(this.audioContext.destination),n.start(0)}},t}();function re(t,e){var n;for(n=e;t>1;t--)n+=e;return n}var ae=function(){function t(t,e,n,i){this.hasPlayedTrack=!1,this.audioContext=t,this.synthRunner=e,this.sampleRate=t.sampleRate,this.samplePlayer=n,this.processingSampleRate=i,this.audioContext.resume()}return t.prototype.start=function(){this.audioContext.resume(),this.synthRunner.start();var t=this.audioContext,e=t.createBuffer(1,1,t.sampleRate),n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start(0)},t.prototype.tryUnlock=function(){if(Kt()&&!this.hasPlayedTrack){var t=document.createElement("div");t.innerHTML="<audio x-webkit-airplay='deny'></audio>",this.tag=t.children.item(0),this.tag.controls=!1,this.tag.disableRemotePlayback=!0,this.tag.preload="auto",this.tag.src="data:audio/mpeg;base64,//uQx"+re(23,"A")+"WGluZwAAAA8AAAACAAACcQCA"+re(16,"gICA")+re(66,"/")+"8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkI"+re(320,"A")+"//sQxAADgnABGiAAQBCqgCRMAAgEAH"+re(15,"/")+"7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq"+re(18,"/")+"9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAw"+re(97,"V")+"Q==",this.tag.loop=!0,this.tag.load();try{this.tag.play()}catch(t){}this.hasPlayedTrack=!0}this.audioContext.resume()},t.prototype.isMuted=function(){return"running"!==this.audioContext.state},t.prototype.suspend=function(){this.audioContext.suspend()},t.prototype.resume=function(){this.audioContext.resume()},t}();var se=function(){function t(t){var e=this;this.queuedPromises=[],this.worker=t,this.worker.onmessage=function(t){var n=t.data;"Notes"===n.type&&(e.queuedPromises[0](n.notes),e.queuedPromises.splice(0,1))}}return t.prototype.harmonize=function(t){var e=this;return new Promise((function(n,i){var o={note:t};e.queuedPromises.push(n),e.worker.postMessage(o)}))},t}();function le(t,e){for(var n=[],i=0;i<e;++i)n.push(new Worker(Object(Xt.a)("voicenetworker.js")));return Promise.all([Object(Wt.a)(Object(Xt.a)("spectral.flat")),Object(Wt.a)(Object(Xt.a)("aperiodic.flat"))]).then((function(i){var o=new Uint8Array(i[0]),r=new Uint8Array(i[1]),a={type:"Init",streamCount:Math.ceil(t/e),spectralParametersBuffer:o,aperiodicParametersBuffer:r};return Promise.all(n.map((function(t){return new Promise((function(e,n){t.onmessage=function(n){var i=n.data;i instanceof ArrayBuffer||"Loaded"!==i.type||e(t)},t.postMessage(a)}))})))})).then((function(n){return new ue(t,e,n)}))}var ue=function(){function t(t,e,n){var i=this;this.workers=[],this.listeners=[],this.framesBeingGenerated=0,this.workerCount=e,this.workers=n;for(var o=0;o<t;++o)this.listeners.push([]);for(var r=function(t){a.workers[t].onmessage=function(e){var n=e.data;if("Frames"===n.type){i.framesBeingGenerated-=n.excitationFrames.length,i.framesBeingGenerated<0&&(i.framesBeingGenerated=0);for(var o=new ot.a(n.spectralFrame),r=o.getId(),a=t+r*i.workerCount,s=n.excitationFrames.map((function(t){return new rt.a(t)})),l=0,u=i.listeners[a];l<u.length;l++){(0,u[l])(o,s)}}}},a=this,s=0;s<this.workers.length;++s)r(s)}return t.prototype.generate=function(t,e,n){this.framesBeingGenerated+=n.length;var i=t%this.workerCount,o=Math.floor(t/this.workerCount);e.setId(o);for(var r=0,a=n;r<a.length;r++){a[r].setId(o)}var s={type:"Generate",spectralFrame:e.buffer,excitationFrames:n.map((function(t){return t.buffer}))},l=[e.buffer].concat(s.excitationFrames);this.workers[i].postMessage(s,l)},t.prototype.addListener=function(t,e){this.listeners[t].push(e)},t.prototype.setParameters=function(t){for(var e=0,n=this.workers;e<n.length;e++){var i={type:"Parameters",parameters:t};n[e].postMessage(i)}},t}(),ce=n(36);for(var he=function(){function t(){}return t.prototype.loadRecording=function(e){return function(t){return t.length&&!t.match(/[.$\[\]#\/]/)}(e)?fetch(t.ROUTE+"/"+e).then((function(t){if(!t.ok)throw Error(t.statusText);return t.json()})).then((function(t){return fetch(t.url)})).then((function(t){return t.arrayBuffer()})).then((function(t){return ce.RecordingMessage.decode(new Uint8Array(t))})):Promise.reject("Invalid recording ID")},t.prototype.saveRecording=function(e){var n=ce.RecordingMessage.encode(e).finish();return fetch(t.ROUTE,{method:"PUT",body:n}).then((function(t){if(!t.ok)throw Error(t.statusText);return t.json()})).then((function(t){return{id:t.id}}))},t.ROUTE="https://cilex-aeiopera.uc.r.appspot.com/recording",t}(),fe=(function(){function t(){}t.prototype.loadRecording=function(t){return new Promise((function(t,e){}))},t.prototype.saveRecording=function(t){return new Promise((function(t,e){window.setTimeout((function(){t({id:"temp"})}),1e3)}))}}(),n(38)),de={},pe=n.n(fe).a,me=pe[0].slice(1),ge=0,be=me;ge<be.length;ge++){var ve=be[ge];de[ve]={}}for(var ye=1;ye<pe.length;++ye)for(var _e=pe[ye],xe=_e[0],we=0;we<me.length;++we)de[me[we]][xe]=_e[1+we];function Pe(t,e){return Promise.all([Object(Wt.b)(Object(Xt.a)(e.albedoTexturePath)),Object(Wt.b)(Object(Xt.a)(e.materialTexturePath))]).then((function(n){return{color:new Float32Array(Object(f.h)(e.color)),albedoTexture:s(t,0,n[0],t.REPEAT,t.REPEAT,t.LINEAR_MIPMAP_LINEAR,t.LINEAR,!0),materialMap:s(t,0,n[1],t.REPEAT,t.REPEAT,t.LINEAR_MIPMAP_LINEAR,t.LINEAR,!0),blendSubsurface:!!e.blendSubsurface&&e.blendSubsurface,normalScale:void 0!==e.normalScale?e.normalScale:1,hueShift:void 0!==e.hueShift?e.hueShift:0,saturationBoost:void 0!==e.saturationBoost?e.saturationBoost:0,lightnessBoost:void 0!==e.lightnessBoost?e.lightnessBoost:0}}))}function Se(t,e){return Promise.all([Promise.all(e.blobs.map((function(e){return function(t,e){var n=e.modelPath.includes("json");return Promise.all([Object(Wt.a)(Object(Xt.a)(e.modelPath)),Pe(t,e.body)]).then((function(t){return{meshBuffer:new Uint8Array(t[0]),isJSONMesh:n,bodyMaterial:t[1],mouthColor:new Float32Array((i=Object(f.h)(e.mouth.color),h.a.pow([],i,2.2))),lidColor:new Float32Array(Ae(e.eye.lidColor,t[1].hueShift))};var i}))}(t,e)}))),Object(Wt.b)(Object(Xt.a)(e.backgroundImagePath)),Object(Wt.b)(Object(Xt.a)(e.floorImagePath))]).then((function(t){return{blobAssets:t[0],environmentAssets:{backgroundImage:t[1],floorImage:t[2]}}}))}function Ae(t,e){var n=Object(f.h)(t);return(n=Object(f.p)(n))[0]+=e,Object(f.i)(n)}function Te(t,e){for(var n=t.toFixed(0).slice(0,e);n.length<e;)n="0"+n;return n}function Ee(t){var e=Math.floor(t/60),n=Math.floor(t%60),i=Math.floor(t%1*100);return Te(e,2)+":"+Te(n,2)+"."+Te(i,2)}var Re=[{recordingID:"jinglebells",nameStringID:"song_jingle_bells"},{recordingID:"silentnight",nameStringID:"song_silent_night"},{recordingID:"joytotheworld",nameStringID:"song_joy_to_the_world"},{recordingID:"harktheheraldangelssing",nameStringID:"song_hark_the_herald_angels_sing"},{recordingID:"awayinamanger",nameStringID:"song_away_in_a_manger"},{recordingID:"ocomeallyefaithful",nameStringID:"song_o_come_all_ye_faithful"},{recordingID:"thefirstnoel",nameStringID:"song_the_first_noel"},{recordingID:"onceinroyaldavidscity",nameStringID:"song_once_in_royal_davids_city"}];function Me(t){t.predicate()?t.hasClass||(t.element.classList.add(t.className),t.hasClass=!0):t.hasClass&&(t.element.classList.remove(t.className),t.hasClass=!1)}var Fe,ke=function(){function t(){this.elements=[]}return t.prototype.add=function(t,e,n){for(var i=document.querySelectorAll(t),o=0;o<i.length;++o)this.elements.push({predicate:n,element:i[o],className:e,hasClass:i[0].classList.contains(e)});return this},t.prototype.update=function(){for(var t=0,e=this.elements;t<e.length;t++){Me(e[t])}},t}();function Ie(t){return t===Mt.Main?"single":t===Mt.Playing?"autoplay":void 0}function Ce(t,e,n,i){var o=document.createElement("li");return o.innerHTML='\n<div class="list-item-icon">\n    <div class="spinner"></div>\n    <span class="material-icons md-18">'+t+'</span>\n</div>\n<span class="song-name">'+e+'</span>\n<span class="song-description'+(""==n?" hidden":"")+'">'+n+"</span>\n",o.addEventListener("click",i),o}!function(t){t[t.UGC=0]="UGC",t[t.Location=1]="Location",t[t.Festive=2]="Festive"}(Fe||(Fe={}));var Be=function(){function t(t,e,n,i,o){var r=this;this.controlledElements=new ke,this.saveState={kind:"None"},this.locationState={kind:"None"},this.showingInfo=!1,this.showingLocationPlaylist=!1,this.showingLocationSelector=!1,this.hasStoppedRecording=!1,this.hasShownLocationPlaylist=!1,this.hasShownLocationSelector=!1,this.hasShared=!1,this.hasSharedCarol=!1,this.hasToggledFestive=!1,this.hasShownPerformanceWarning=!1,this.showingPerformanceWarning=!1,this.config=t,this.opera=e,this.opera.addStateChangeListener(this.onStateChange.bind(this)),this.environment=n,this.environment.onLocationChange=this.onLocationChange.bind(this),this.language=o,this.backend=new he,"Recording"===i.kind&&(this.saveState={kind:"Saved",savedRecordingID:i.recordingID,recordingType:this.getRecordingType(i.recordingID)});var a=document.getElementById("skip"),s=function(){r.opera.skipTutorial(),r.environment.track({action:"skip-tutorial"})};a.addEventListener("click",s),a.addEventListener("touchend",s),document.getElementById("record").addEventListener("click",(function(){if(r.opera.isRecording)r.endRecording();else{var t=st.BlobperaHouse;"Loaded"===r.locationState.kind&&(t="location_blobpera_house"===(e=r.locationState.locationStringID)?st.BlobperaHouse:"location_london"===e?st.London:"location_new_york"===e?st.NewYork:"location_paris"===e?st.Paris:"location_mexico_city"===e?st.MexicoCity:"location_seoul"===e?st.Seoul:"location_cape_town"===e?st.CapeTown:st.BlobperaHouse),r.opera.startNewRecording(t),r.environment.track({action:"tap-record"})}var e})),document.getElementById("stop-record").addEventListener("click",(function(){r.opera.isRecording&&r.endRecording()})),document.getElementById("save").addEventListener("click",this.saveRecording.bind(this)),document.getElementById("startstop").addEventListener("click",this.opera.togglePlayback.bind(this.opera)),document.getElementById("play").addEventListener("click",this.opera.enterMain.bind(this.opera)),document.getElementById("back").addEventListener("click",(function(){r.opera.enterMain(),r.updateMenus(),"Previewing"===r.saveState.kind&&r.environment.track({action:"tap-discard"}),r.environment.track({action:"tap-back",label:"Saved"===r.saveState.kind?r.saveState.savedRecordingID:""})})),document.getElementById("info").addEventListener("click",(function(){r.showingInfo=!r.showingInfo;Ie(r.opera.state);"Saved"===r.saveState.kind&&r.saveState.savedRecordingID,r.environment.track({action:"tap-question",label:Ie(r.opera.state)})})),document.getElementById("close-info").addEventListener("click",(function(){r.showingInfo=!1}));var l=function(t){t.stopPropagation(),t.preventDefault(),r.hasShownLocationPlaylist=!0,r.showingLocationSelector=!1,r.showingLocationPlaylist=!r.showingLocationPlaylist},u=function(t){t.stopPropagation(),t.preventDefault(),r.hasShownLocationSelector=!0,r.showingLocationPlaylist=!1,r.showingLocationSelector=!r.showingLocationSelector},c=function(t){t.stopPropagation(),t.preventDefault(),r.showingLocationPlaylist=!1,r.showingLocationSelector=!1};document.getElementById("location-playlist-button").addEventListener("click",l),document.getElementById("location-playlist-button").addEventListener("touchend",l),document.getElementById("location-selector-button").addEventListener("click",u),document.getElementById("location-selector-button").addEventListener("touchend",u),e.canvas.addEventListener("click",c),e.canvas.addEventListener("touchend",c),document.getElementById("performance-warning-dismiss").addEventListener("click",(function(t){r.showingPerformanceWarning=!1}));var h=function(){return e.state===Mt.Main&&"Pitch"===e.tutorialState.kind&&0===e.tutorialState.notesSung||r.opera.state===Mt.Playing&&!e.completedTutorial()},f=function(){return(e.state===Mt.Main&&e.completedTutorial()&&!e.isRecording||e.state===Mt.Playing&&e.completedTutorial())&&!r.opera.isDraggingBlob()&&!r.showingInfo};this.controlledElements.add("#skip","visible",(function(){return r.opera.state===Mt.Main&&!("Finished"===e.tutorialState.kind||"Pitch"===e.tutorialState.kind&&0===e.tutorialState.notesSung)&&!r.showingInfo})).add("#info","visible",(function(){return!h()&&!r.showingInfo})).add("#splash","visible",(function(){return h()&&!r.showingInfo})).add("#title-small","visible",(function(){return!h()&&!r.showingInfo})).add("#record-container","visible",(function(){return r.opera.state===Mt.Main&&e.completedTutorial()&&!e.isRecording&&!e.isDraggingBlob()&&!r.showingInfo})).add("#record-container","recording",(function(){return r.opera.isRecording})).add("#stop-recording-container","visible",(function(){return r.opera.state===Mt.Main&&r.opera.isRecording})).add("#save-container","visible",(function(){return e.state===Mt.Playing&&!r.showingInfo})).add("#save-container","saving",(function(){return"SaveRequested"===r.saveState.kind})).add("#discard-container","visible",(function(){return"Previewing"===r.saveState.kind&&!r.showingInfo})).add("#recording-copy-link-container","visible",(function(){return"Saved"===r.saveState.kind&&!r.showingInfo})).add("#startstop-container","visible",(function(){return e.state===Mt.Playing&&!r.showingInfo})).add("#startstop-container","playing",(function(){return e.playing})).add("#play","visible",(function(){return e.state===Mt.Playing&&!e.completedTutorial()&&!r.showingInfo})).add("#back-container","visible",(function(){return e.state===Mt.Playing&&e.completedTutorial()&&!r.showingInfo})).add("#muted-container","visible",(function(){return e.state===Mt.Playing&&e.audio.isMuted()&&!e.suspended})).add("#info-overlay","visible",(function(){return r.showingInfo})).add("#share-recording-prompt","visible",(function(){return e.state===Mt.Playing&&"Previewing"===r.saveState.kind&&!r.hasShared&&!r.showingInfo&&!e.isDraggingBlob()})).add("#location-selection-prompt","visible",(function(){return f()&&!r.hasShownLocationSelector&&!("Recording"===i.kind)})).add("#location-playlist-tray","visible",(function(){return f()&&"Loaded"===r.locationState.kind&&!r.isAtBlobperaHouse()})).add("#location-playlist-button","visible",(function(){return f()&&"Loaded"===r.locationState.kind&&!r.isAtBlobperaHouse()})).add("#location-playlist-button","depressed",(function(){return r.showingLocationPlaylist&&!r.showingInfo})).add("#location-selector-button","visible",(function(){return f()})).add("#location-selector-button","depressed",(function(){return r.showingLocationSelector&&!r.showingInfo})).add("#location-selector-container","visible",(function(){return r.showingLocationSelector&&!r.opera.isDraggingBlob()&&!r.showingInfo})).add("#location-songs-container","visible",(function(){return r.showingLocationPlaylist&&!r.opera.isDraggingBlob()&&!r.showingInfo&&"Loaded"===r.locationState.kind&&!r.isAtBlobperaHouse()})).add("#recording-indicator","visible",(function(){return e.isRecording&&!r.showingInfo})).add("#tutorial-prompt-pitch","visible",(function(){return e.state===Mt.Main&&"Pitch"===e.tutorialState.kind&&e.tutorialState.notesSung>0&&!r.showingInfo})).add("#tutorial-prompt-vowel","visible",(function(){return e.state===Mt.Main&&"Vowel"===e.tutorialState.kind&&e.tutorialState.notesSung>0&&!r.showingInfo})).add("#tutorial-prompt-harmonization","visible",(function(){return e.state===Mt.Main&&"Harmonization"===e.tutorialState.kind&&e.tutorialState.notesSung>0&&!r.showingInfo})).add("#tutorial-prompt-mute","visible",(function(){return e.state===Mt.Main&&"Mute"===e.tutorialState.kind&&e.tutorialState.notesSung>0&&!r.showingInfo})).add("#tutorial-prompt-end","visible",(function(){return e.state===Mt.Main&&"Finished"===e.tutorialState.kind&&!e.tutorialState.hasInteracted&&!r.showingInfo})).add("#recording-frame-bottom-left","visible",(function(){return e.state===Mt.Main&&"Finished"===e.tutorialState.kind&&e.isRecording})).add("#recording-frame-bottom-right","visible",(function(){return e.state===Mt.Main&&"Finished"===e.tutorialState.kind&&e.isRecording})).add("#recording-frame-top-left","visible",(function(){return e.state===Mt.Main&&"Finished"===e.tutorialState.kind&&e.isRecording})).add("#recording-frame-top-right","visible",(function(){return e.state===Mt.Main&&"Finished"===e.tutorialState.kind&&e.isRecording})).add("#performance-warning","visible",(function(){return r.showingPerformanceWarning})).add("#disclaimer","visible",(function(){return h()&&e.state===Mt.Main&&!r.showingInfo}));for(var d=document.getElementById("location-selector"),p=function(t){d.appendChild(Ce("place",de[o][t.locationStringID],"",(function(e){e.stopPropagation(),"None"!==r.locationState.kind&&t.locationStringID===r.locationState.locationStringID||(r.opera.enterMain(),r.updateLocationState({kind:"Loading",locationStringID:t.locationStringID}),r.showingLocationPlaylist=!0,Se(r.opera.getGl(),t).then((function(e){r.opera.setScene(t,e),r.updateLocationState({kind:"Loaded",locationStringID:t.locationStringID}),r.showingLocationSelector=!1})),r.environment.track({action:"tap-location"}))})))},m=0,g=t.scenes;m<g.length;m++){p(g[m])}var b,v=["soprano","mezzo-soprano","tenor","bass"];e.onBlobInteraction=function(t){r.environment.track({action:"blob-interaction",label:v[t]+"_"+Ie(r.opera.state)+("Saved"===r.saveState.kind?"_"+r.saveState.savedRecordingID:"")})},e.onTutorialFinished=function(){r.environment.track({action:"finished-tutorial"})},document.getElementById("credit").addEventListener("click",(function(t){r.environment.openURL("https://david.li")})),document.getElementById("info-link").addEventListener("click",(function(t){r.environment.openURL("https://artsandculture.google.com/project/performing-arts")})),this.updateLocationState({kind:"Loaded",locationStringID:"Recording"===i.kind?(b=i.recording.location,b===st.BlobperaHouse?"location_blobpera_house":"location_"+ht(b)):t.scenes[0].locationStringID}),this.onStateChange(this.opera.state);var y=function(t){r.update(t),requestAnimationFrame(y)};requestAnimationFrame(y)}return t.prototype.localiseString=function(t){return de[this.language][t]},t.prototype.findSong=function(t){for(var e=0,n=this.config.scenes;e<n.length;e++){var i=n[e];if(i.songs){var o=i.songs.find((function(e){return e.recordingID===t}));if(void 0!==o)return o}}return null},t.prototype.isLocationRecording=function(t){for(var e=0,n=this.config.scenes;e<n.length;e++){var i=n[e];if(i.songs&&void 0!==i.songs.find((function(e){return e.recordingID===t})))return!0}return!1},t.prototype.getRecordingType=function(t){return this.isLocationRecording(t)?Fe.Location:function(t){return void 0!==Re.find((function(e){return e.recordingID===t}))}(t)?Fe.Festive:Fe.UGC},t.prototype.onLocationChange=function(t){"Default"===t.kind?this.opera.enterMain():"Recording"===t.kind&&this.playRecording(t.recordingID)},t.prototype.onStateChange=function(t){t===Mt.Main&&(this.saveState={kind:"None"}),t===Mt.Main&&this.environment.changeLocation({kind:"Default"})},t.prototype.endRecording=function(){var t=this.opera.finishRecording();(function(t){for(var e=0,n=t.parts;e<n.length;e++){if(n[e].notes.length>0)return!1}return!0})(t)||(this.hasStoppedRecording=!0,t.theme=this.opera.theme,this.opera.enterPlaying(t),this.saveState={kind:"Previewing"})},t.prototype.getShareText=function(t){if("Saved"===t.kind&&t.recordingType===Fe.Location&&"Loaded"===this.locationState.kind){var e=this.localiseString("axl_share_recording_cc");return e=(e=e.replace("<song>",this.localiseString(this.findSong(t.savedRecordingID).nameStringID+"_name"))).replace("<city>",this.localiseString(this.locationState.locationStringID))}return"Loaded"===this.locationState.kind?this.localiseString("axl_share_recording_ugc").replace("<city>",this.localiseString(this.locationState.locationStringID)):""},t.prototype.saveRecording=function(){var t=this,e=this.getShareText(this.saveState);"Previewing"===this.saveState.kind?(this.saveState={kind:"SaveRequested"},this.opera.playingRecording.theme=this.opera.theme,this.hasShared=!0,this.backend.saveRecording(this.opera.playingRecording).then((function(n){t.saveState={kind:"Saved",savedRecordingID:n.id,recordingType:Fe.UGC},t.environment.changeLocation({kind:"Recording",recordingID:n.id}),t.environment.share({kind:"Recording",recordingID:t.saveState.savedRecordingID},e),t.environment.track({action:"tap-share",label:n.id})})).catch((function(e){console.log(e),t.saveState={kind:"Previewing"}}))):"Saved"===this.saveState.kind&&("Saved"===this.saveState.kind&&this.saveState.recordingType===Fe.Festive&&(this.hasSharedCarol=!0),this.environment.share({kind:"Recording",recordingID:this.saveState.savedRecordingID},e),this.environment.track({action:"tap-share",label:this.saveState.savedRecordingID}))},t.prototype.update=function(t){var e=this.opera;e.showingPrompts=!this.showingInfo,this.controlledElements.update();var n,i,o,r,a,s=document.getElementById("playback-timecode"),l=document.querySelector(".progress-ring"),u=document.querySelector(".progress-circle");if(e.state===Mt.Playing){var c=e.playing?Math.max(0,e.clock.getTimeMs()-e.playbackStartTime)/1e3:0;s.innerText=Ee(c);var h=Object(f.b)(c/function(t){for(var e=0,n=0,i=t.parts;n<i.length;n++){var o=i[n];o.notes.length>0&&(e=Math.max(e,o.notes[o.notes.length-1].timeSeconds))}return e}(e.playingRecording),0,1);l.setAttribute("d",(n=u.cx.baseVal.value,i=u.cy.baseVal.value,o=u.r.baseVal.value,r=h,a=-2*Math.PI*r-Math.PI/2,"M "+n+" "+(i-o)+" A "+o+" "+o+(r<.5?" 0 0 1 ":" 0 1 1 ")+(n+-Math.cos(a)*o)+" "+(i+Math.sin(a)*o)))}var d=document.getElementById("recording-timecode");if(this.opera.isRecording){c=Math.max(0,(e.clock.getTimeMs()-e.recordingStartTime)/1e3);d.innerText=Ee(c)}e.getAudioRTFEnoughSamples()&&e.getAudioRTF().toFixed(1);e.audio.processingSampleRate.toFixed(0),Zt()&&e.getAudioRTFEnoughSamples()&&"visible"===document.visibilityState&&!this.hasShownPerformanceWarning&&e.getAudioRTF()<3&&(e.onMouseUp(),this.hasShownPerformanceWarning=!0,this.showingPerformanceWarning=!0)},t.prototype.playPresetSong=function(t){this.playRecording(t),this.updateMenus()},t.prototype.playRecording=function(t){var e=this;if(this.opera.state!==Mt.Playing||"Saved"!==this.saveState.kind||this.saveState.savedRecordingID!==t){this.opera.stopPlayback();var n=Object.assign({},this.saveState);this.saveState={kind:"Loading",loadingRecordingID:t,recordingType:this.getRecordingType(t)},this.backend.loadRecording(t).then((function(n){e.opera.enterPlaying(n),e.saveState={kind:"Saved",savedRecordingID:t,recordingType:e.saveState.recordingType},e.showingLocationPlaylist=!1,e.updateMenus()})).catch((function(t){e.saveState=n,e.updateMenus()}))}},t.prototype.updateLocationState=function(t){this.locationState=t,this.updateMenus()},t.prototype.getSelectedScene=function(){if("None"===this.locationState.kind)return this.config.scenes[0];var t=this.locationState.locationStringID;return this.config.scenes.find((function(e){return e.locationStringID===t}))},t.prototype.isAtBlobperaHouse=function(){return this.getSelectedScene()===this.config.scenes[0]},t.prototype.updateMenus=function(){this.rebuildLocationPlaylistMenu(),this.updatePlaylistMenuLoadStates("location-songs",this.getSelectedScene().songs||[]),this.updateLocationMenuLoadStates()},t.prototype.rebuildLocationPlaylistMenu=function(){for(var t=document.getElementById("location-songs"),e=0,n=[].slice.apply(t.childNodes);e<n.length;e++){n[e].remove()}this.buildPlaylistMenu(t,this.getSelectedScene().songs||[])},t.prototype.buildPlaylistMenu=function(t,e){for(var n=this,i=function(e){var i=o.localiseString(e.nameStringID+"_name"),r=o.localiseString(e.nameStringID+"_description");t.appendChild(Ce("play_circle_outline",i,r,(function(t){t.stopPropagation(),n.playPresetSong(e.recordingID),n.environment.track({action:"tap-song",label:Ie(n.opera.state)+"_"+e.recordingID})})))},o=this,r=0,a=e;r<a.length;r++){i(a[r])}},t.prototype.updatePlaylistMenuLoadStates=function(t,e){for(var n=document.getElementById(t).querySelectorAll("li"),i=0;i<e.length;++i){var o=e[i];("Loading"===this.saveState.kind?this.saveState.loadingRecordingID===o.recordingID:this.opera.state===Mt.Playing&&"Saved"===this.saveState.kind&&this.saveState.savedRecordingID===o.recordingID)?(n[i].classList.add("playing"),n[i].querySelector(".material-icons").innerHTML="volume_up","Loading"===this.saveState.kind&&this.saveState.loadingRecordingID===o.recordingID?n[i].classList.add("loading"):n[i].classList.remove("loading")):(n[i].classList.remove("playing"),n[i].querySelector(".material-icons").innerHTML="play_circle_outline",n[i].classList.remove("loading"))}},t.prototype.updateLocationMenuLoadStates=function(){for(var t=document.getElementById("location-selector").querySelectorAll("li"),e=0;e<this.config.scenes.length;++e){var n=this.config.scenes[e];"Loading"===this.locationState.kind&&this.locationState.locationStringID===n.locationStringID?t[e].classList.add("loading"):t[e].classList.remove("loading"),"Loaded"===this.locationState.kind&&this.locationState.locationStringID===n.locationStringID?t[e].classList.add("loaded"):t[e].classList.remove("loaded")}var i=document.getElementById("location-label");"None"!==this.locationState.kind?(i.innerText=de[this.language][this.locationState.locationStringID],i.style.visibility="visible"):i.style.visibility="hidden"},t}(),De=n(39),Le=n.n(De),Ne=n(37),Oe={insert:"head",singleton:!1};Le()(Ne.a,Oe),Ne.a.locals;function je(t){var e=t.hash;return""===e?{kind:"Default"}:"#/r/"===e.substr(0,"#/r/".length)?{kind:"Recording",recordingID:t.hash.slice("#/r/".length)}:{kind:"Default"}}var Ue=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+window.location.pathname+(window.location.search?window.location.search:"");function ze(t){return"Default"===t.kind?"#/":"Recording"===t.kind?"#/r/"+t.recordingID:void 0}function Ge(t){navigator.clipboard?navigator.clipboard.writeText(t).then((function(){}),(function(t){})):function(t){var e=document.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")}catch(t){}document.body.removeChild(e)}(t)}var Ve=function(){function t(){this.onResume=null,this.onFreeze=null,this.onLocationChange=null,this.location=je(window.location),window.addEventListener("hashchange",this.onHashChange.bind(this))}return t.prototype.track=function(t){},t.prototype.onHashChange=function(t){this.location=je(window.location),this.onLocationChange&&this.onLocationChange(this.location)},t.prototype.changeLocation=function(t){this.location=t,window.location.hash=ze(t),this.onLocationChange&&this.onLocationChange(t)},t.prototype.share=function(t,e){Ge(function(t){return Ue+ze(t)}(t))},t.prototype.openURL=function(t){window.open(t,"_blank")},t}();function He(){return n.e(0).then(n.bind(null,48)).then((function(t){return new Promise((function(e,n){var i=t.default,o=new i,r=o.handshake().then((function(t){return function(t){return"r"in t?{kind:"Recording",recordingID:t.r}:"nye"in t?(alert("NYE"),{kind:"Recording",recordingID:"jinglebells"}):{kind:"Default"}}(t)})),a=new Promise((function(t,e){var n=!1;o.registerMessageCallback(i.HostToChild.RESUME,(function(){n||(t(),n=!0)}))})),s=function(){function t(t,e){var n=this;this.onLocationChange=null,this.onResume=null,this.onFreeze=null,this.axl=t,this.location=e,t.registerMessageCallback(i.HostToChild.RESUME,(function(){n.onResume&&n.onResume()})),t.registerMessageCallback(i.HostToChild.FREEZE,(function(){n.onFreeze&&n.onFreeze()}))}return t.prototype.track=function(t){o.sendMessage(i.ChildToHost.TRACK,t)},t.prototype.changeLocation=function(t){this.location=t,o.sendMessage(i.ChildToHost.SET_URL_PARAMS,function(t){return"Recording"===t.kind?{r:t.recordingID}:"Default"===t.kind?{}:void 0}(t))},t.prototype.share=function(t,e){this.changeLocation(t),"Recording"===t.kind&&o.sendMessage(i.ChildToHost.SHARE,{title:e})},t.prototype.openURL=function(t){o.sendMessage(i.ChildToHost.NAVIGATE,t)},t}();return Promise.all([r,a]).then((function(t){e(new s(o,t[0]))}))}))}))}function Ye(t){var e=t.match(/\*[^*]+?\*/);if(e)for(var n=0,i=e;n<i.length;n++){var o=i[n];t=t.replace(o,"<span>"+o.replace(/\*/g,"")+"</span>")}return e&&(t=Ye(t)),t}function We(t){var e=t.split("\n");if(e.length>1){for(var n="",i=0,o=e;i<o.length;i++){n+="<p>"+o[i]+"</p>"}return n}return t}function qe(t){var e=t.match(/David Li/);if(e)for(var n=0,i=e;n<i.length;n++){var o=i[n];t=t.replace(o,'<span id="credit">'+o.replace(/\*/g,"")+"</span>")}return e&&(t=Ye(t)),t}function Xe(t,e){var n=t.match(/\<performing_arts_link\>/);if(n)for(var i=0,o=n;i<o.length;i++){var r=o[i];t=t.replace(r,'<span id="info-link">'+e.info_performing_arts_link+"</span>")}return n&&(t=Ye(t)),t}function Ze(t,e){var n=t.match(/{{(\w+)}}/g);if(n)for(var i=0,o=n;i<o.length;i++){var r=o[i],a=e[r.replace("{{","").replace("}}","")];a=(a=Xe(a=qe(a=Ye(a=We(a))),e)).replace("-","&#8209;"),t=t.replace(r,a)}return t}var Je=n(10);var Ke={cameraFOVDegrees:22.5,positioningMode:"relative",scenes:[{locationStringID:"location_blobpera_house",name:"default",startCameraPosition:[2.3382685902179845,3.25,12.65],endCameraPosition:[0,4.25,19.5],blobs:[{position:[0,0,0],modelPath:"assets/004.flat",scale:1,parameters:{leftEyeScale:[.12,.14,.12],rightEyeScale:[.12,.14,.12],rightEyeX:-.2,rightEyeZ:.21,leftEyeX:.2,leftEyeZ:.21},stretch:1.25,rotationDegrees:45,singerIndex:0,subsurfaceColor:"#bbbbbb",mouthRotation:.2,inflation:1,lipScale:1.33,pitchScale:.5,width:1.8,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_004_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_004_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_004_001_Normals_Params.png",saturationBoost:.5,lightnessBoost:.5},mouth:{color:"#ffdf74"},eye:{pupilSize:.04,lidColor:"#f0bd05",lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,.2],modelPath:"assets/003.flat",scale:1,parameters:{leftEyeScale:[.1,.1,.1],rightEyeScale:[.1,.1,.1],rightEyeX:-.13,rightEyeZ:-.1,leftEyeX:.13,leftEyeZ:-.1,eyeAttachOffset:.05},stretch:.95,rotationDegrees:45,singerIndex:1,subsurfaceColor:"#bbbbbb",mouthRotation:0,inflation:1.2,lipScale:1.1,pitchScale:.5,width:1.3,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_003_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_003_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_003_001_Normals_Params.png",saturationBoost:.5,lightnessBoost:.5},mouth:{color:"#9abfe6"},eye:{lidColor:"#05b5f0",pupilSize:.034,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,0],modelPath:"assets/002.flat",scale:.85,parameters:{leftEyeScale:[.15,.17,.15],rightEyeScale:[.15,.17,.15],rightEyeX:-.184637,rightEyeZ:.234132,leftEyeX:.184637,leftEyeZ:.234132},stretch:1,rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:2,mouthRotation:0,inflation:1,lipScale:1.4,pitchScale:.5,width:1.7,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_002_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_002_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_002_001_Normals_Params.png",normalScale:1,saturationBoost:.5,lightnessBoost:.5},mouth:{color:"#86eddf"},eye:{lidColor:"#21cf98",pupilSize:.04,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,-.4],scale:1,parameters:{leftEyeScale:[.18,.18,.18],rightEyeScale:[.18,.18,.18],rightEyeX:.3,rightEyeZ:.3,leftEyeX:-.3,leftEyeZ:.3},stretch:1,modelPath:"assets/001.flat",rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:3,mouthRotation:.1,inflation:1,lipScale:1.3,pitchScale:.5,width:1.7,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_001_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_001_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_001_001_Normals_Params.png",normalScale:1,saturationBoost:.5,lightnessBoost:.5},mouth:{color:"#f09cf9"},eye:{lidColor:"#b31247",pupilSize:.04,lidRoughness:.25,lidF0:.05,topLidClamp:0}}],backgroundImagePath:"backgrounds/default.jpg",floorImagePath:"transparent.png"},{locationStringID:"location_london",name:"london",startCameraPosition:[2.3382685902179845,3.25,12.65],endCameraPosition:[0,4.25,19.5],blobs:[{position:[0,0,.2],modelPath:"assets/003.flat",scale:1,parameters:{leftEyeScale:[.08,.08,.08],rightEyeScale:[.08,.08,.08],rightEyeX:-.15,rightEyeZ:-.1,leftEyeX:.15,leftEyeZ:-.1,eyeAttachOffset:.05},stretch:1,rotationDegrees:45,singerIndex:0,subsurfaceColor:"#bbbbbb",mouthRotation:0,inflation:1,lipScale:1.1,pitchScale:.5,width:1.3,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_003_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_003_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_003_001_Normals_Params.png",hueShift:.75,saturationBoost:.1,lightnessBoost:.5},mouth:{color:"#6dfff3"},eye:{lidColor:"#05b5f0",pupilSize:.024,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,0],modelPath:"assets/004.flat",scale:1,parameters:{leftEyeScale:[.12,.14,.12],rightEyeScale:[.12,.14,.12],rightEyeX:-.2,rightEyeZ:.21,leftEyeX:.2,leftEyeZ:.21},stretch:1.25,rotationDegrees:45,singerIndex:1,subsurfaceColor:"#bbbbbb",mouthRotation:.4,inflation:1,lipScale:1.33,pitchScale:.5,width:1.8,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_004_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_004_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_004_001_Normals_Params.png",hueShift:.8,saturationBoost:.3,lightnessBoost:.5},mouth:{color:"#ee96f6"},eye:{pupilSize:.03,lidColor:"#ffffff",lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,0],scale:1,parameters:{leftEyeScale:[.16,.16,.16],rightEyeScale:[.16,.16,.16],rightEyeX:.4,rightEyeZ:.3,leftEyeX:-.4,leftEyeZ:.3},stretch:1,modelPath:"assets/001.flat",rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:2,mouthRotation:.2,inflation:.5,lipScale:1.3,pitchScale:.5,width:1.7,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_001_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_001_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_001_001_Normals_Params.png",normalScale:1,hueShift:.8,saturationBoost:.3,lightnessBoost:.5},mouth:{color:"#a7d3fb"},eye:{lidColor:"#b31247",pupilSize:.03,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,0],modelPath:"assets/002.flat",scale:.85,parameters:{leftEyeScale:[.15,.17,.15],rightEyeScale:[.15,.17,.15],rightEyeX:-.184637,rightEyeZ:.234132,leftEyeX:.184637,leftEyeZ:.234132},stretch:1,rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:3,mouthRotation:0,inflation:1,lipScale:1.4,pitchScale:.5,width:1.7,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_002_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_002_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_002_001_Normals_Params.png",normalScale:1,hueShift:.7,saturationBoost:.3,lightnessBoost:.5},mouth:{color:"#fffed2"},eye:{lidColor:"#21cf98",pupilSize:.03,lidRoughness:.25,lidF0:.05,topLidClamp:0}}],backgroundImagePath:"backgrounds/london.jpg",floorImagePath:"transparent.png",songs:[{nameStringID:"song_hallelujah_chorus",recordingID:"hallelujahchorus5"},{nameStringID:"song_londonderry_air",recordingID:"londonderryair1"},{nameStringID:"song_wellerman",recordingID:"wellerman3"},{nameStringID:"song_ar_hyd_y_nos",recordingID:"ArHydYNos2"},{nameStringID:"song_loch_lomond",recordingID:"LochLomond2"}]},{locationStringID:"location_new_york",name:"new_york",startCameraPosition:[2.3382685902179845,3.25,12.65],endCameraPosition:[0,4.25,19.5],blobs:[{position:[0,0,0],modelPath:"assets/002.flat",scale:.85,parameters:{leftEyeScale:[.1,.1,.1],rightEyeScale:[.1,.1,.1],rightEyeX:-.184637,rightEyeZ:.234132,leftEyeX:.184637,leftEyeZ:.234132},stretch:1,rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:0,mouthRotation:0,inflation:1,lipScale:1.4,pitchScale:.5,width:1.7,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_002_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_002_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_002_001_Normals_Params.png",normalScale:1,saturationBoost:.3,lightnessBoost:.5,hueShift:.4},mouth:{color:"#f2b8fa"},eye:{lidColor:"#21cf98",pupilSize:.03,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,.2],modelPath:"assets/003.flat",scale:1,parameters:{leftEyeScale:[.11,.11,.11],rightEyeScale:[.11,.11,.11],rightEyeX:-.13,rightEyeZ:-.1,leftEyeX:.13,leftEyeZ:-.1,eyeAttachOffset:.05},stretch:1,rotationDegrees:45,singerIndex:1,subsurfaceColor:"#bbbbbb",mouthRotation:0,inflation:1.2,lipScale:1.1,pitchScale:.5,width:1.3,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_003_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_003_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_003_001_Normals_Params.png",hueShift:.8,saturationBoost:.3,lightnessBoost:.5},mouth:{color:"#6dfff3"},eye:{lidColor:"#05b5f0",pupilSize:.024,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,0],scale:1,parameters:{leftEyeScale:[.15,.165,.15],rightEyeScale:[.15,.165,.15],rightEyeX:.3,rightEyeZ:.1,leftEyeX:-.3,leftEyeZ:.1},stretch:1,modelPath:"assets/001.flat",rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:2,mouthRotation:.2,inflation:.8,lipScale:1.3,pitchScale:.5,width:1.944,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_001_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_001_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_001_001_Normals_Params.png",normalScale:4,saturationBoost:.5,lightnessBoost:.5,hueShift:.2},mouth:{color:"#aa33b8"},eye:{lidColor:"#b31247",pupilSize:.03,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,0],modelPath:"assets/004.flat",scale:1,parameters:{leftEyeScale:[.2,.2,.2],rightEyeScale:[.2,.2,.2],rightEyeX:-.3,rightEyeZ:.21,leftEyeX:.3,leftEyeZ:.21},stretch:1.25,rotationDegrees:45,singerIndex:3,subsurfaceColor:"#bbbbbb",mouthRotation:0,inflation:1.8,lipScale:1.33,pitchScale:.5,width:1.8,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_004_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_004_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_004_001_Normals_Params.png",saturationBoost:.3,lightnessBoost:.5,hueShift:.5},mouth:{color:"#ffffff"},eye:{pupilSize:.03,lidColor:"#ffffff",lidRoughness:.25,lidF0:.05,topLidClamp:0}}],backgroundImagePath:"backgrounds/newyork.jpg",floorImagePath:"transparent.png",songs:[{nameStringID:"song_new_world_symphony",recordingID:"dvorak1"},{nameStringID:"song_down_to_the_river",recordingID:"downtotheriver1"},{nameStringID:"song_when_the_saints",recordingID:"whenthesaints4"},{nameStringID:"song_summertime",recordingID:"summertime3"},{nameStringID:"song_country_club",recordingID:"countryclub1"}]},{locationStringID:"location_mexico_city",name:"mexico_city",startCameraPosition:[2.3382685902179845,3.25,12.65],endCameraPosition:[0,4.25,19.5],blobs:[{position:[0,0,0],modelPath:"assets/004.flat",scale:1,parameters:{leftEyeScale:[.12,.14,.12],rightEyeScale:[.12,.14,.12],rightEyeX:-.2,rightEyeZ:.21,leftEyeX:.2,leftEyeZ:.21},stretch:1.35,rotationDegrees:45,singerIndex:0,subsurfaceColor:"#bbbbbb",mouthRotation:.4,inflation:.9,lipScale:1.33,pitchScale:.5,width:1.7,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_004_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_004_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_004_001_Normals_Params.png",saturationBoost:.5,lightnessBoost:.5,hueShift:.2},mouth:{color:"#c9f7a2"},eye:{pupilSize:.03,lidColor:"#f0bd05",lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,0],modelPath:"assets/003.flat",scale:1,parameters:{leftEyeScale:[.08,.08,.08],rightEyeScale:[.08,.08,.08],rightEyeX:-.1,rightEyeZ:-.1,leftEyeX:.1,leftEyeZ:-.1,eyeAttachOffset:.05},stretch:1,rotationDegrees:45,singerIndex:1,subsurfaceColor:"#bbbbbb",mouthRotation:0,inflation:1.2,lipScale:1.1,pitchScale:.5,width:1.3,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_003_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_003_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_003_001_Normals_Params.png",saturationBoost:.3,lightnessBoost:.5,hueShift:.2},mouth:{color:"#f6c7fe"},eye:{lidColor:"#05b5f0",pupilSize:.024,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,0],scale:1,parameters:{leftEyeScale:[.11,.11,.11],rightEyeScale:[.11,.11,.11],rightEyeX:.2,rightEyeZ:-.01,leftEyeX:-.2,leftEyeZ:-.01},stretch:1,modelPath:"assets/005.flat",rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:2,mouthRotation:.2,inflation:1.4,lipScale:1.3,pitchScale:.5,width:1.7,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_005_01_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_005_01_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_005_01_001_Normals_Params.png",normalScale:1,hueShift:.25,saturationBoost:.4,lightnessBoost:.6},mouth:{color:"#f8d89f"},eye:{lidColor:"#b31247",pupilSize:.03,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,-.4],scale:1,parameters:{leftEyeScale:[.13,.13,.13],rightEyeScale:[.13,.13,.13],rightEyeX:.3,rightEyeZ:.3,leftEyeX:-.3,leftEyeZ:.3},stretch:1,modelPath:"assets/001.flat",rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:3,mouthRotation:.2,inflation:1,lipScale:1.3,pitchScale:.5,width:1.7,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_001_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_001_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_001_001_Normals_Params.png",normalScale:1,saturationBoost:.5,lightnessBoost:.5,hueShift:.8},mouth:{color:"#c3f3fd"},eye:{lidColor:"#b31247",pupilSize:.03,lidRoughness:.25,lidF0:.05,topLidClamp:0}}],backgroundImagePath:"backgrounds/mexicocity.jpg",floorImagePath:"transparent.png",songs:[{nameStringID:"song_dios_nunca_muera",recordingID:"diosnuncamuere2"},{nameStringID:"song_la_bamba",recordingID:"labamba1"},{nameStringID:"song_la_llorona",recordingID:"lallorona2"}]},{locationStringID:"location_seoul",name:"seoul",startCameraPosition:[2.3382685902179845,3.25,12.65],endCameraPosition:[0,4.25,19.5],blobs:[{position:[0,0,.3],modelPath:"assets/002.flat",scale:.85,parameters:{leftEyeScale:[.15,.17,.15],rightEyeScale:[.15,.17,.15],rightEyeX:-.184637,rightEyeZ:.234132,leftEyeX:.184637,leftEyeZ:.234132},stretch:1,rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:0,mouthRotation:0,inflation:1,lipScale:1.4,pitchScale:.5,width:2,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_002_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_002_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_002_001_Normals_Params.png",normalScale:1,hueShift:.7,saturationBoost:.3,lightnessBoost:.5},mouth:{color:"#fcea83"},eye:{lidColor:"#21cf98",pupilSize:.03,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,.3],scale:1,parameters:{leftEyeScale:[.11,.11,.11],rightEyeScale:[.11,.11,.11],rightEyeX:.2,rightEyeZ:-.01,leftEyeX:-.2,leftEyeZ:-.01},stretch:1,modelPath:"assets/005.flat",rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:1,mouthRotation:.2,inflation:1.4,lipScale:1.3,pitchScale:.5,width:1.7,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_005_01_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_005_01_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_005_01_001_Normals_Params.png",normalScale:1,hueShift:.8,saturationBoost:.3,lightnessBoost:.5},mouth:{color:"#addaf7"},eye:{lidColor:"#b31247",pupilSize:.03,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,0],scale:1,parameters:{leftEyeScale:[.16,.16,.16],rightEyeScale:[.16,.16,.16],rightEyeX:.4,rightEyeZ:.3,leftEyeX:-.4,leftEyeZ:.3},stretch:1,modelPath:"assets/001.flat",rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:2,mouthRotation:.2,inflation:.8,lipScale:1.3,pitchScale:.5,width:1.4,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_001_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_001_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_001_001_Normals_Params.png",normalScale:1,hueShift:.5,saturationBoost:.3,lightnessBoost:.5},mouth:{color:"#e4fcc4"},eye:{lidColor:"#b31247",pupilSize:.03,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,-.5],modelPath:"assets/004.flat",scale:1,parameters:{leftEyeScale:[.12,.14,.12],rightEyeScale:[.12,.14,.12],rightEyeX:-.3,rightEyeZ:.21,leftEyeX:.3,leftEyeZ:.21},stretch:1.25,rotationDegrees:45,singerIndex:3,subsurfaceColor:"#bbbbbb",mouthRotation:0,inflation:1.8,lipScale:1.33,pitchScale:.5,width:3,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_004_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_004_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_004_001_Normals_Params.png",saturationBoost:.3,lightnessBoost:.5,hueShift:.7},mouth:{color:"#ffffff"},eye:{pupilSize:.03,lidColor:"#ffffff",lidRoughness:.25,lidF0:.05,topLidClamp:0}}],backgroundImagePath:"backgrounds/seoul.jpg",floorImagePath:"transparent.png",songs:[{nameStringID:"song_arirang",recordingID:"arirang2"},{nameStringID:"song_han_river",recordingID:"hanriver1"},{nameStringID:"song_doraji",recordingID:"doraji1"}]},{locationStringID:"location_cape_town",name:"cape_town",startCameraPosition:[2.3382685902179845,3.25,12.65],endCameraPosition:[0,4.25,19.5],blobs:[{position:[0,0,0],modelPath:"assets/004.flat",scale:1,parameters:{leftEyeScale:[.08,.08,.08],rightEyeScale:[.08,.08,.08],rightEyeX:-.2,rightEyeZ:.21,leftEyeX:.2,leftEyeZ:.21},stretch:1.25,rotationDegrees:45,singerIndex:0,subsurfaceColor:"#bbbbbb",mouthRotation:.4,inflation:1,lipScale:1.33,pitchScale:.5,width:1.8,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_004_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_004_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_004_001_Normals_Params.png",saturationBoost:.1,lightnessBoost:.6,hueShift:.6},mouth:{color:"#ffffff"},eye:{pupilSize:.03,lidColor:"#ffffff",lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,.2],modelPath:"assets/003.flat",scale:1.1,parameters:{leftEyeScale:[.1,.11,.1],rightEyeScale:[.1,.11,.1],rightEyeX:.2,rightEyeZ:0,leftEyeX:-.2,leftEyeZ:0},stretch:.9,rotationDegrees:45,singerIndex:1,subsurfaceColor:"#bbbbbb",mouthRotation:0,inflation:1,lipScale:1.1,pitchScale:.5,width:1.3,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_003_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_003_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_003_001_Normals_Params.png",saturationBoost:.3,lightnessBoost:.7,hueShift:.5},mouth:{color:"#f7efac"},eye:{lidColor:"#05b5f0",pupilSize:.024,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,-.2],scale:1,parameters:{leftEyeScale:[.12,.12,.12],rightEyeScale:[.12,.12,.12],rightEyeX:.3,rightEyeZ:.3,leftEyeX:-.3,leftEyeZ:.3},stretch:1,modelPath:"assets/001.flat",rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:2,mouthRotation:.2,inflation:.8,lipScale:1.3,pitchScale:.5,width:1.944,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_001_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_001_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_001_001_Normals_Params.png",normalScale:1,saturationBoost:.5,lightnessBoost:.5,hueShift:.6},mouth:{color:"#b5f4c1"},eye:{lidColor:"#b31247",pupilSize:.03,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[.2,0,0],modelPath:"assets/002.flat",scale:.85,parameters:{leftEyeScale:[.15,.17,.15],rightEyeScale:[.15,.17,.15],rightEyeX:-.184637,rightEyeZ:.234132,leftEyeX:.184637,leftEyeZ:.234132},stretch:1,rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:3,mouthRotation:0,inflation:1,lipScale:1.3,pitchScale:.5,width:1.7,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_002_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_002_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_002_001_Normals_Params.png",normalScale:1,saturationBoost:.5,lightnessBoost:.5,hueShift:.35},mouth:{color:"#eebafb"},eye:{lidColor:"#21cf98",pupilSize:.03,lidRoughness:.25,lidF0:.05,topLidClamp:0}}],backgroundImagePath:"backgrounds/capetown.jpg",floorImagePath:"transparent.png",songs:[{nameStringID:"song_shosholoza",recordingID:"Shosholoza2"},{nameStringID:"song_thula_baba",recordingID:"thulababa2"},{nameStringID:"song_nkosi",recordingID:"nkosi2"}]},{locationStringID:"location_paris",name:"paris",startCameraPosition:[2.3382685902179845,3.25,12.65],endCameraPosition:[0,4.25,19.5],blobs:[{position:[0,0,0],modelPath:"assets/002.flat",scale:.85,parameters:{leftEyeScale:[.15,.17,.15],rightEyeScale:[.15,.17,.15],rightEyeX:-.184637,rightEyeZ:.234132,leftEyeX:.184637,leftEyeZ:.234132},stretch:1,rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:0,mouthRotation:0,inflation:1,lipScale:1.4,pitchScale:.5,width:1.7,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_002_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_002_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_002_001_Normals_Params.png",normalScale:1,saturationBoost:.5,lightnessBoost:.5,hueShift:.65},mouth:{color:"#ffdbae"},eye:{lidColor:"#21cf98",pupilSize:.03,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,0],modelPath:"assets/004.flat",scale:1,parameters:{leftEyeScale:[.12,.14,.12],rightEyeScale:[.12,.14,.12],rightEyeX:-.2,rightEyeZ:.19,leftEyeX:.2,leftEyeZ:.19},stretch:1.25,rotationDegrees:45,singerIndex:1,subsurfaceColor:"#bbbbbb",mouthRotation:.4,inflation:1,lipScale:1.33,pitchScale:.5,width:1.8,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_004_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_004_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_004_001_Normals_Params.png",saturationBoost:.1,lightnessBoost:.8,hueShift:.7},mouth:{color:"#ffffff"},eye:{pupilSize:.03,lidColor:"#ffffff",lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,0],modelPath:"assets/003.flat",scale:1.1,parameters:{leftEyeScale:[.1,.11,.1],rightEyeScale:[.1,.11,.1],rightEyeX:.2,rightEyeZ:0,leftEyeX:-.2,leftEyeZ:0,eyeAttachOffset:.05},stretch:.9,rotationDegrees:45,singerIndex:2,subsurfaceColor:"#bbbbbb",mouthRotation:0,inflation:1.3,lipScale:1.1,pitchScale:.5,width:1.3,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_003_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_003_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_003_001_Normals_Params.png",saturationBoost:.5,lightnessBoost:.5,hueShift:.8},mouth:{color:"#6dfff3"},eye:{lidColor:"#05b5f0",pupilSize:.024,lidRoughness:.25,lidF0:.05,topLidClamp:0}},{position:[0,0,-.4],scale:1,parameters:{leftEyeScale:[.15,.165,.15],rightEyeScale:[.15,.165,.15],rightEyeX:.3,rightEyeZ:0,leftEyeX:-.3,leftEyeZ:0},stretch:1,modelPath:"assets/001.flat",rotationDegrees:45,subsurfaceColor:"#bbbbbb",singerIndex:3,mouthRotation:.2,inflation:.8,lipScale:1.3,pitchScale:.5,width:1.944,body:{color:"#ffffff",albedoTexturePath:"assets/0006/210420_F4_001_001_BaseColor.jpg",normalMapPath:"assets/0006/210420_F4_001_001_Normal.png",materialTexturePath:"assets/0006/210420_F4_001_001_Normals_Params.png",normalScale:1,saturationBoost:.5,lightnessBoost:.5,hueShift:.9},mouth:{color:"#aa33b8"},eye:{lidColor:"#b31247",pupilSize:.03,lidRoughness:.25,lidF0:.05,topLidClamp:0}}],backgroundImagePath:"backgrounds/paris.jpg",floorImagePath:"transparent.png",songs:[{nameStringID:"song_gymnopedie",recordingID:"gymnopedie6"},{nameStringID:"song_frere_jacques",recordingID:"frerejacques4"},{nameStringID:"song_habanera",recordingID:"habanera2"}]}],midiMappingMode:"keyboard",skipTutorial:!1,disableDrop:!1,disableUI:!1},Qe="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==Qe&&Qe,$e="URLSearchParams"in Qe,tn="Symbol"in Qe&&"iterator"in Symbol,en="FileReader"in Qe&&"Blob"in Qe&&function(){try{return new Blob,!0}catch(t){return!1}}(),nn="FormData"in Qe,on="ArrayBuffer"in Qe;if(on)var rn=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],an=ArrayBuffer.isView||function(t){return t&&rn.indexOf(Object.prototype.toString.call(t))>-1};function sn(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||""===t)throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function ln(t){return"string"!=typeof t&&(t=String(t)),t}function un(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return tn&&(e[Symbol.iterator]=function(){return e}),e}function cn(t){this.map={},t instanceof cn?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function hn(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function fn(t){return new Promise((function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function dn(t){var e=new FileReader,n=fn(e);return e.readAsArrayBuffer(t),n}function pn(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function mn(){return this.bodyUsed=!1,this._initBody=function(t){var e;this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:en&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:nn&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:$e&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():on&&en&&((e=t)&&DataView.prototype.isPrototypeOf(e))?(this._bodyArrayBuffer=pn(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):on&&(ArrayBuffer.prototype.isPrototypeOf(t)||an(t))?this._bodyArrayBuffer=pn(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):$e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},en&&(this.blob=function(){var t=hn(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=hn(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(dn)}),this.text=function(){var t,e,n,i=hn(this);if(i)return i;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=fn(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),i=0;i<e.length;i++)n[i]=String.fromCharCode(e[i]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},nn&&(this.formData=function(){return this.text().then(vn)}),this.json=function(){return this.text().then(JSON.parse)},this}cn.prototype.append=function(t,e){t=sn(t),e=ln(e);var n=this.map[t];this.map[t]=n?n+", "+e:e},cn.prototype.delete=function(t){delete this.map[sn(t)]},cn.prototype.get=function(t){return t=sn(t),this.has(t)?this.map[t]:null},cn.prototype.has=function(t){return this.map.hasOwnProperty(sn(t))},cn.prototype.set=function(t,e){this.map[sn(t)]=ln(e)},cn.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},cn.prototype.keys=function(){var t=[];return this.forEach((function(e,n){t.push(n)})),un(t)},cn.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),un(t)},cn.prototype.entries=function(){var t=[];return this.forEach((function(e,n){t.push([n,e])})),un(t)},tn&&(cn.prototype[Symbol.iterator]=cn.prototype.entries);var gn=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function bn(t,e){if(!(this instanceof bn))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var n,i,o=(e=e||{}).body;if(t instanceof bn){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new cn(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,o||null==t._bodyInit||(o=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new cn(e.headers)),this.method=(n=e.method||this.method||"GET",i=n.toUpperCase(),gn.indexOf(i)>-1?i:n),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(o),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==e.cache&&"no-cache"!==e.cache)){var r=/([?&])_=[^&]*/;if(r.test(this.url))this.url=this.url.replace(r,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function vn(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var n=t.split("="),i=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(o))}})),e}function yn(t,e){if(!(this instanceof yn))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"",this.headers=new cn(e.headers),this.url=e.url||"",this._initBody(t)}bn.prototype.clone=function(){return new bn(this,{body:this._bodyInit})},mn.call(bn.prototype),mn.call(yn.prototype),yn.prototype.clone=function(){return new yn(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new cn(this.headers),url:this.url})},yn.error=function(){var t=new yn(null,{status:0,statusText:""});return t.type="error",t};var _n=[301,302,303,307,308];yn.redirect=function(t,e){if(-1===_n.indexOf(e))throw new RangeError("Invalid status code");return new yn(null,{status:e,headers:{location:t}})};var xn=Qe.DOMException;try{new xn}catch(t){(xn=function(t,e){this.message=t,this.name=e;var n=Error(t);this.stack=n.stack}).prototype=Object.create(Error.prototype),xn.prototype.constructor=xn}function wn(t,e){return new Promise((function(n,i){var o=new bn(t,e);if(o.signal&&o.signal.aborted)return i(new xn("Aborted","AbortError"));var r=new XMLHttpRequest;function a(){r.abort()}r.onload=function(){var t,e,i={status:r.status,statusText:r.statusText,headers:(t=r.getAllResponseHeaders()||"",e=new cn,t.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(t){return 0===t.indexOf("\n")?t.substr(1,t.length):t})).forEach((function(t){var n=t.split(":"),i=n.shift().trim();if(i){var o=n.join(":").trim();e.append(i,o)}})),e)};i.url="responseURL"in r?r.responseURL:i.headers.get("X-Request-URL");var o="response"in r?r.response:r.responseText;setTimeout((function(){n(new yn(o,i))}),0)},r.onerror=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},r.ontimeout=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},r.onabort=function(){setTimeout((function(){i(new xn("Aborted","AbortError"))}),0)},r.open(o.method,function(t){try{return""===t&&Qe.location.href?Qe.location.href:t}catch(e){return t}}(o.url),!0),"include"===o.credentials?r.withCredentials=!0:"omit"===o.credentials&&(r.withCredentials=!1),"responseType"in r&&(en?r.responseType="blob":on&&o.headers.get("Content-Type")&&-1!==o.headers.get("Content-Type").indexOf("application/octet-stream")&&(r.responseType="arraybuffer")),!e||"object"!=typeof e.headers||e.headers instanceof cn?o.headers.forEach((function(t,e){r.setRequestHeader(e,t)})):Object.getOwnPropertyNames(e.headers).forEach((function(t){r.setRequestHeader(t,ln(e.headers[t]))})),o.signal&&(o.signal.addEventListener("abort",a),r.onreadystatechange=function(){4===r.readyState&&o.signal.removeEventListener("abort",a)}),r.send(void 0===o._bodyInit?null:o._bodyInit)}))}wn.polyfill=!0,Qe.fetch||(Qe.fetch=wn,Qe.Headers=cn,Qe.Request=bn,Qe.Response=yn);n(41);function Pn(){return Promise.resolve(Ke)}function Sn(){return("1"===new URLSearchParams(window.location.search).get("axl")?He():Promise.resolve(new Ve)).then((function(t){var e,n=t.location;return(e=n,"Recording"===e.kind?(new he).loadRecording(e.recordingID).then((function(t){return{kind:"Recording",recording:t,recordingID:e.recordingID}})).catch((function(t){return{kind:"Default"}})):Promise.resolve({kind:"Default"})).then((function(e){return[t,e]}))}))}function An(t,e){return Sn().then((function(n){var i=n[0],o=n[1],r="default";"Recording"===o.kind&&(r=ht(o.recording.location));var a=function(t,e){return t.scenes.find((function(t){return t.name===e}))}(t,r);return Se(e,a).then((function(t){return[i,o,a,t]}))}))}function Tn(t){var e=document.createElement("div");document.body.appendChild(e),e.outerHTML=t}var En=document.createElement("canvas");En.style.zIndex="-1",En.style.position="fixed",En.style.width="100%",En.style.height="100%",En.style.display="block";var Rn=En.getContext("webgl",{alpha:!1});if(null!==Rn&&(window.AudioContext||window.webkitAudioContext)&&window.Worker&&"object"==typeof WebAssembly){Tn(Ze('<div id="splash" class="hideable-unclickable visible"> <div id="intro">{{splash_intro}}</div> <div id="title" class="title"><img id="title-image" src="/blob-opera/logo-2x.png"></div> <div id="tagline">{{splash_description}}</div> <div id="loading" class="loading-visible"> <div id="loading-bar"> <div id="loading-fill"><div id="loading-play">{{button_begin}}</div></div> </div> <div id="audio-prompt">{{splash_sound_hint}}</div> <div id="silent-hint"><span class="material-icons" style="vertical-align:middle">notifications</span>{{splash_silent_hint}}</div> </div> </div> <div id="disclaimer" class="hideable-unclickable visible"> {{disclaimer}} </div> <div id="landscape-warning-overlay"> <div> <div id="landscape-warning-desktop"> <div class="landscape-warning-icon"><span class="material-icons">fullscreen</span></div> <div class="landscape-warning-text">{{landscape_warning_desktop}}</div> </div> <div id="landscape-warning-mobile"> <div class="landscape-warning-icon"><span class="material-icons">screen_rotation</span></div> <div class="landscape-warning-text">{{landscape_warning_mobile}}</div> </div> </div> </div>',de["en-US"])),Kt()&&document.getElementById("silent-hint").classList.add("silent-hint-show");var Mn=function(){window.innerHeight<400?(Zt()?(document.getElementById("landscape-warning-desktop").style.display="none",document.getElementById("landscape-warning-mobile").style.display="block"):(document.getElementById("landscape-warning-mobile").style.display="none",document.getElementById("landscape-warning-desktop").style.display="block"),document.getElementById("landscape-warning-overlay").style.display="flex"):(document.getElementById("landscape-warning-overlay").style.display="none",window.scrollTo(0,1))},Fn=Jt()?"eyelow.flat":"eye.flat",kn=Fn.includes("json");window.addEventListener("resize",Mn),Mn(),Pn().then((function(t){var e,n;(function(t,e){for(var n=t.length,i=0,o=0,r=t;o<r.length;o++){r[o].then((function(){e((i+=1)/n)}))}return Promise.all(t)})([Ht({locateFile:function(t,e){return Object(Qt.a)()?Object(Xt.a)(t.replace(".wasm","-simd.wasm")):Object(Xt.a)(t)}}),(e=4,n=Object(Xt.a)("jittertemplates.proto"),Promise.resolve(Je.a).then((function(t){Jt()&&(t.scriptProcessorBufferSize=8192);var i=Zt()?24e3:32e3;return ne(e,n,t,0,i)}))),new Promise((function(t,e){var n=new Worker(Object(Xt.a)("harmonizerworker.js"));n.onmessage=function(e){"Loaded"===e.data.type&&t(new se(n))}})),le(4,Jt()?1:4),Object(Wt.a)(Object(Xt.a)("recordedlibrettos.proto")),Object(Wt.a)(Object(Xt.a)(Fn)),An(t,Rn)],(function(t){document.getElementById("loading-fill").style.width=Math.round(100*t).toFixed(0)+"%"})).then((function(e){var n=e[6],i=n[0],o=n[1],r=n[2],a=n[3],s=!1,l=function(){if(!s){s=!0,document.body.appendChild(En),Tn(Ze('<div id="skip" class="hideable-clickable"> {{label_skip_tutorial}} &gt; </div> <div id="title-small" class="title hideable-unclickable"><img id="title-small-image" src="/blob-opera/logo-1x.png"></div> <div id="soprano-prompt" class="voice-prompt prompt prompt-right-arrow hideable-unclickable">{{prompt_soprano}}</div> <div id="alto-prompt" class="voice-prompt prompt prompt-right-arrow hideable-unclickable">{{prompt_mezzo}}</div> <div id="tenor-prompt" class="voice-prompt prompt prompt-right-arrow hideable-unclickable">{{prompt_tenor}}</div> <div id="bass-prompt" class="voice-prompt prompt prompt-right-arrow hideable-unclickable">{{prompt_bass}}</div> <div id="pitch-prompt" class="prompt prompt-left-arrow hideable-unclickable">{{prompt_pitch}}&nbsp;<span id="pitch-prompt-pitch"></span></div> <div id="vowel-prompt" class="prompt prompt-bottom-arrow hideable-unclickable">{{prompt_vowel}}&nbsp;<span id="vowel-prompt-vowel"></span></div> <svg style="width:0;height:0;position:absolute;z-index:-1"> <defs> <g id="silence-line"> <line x1="10" y1="10" x2="40" y2="40"></line> </g> <g id="silence-icon"> <path d="\n                M 10 20\n                L 10 30\n                L 19 30\n                L 30 40\n                L 30 10\n                L 19 20\n                Z\n            " fill="white" stroke="white" stroke-width="1" stroke-linecap="butt" stroke-linejoin="round"/> <path d="\n            M 33 20\n            A 10 10 0 0 1 33 30\n\n            M 35 15\n            A 15 15 0 0 1 35 35\n            " fill="transparent" stroke="white" stroke-width="1.5"></path> </g> </defs> </svg> <div id="record-container" class="button-container hideable-clickable"> <div id="record"> <div id="record-start"></div> </div> <div id="record-text" class="button-text">{{label_record}}</div> </div> <div id="stop-recording-container" class="button-container hideable-clickable recording"> <div id="recording-timecode" class="timecode"></div> <div id="stop-record"> <div id="record-start"></div> </div> <div id="finish-text" class="button-text">{{label_finish}}</div> </div> <div id="stop-recording-prompt" class="prompt prompt-left-arrow hideable-unclickable">{{prompt_stop_recording}}</div> <div id="share-recording-prompt" class="prompt prompt-bottom-arrow share-prompt hideable-unclickable">{{prompt_share}}</div> <div id="share-carol-prompt" class="prompt prompt-bottom-arrow share-prompt hideable-unclickable">{{prompt_share_carol}}</div> <div id="location-selection-prompt" class="prompt prompt-bottom-arrow hideable-clickable">{{prompt_locations}}</div> <div id="location-songs-prompt" class="prompt prompt-bottom-arrow hideable-clickable">{{prompt_location_songs}}</div> <div id="save-container" class="button-container hideable-clickable"> <div id="save" class="button material-icons">share</div> <div id="save-text" class="button-text">{{label_share}}</div> <div id="saving-text" class="button-text">{{label_saving}}</div> </div> <div id="startstop-container" class="button-container hideable-clickable"> <div id="playback-timecode" class="timecode"></div> <svg id="startstop-ring" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 58 58"> <circle class="progress-circle" r="26" cx="29" cy="29" stroke-width="6" stroke="rgba(255, 255, 255, 0.2)" fill="transparent"/> <path class="progress-ring" d="" stroke-width="6" stroke="white" fill="transparent"/> </svg> <div id="startstop" class=""> <div id="startstop-play"></div> <div id="startstop-stop"></div> </div> <div id="play-text" class="button-text">{{label_play}}</div> <div id="stop-text" class="button-text">{{label_stop}}</div> </div> <div id="back-container" class="button-container hideable-clickable"> <div class="button-text">{{label_back}}</div> <div id="back" class="button material-icons">arrow_back</div> </div> <div id="location-playlist-tray" class="hideable-clickable"> <div id="location-playlist-button" class="playlist-button material-icons hideable-clickable">queue_music</div> <div id="location-label"></div> </div> <div id="location-selector-button" class="location-button material-icons hideable-clickable">public</div> <div id="play" class="hideable-clickable">{{prompt_in_playback_shared}}</div> <div id="muted-container" class="hideable-unclickable"> <svg width="100%" height="100%" viewBox="-10 -10 70 70" xmlns="http://www.w3.org/2000/svg"> <mask id="line-mask" width="200%"> <rect x="-10" y="-10" width="160" height="100" fill="white"></rect> <line x1="10" y1="10" x2="40" y2="40" stroke="black" stroke-width="4"></line> </mask> <path d="\n            M 10 20\n            L 10 30\n            L 19 30\n            L 30 40\n            L 30 10\n            L 19 20\n            Z\n        " mask="url(#line-mask)" fill="white" stroke="white" stroke-width="1" stroke-linecap="butt" stroke-linejoin="round"/> <line x1="10" y1="10" x2="40" y2="40" stroke="white" stroke-width="2"></line> <path d="\n        M 33 20\n        A 10 10 0 0 1 33 30\n\n        M 35 15\n        A 15 15 0 0 1 35 35\n        " mask="url(#line-mask)" fill="transparent" stroke="white" stroke-width="1.5"></path> </svg> <div id="muted-text">{{prompt_unmute}}</div> </div> <div id="info" class="hideable-clickable">?</div> <div id="info-overlay" class="hideable-clickable"> <div id="info-container"> <div id="info-title" class="title"><img id="title-small-image" src="/blob-opera/logo-1x.png"></div> <p> {{info_body}} </p> <div id="close-info" class="button material-icons">close</div> </div> </div> <div id="location-selector-container" class="menu-container hideable-clickable prompt-bottom-arrow"> <ul id="location-selector" class="menu-items"></ul> </div> <div id="location-songs-container" class="menu-container hideable-clickable prompt-bottom-arrow"> <ul id="location-songs" class="menu-items"></ul> </div> <svg id="recording-frame-top-left" viewbox="0 0 1 1" class="recording-frame-corner hideable-unclickable"> <path d="M 1 0 L 0 0 L 0 1" fill="transparent"></path> </svg> <svg id="recording-frame-top-right" viewbox="0 0 1 1" class="recording-frame-corner hideable-unclickable"> <path d="M 0 0 L 1 0 L 1 1" fill="transparent"></path> </svg> <svg id="recording-frame-bottom-left" viewbox="0 0 1 1" class="recording-frame-corner hideable-unclickable"> <path d="M 1 1 L 0 1 L 0 0" fill="transparent"></path> </svg> <svg id="recording-frame-bottom-right" viewbox="0 0 1 1" class="recording-frame-corner hideable-unclickable"> <path d="M 1 0 L 1 1 L 0 1" fill="transparent"></path> </svg> <div id="recording-indicator" class="hideable-unclickable"> <div id="recording-icon"></div>RECORDING </div> <div id="tutorial-prompt-pitch" class="hideable-unclickable tutorial-prompt">{{tutorial_pitch}}</div> <div id="tutorial-prompt-vowel" class="hideable-unclickable tutorial-prompt">{{tutorial_vowel}}</div> <div id="tutorial-prompt-harmonization" class="hideable-unclickable tutorial-prompt">{{tutorial_harmonization}}</div> <div id="tutorial-prompt-mute" class="hideable-unclickable tutorial-prompt">{{tutorial_mute}}</div> <div id="tutorial-prompt-end" class="hideable-unclickable tutorial-prompt">{{tutorial_end}}</div> <div id="timer"></div> <div id="performance-warning" class="hideable-clickable"> <div id="performance-warning-content"> <div id="performance-warning-icon" class="material-icons">warning</div> <div id="performance-warning-text">{{performance_warning}}</div> <div id="performance-warning-dismiss">{{performance_warning_dismiss}}</div> </div> </div>',de["en-US"]));var n=e[0],l=e[1],u=Jt()?3:0,c=new Vt(t,En,Rn,n,e[2],e[3],l,new Uint8Array(e[4]),a,o,l.synthRunner.audioParameters.frameHopSeconds,Jt()?{blobSubdivisions:0}:{blobSubdivisions:1},u,r,new Uint8Array(e[5]),kn);if(t.disableUI)document.getElementById("splash").classList.remove("visible"),document.getElementById("disclaimer").classList.remove("visible");else new Be(t,c,i,o,"en-US");var h=document.getElementById("loading");h.className="loading-hidden",window.setTimeout((function(){h.parentNode.removeChild(h)}),300),i.onFreeze=function(){c.freeze()},i.onResume=function(){c.resume()};var f=function(){c.state===Mt.Playing&&c.stopPlayback(),c.audio.synthRunner.setTimingEnabled(!1)};document.addEventListener("visibilitychange",(function(t){"hidden"===document.visibilityState?f():"visible"===document.visibilityState&&c.audio.synthRunner.setTimingEnabled(!0)})),window.addEventListener("pagehide",f),window.addEventListener("pageshow",(function(){c.audio.synthRunner.setTimingEnabled(!0)})),i.track({action:"launch-experiment"})}},u=function(){e[1].tryUnlock(),l()};Jt()||Kt()?(document.getElementById("loading-bar").className="loading-button",document.getElementById("loading-bar").addEventListener("touchstart",(function(t){t.preventDefault()})),document.getElementById("loading-bar").addEventListener("touchend",u),document.getElementById("loading-bar").addEventListener("click",u)):l()}))}))}else Tn(Ze('<div id="error">Your browser doesn\'t support the required features. Try another browser and/or device!</div>',de["en-US"]))}]);
